function dn(f,h){for(var l=0;l<h.length;l++){const e=h[l];if(typeof e!="string"&&!Array.isArray(e)){for(const t in e)if(t!=="default"&&!(t in f)){const o=Object.getOwnPropertyDescriptor(e,t);o&&Object.defineProperty(f,t,o.get?o:{enumerable:!0,get:()=>e[t]})}}}return Object.freeze(Object.defineProperty(f,Symbol.toStringTag,{value:"Module"}))}function Ct(){Ct=function(){return f};var f={},h=Object.prototype,l=h.hasOwnProperty,e=typeof Symbol=="function"?Symbol:{},t=e.iterator||"@@iterator",o=e.asyncIterator||"@@asyncIterator",n=e.toStringTag||"@@toStringTag";function m(s,d,N){return Object.defineProperty(s,d,{value:N,enumerable:!0,configurable:!0,writable:!0}),s[d]}try{m({},"")}catch{m=function(d,N,D){return d[N]=D}}function C(s,d,N,D){var M=d&&d.prototype instanceof P?d:P,T=Object.create(M.prototype),E=new r(D||[]);return T._invoke=function(I,j,k){var H="suspendedStart";return function(V,z){if(H==="executing")throw new Error("Generator is already running");if(H==="completed"){if(V==="throw")throw z;return v()}for(k.method=V,k.arg=z;;){var _=k.delegate;if(_){var w=R(_,k);if(w){if(w===O)continue;return w}}if(k.method==="next")k.sent=k._sent=k.arg;else if(k.method==="throw"){if(H==="suspendedStart")throw H="completed",k.arg;k.dispatchException(k.arg)}else k.method==="return"&&k.abrupt("return",k.arg);H="executing";var U=S(I,j,k);if(U.type==="normal"){if(H=k.done?"completed":"suspendedYield",U.arg===O)continue;return{value:U.arg,done:k.done}}U.type==="throw"&&(H="completed",k.method="throw",k.arg=U.arg)}}}(s,N,E),T}function S(s,d,N){try{return{type:"normal",arg:s.call(d,N)}}catch(D){return{type:"throw",arg:D}}}f.wrap=C;var O={};function P(){}function A(){}function b(){}var a={};m(a,t,function(){return this});var g=Object.getPrototypeOf,L=g&&g(g(i([])));L&&L!==h&&l.call(L,t)&&(a=L);var x=b.prototype=P.prototype=Object.create(a);function p(s){["next","throw","return"].forEach(function(d){m(s,d,function(N){return this._invoke(d,N)})})}function y(s,d){function N(M,T,E,I){var j=S(s[M],s,T);if(j.type!=="throw"){var k=j.arg,H=k.value;return H&&typeof H=="object"&&l.call(H,"__await")?d.resolve(H.__await).then(function(V){N("next",V,E,I)},function(V){N("throw",V,E,I)}):d.resolve(H).then(function(V){k.value=V,E(k)},function(V){return N("throw",V,E,I)})}I(j.arg)}var D;this._invoke=function(M,T){function E(){return new d(function(I,j){N(M,T,I,j)})}return D=D?D.then(E,E):E()}}function R(s,d){var N=s.iterator[d.method];if(N===void 0){if(d.delegate=null,d.method==="throw"){if(s.iterator.return&&(d.method="return",d.arg=void 0,R(s,d),d.method==="throw"))return O;d.method="throw",d.arg=new TypeError("The iterator does not provide a 'throw' method")}return O}var D=S(N,s.iterator,d.arg);if(D.type==="throw")return d.method="throw",d.arg=D.arg,d.delegate=null,O;var M=D.arg;return M?M.done?(d[s.resultName]=M.value,d.next=s.nextLoc,d.method!=="return"&&(d.method="next",d.arg=void 0),d.delegate=null,O):M:(d.method="throw",d.arg=new TypeError("iterator result is not an object"),d.delegate=null,O)}function c(s){var d={tryLoc:s[0]};1 in s&&(d.catchLoc=s[1]),2 in s&&(d.finallyLoc=s[2],d.afterLoc=s[3]),this.tryEntries.push(d)}function u(s){var d=s.completion||{};d.type="normal",delete d.arg,s.completion=d}function r(s){this.tryEntries=[{tryLoc:"root"}],s.forEach(c,this),this.reset(!0)}function i(s){if(s){var d=s[t];if(d)return d.call(s);if(typeof s.next=="function")return s;if(!isNaN(s.length)){var N=-1,D=function M(){for(;++N<s.length;)if(l.call(s,N))return M.value=s[N],M.done=!1,M;return M.value=void 0,M.done=!0,M};return D.next=D}}return{next:v}}function v(){return{value:void 0,done:!0}}return A.prototype=b,m(x,"constructor",b),m(b,"constructor",A),A.displayName=m(b,n,"GeneratorFunction"),f.isGeneratorFunction=function(s){var d=typeof s=="function"&&s.constructor;return!!d&&(d===A||(d.displayName||d.name)==="GeneratorFunction")},f.mark=function(s){return Object.setPrototypeOf?Object.setPrototypeOf(s,b):(s.__proto__=b,m(s,n,"GeneratorFunction")),s.prototype=Object.create(x),s},f.awrap=function(s){return{__await:s}},p(y.prototype),m(y.prototype,o,function(){return this}),f.AsyncIterator=y,f.async=function(s,d,N,D,M){M===void 0&&(M=Promise);var T=new y(C(s,d,N,D),M);return f.isGeneratorFunction(d)?T:T.next().then(function(E){return E.done?E.value:T.next()})},p(x),m(x,n,"Generator"),m(x,t,function(){return this}),m(x,"toString",function(){return"[object Generator]"}),f.keys=function(s){var d=[];for(var N in s)d.push(N);return d.reverse(),function D(){for(;d.length;){var M=d.pop();if(M in s)return D.value=M,D.done=!1,D}return D.done=!0,D}},f.values=i,r.prototype={constructor:r,reset:function(s){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(u),!s)for(var d in this)d.charAt(0)==="t"&&l.call(this,d)&&!isNaN(+d.slice(1))&&(this[d]=void 0)},stop:function(){this.done=!0;var s=this.tryEntries[0].completion;if(s.type==="throw")throw s.arg;return this.rval},dispatchException:function(s){if(this.done)throw s;var d=this;function N(j,k){return T.type="throw",T.arg=s,d.next=j,k&&(d.method="next",d.arg=void 0),!!k}for(var D=this.tryEntries.length-1;D>=0;--D){var M=this.tryEntries[D],T=M.completion;if(M.tryLoc==="root")return N("end");if(M.tryLoc<=this.prev){var E=l.call(M,"catchLoc"),I=l.call(M,"finallyLoc");if(E&&I){if(this.prev<M.catchLoc)return N(M.catchLoc,!0);if(this.prev<M.finallyLoc)return N(M.finallyLoc)}else if(E){if(this.prev<M.catchLoc)return N(M.catchLoc,!0)}else{if(!I)throw new Error("try statement without catch or finally");if(this.prev<M.finallyLoc)return N(M.finallyLoc)}}}},abrupt:function(s,d){for(var N=this.tryEntries.length-1;N>=0;--N){var D=this.tryEntries[N];if(D.tryLoc<=this.prev&&l.call(D,"finallyLoc")&&this.prev<D.finallyLoc){var M=D;break}}M&&(s==="break"||s==="continue")&&M.tryLoc<=d&&d<=M.finallyLoc&&(M=null);var T=M?M.completion:{};return T.type=s,T.arg=d,M?(this.method="next",this.next=M.finallyLoc,O):this.complete(T)},complete:function(s,d){if(s.type==="throw")throw s.arg;return s.type==="break"||s.type==="continue"?this.next=s.arg:s.type==="return"?(this.rval=this.arg=s.arg,this.method="return",this.next="end"):s.type==="normal"&&d&&(this.next=d),O},finish:function(s){for(var d=this.tryEntries.length-1;d>=0;--d){var N=this.tryEntries[d];if(N.finallyLoc===s)return this.complete(N.completion,N.afterLoc),u(N),O}},catch:function(s){for(var d=this.tryEntries.length-1;d>=0;--d){var N=this.tryEntries[d];if(N.tryLoc===s){var D=N.completion;if(D.type==="throw"){var M=D.arg;u(N)}return M}}throw new Error("illegal catch attempt")},delegateYield:function(s,d,N){return this.delegate={iterator:i(s),resultName:d,nextLoc:N},this.method==="next"&&(this.arg=void 0),O}},f}function kt(f){"@babel/helpers - typeof";return kt=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(h){return typeof h}:function(h){return h&&typeof Symbol=="function"&&h.constructor===Symbol&&h!==Symbol.prototype?"symbol":typeof h},kt(f)}function ot(f,h){if(!(f instanceof h))throw new TypeError("Cannot call a class as a function")}function Ce(f,h){for(var l=0;l<h.length;l++){var e=h[l];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(f,e.key,e)}}function st(f,h,l){return h&&Ce(f.prototype,h),l&&Ce(f,l),Object.defineProperty(f,"prototype",{writable:!1}),f}function gt(){return gt=Object.assign?Object.assign.bind():function(f){for(var h=1;h<arguments.length;h++){var l=arguments[h];for(var e in l)Object.prototype.hasOwnProperty.call(l,e)&&(f[e]=l[e])}return f},gt.apply(this,arguments)}function lt(f,h){if(typeof h!="function"&&h!==null)throw new TypeError("Super expression must either be null or a function");f.prototype=Object.create(h&&h.prototype,{constructor:{value:f,writable:!0,configurable:!0}}),Object.defineProperty(f,"prototype",{writable:!1}),h&&ie(f,h)}function St(f){return St=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(l){return l.__proto__||Object.getPrototypeOf(l)},St(f)}function ie(f,h){return ie=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ie(f,h)}function hn(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function le(f){if(f===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return f}function pn(f,h){if(h&&(typeof h=="object"||typeof h=="function"))return h;if(h!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return le(f)}function ft(f){var h=hn();return function(){var e=St(f),t;if(h){var o=St(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return pn(this,t)}}function vn(f,h){for(;!Object.prototype.hasOwnProperty.call(f,h)&&(f=St(f),f!==null););return f}function Dt(){return typeof Reflect<"u"&&Reflect.get?Dt=Reflect.get.bind():Dt=function(h,l,e){var t=vn(h,l);if(t){var o=Object.getOwnPropertyDescriptor(t,l);return o.get?o.get.call(arguments.length<3?h:e):o.value}},Dt.apply(this,arguments)}var _t=function(){function f(){ot(this,f)}return st(f,[{key:"listenForWhisper",value:function(l,e){return this.listen(".client-"+l,e)}},{key:"notification",value:function(l){return this.listen(".Illuminate\\Notifications\\Events\\BroadcastNotificationCreated",l)}},{key:"stopListeningForWhisper",value:function(l,e){return this.stopListening(".client-"+l,e)}}]),f}();function jt(f,h){var l={};for(var e in f)Object.prototype.hasOwnProperty.call(f,e)&&h.indexOf(e)<0&&(l[e]=f[e]);if(f!=null&&typeof Object.getOwnPropertySymbols=="function")for(var t=0,e=Object.getOwnPropertySymbols(f);t<e.length;t++)h.indexOf(e[t])<0&&Object.prototype.propertyIsEnumerable.call(f,e[t])&&(l[e[t]]=f[e[t]]);return l}function Gt(f,h,l,e){function t(o){return o instanceof l?o:new l(function(n){n(o)})}return new(l||(l=Promise))(function(o,n){function m(O){try{S(e.next(O))}catch(P){n(P)}}function C(O){try{S(e.throw(O))}catch(P){n(P)}}function S(O){O.done?o(O.value):t(O.value).then(m,C)}S((e=e.apply(f,h||[])).next())})}var fe=function(){function f(h){ot(this,f),this.setNamespace(h)}return st(f,[{key:"format",value:function(l){return l.charAt(0)==="."||l.charAt(0)==="\\"?l.substr(1):(this.namespace&&(l=this.namespace+"."+l),l.replace(/\./g,"\\"))}},{key:"setNamespace",value:function(l){this.namespace=l}}]),f}(),de=function(f){lt(l,f);var h=ft(l);function l(e,t,o){var n,m=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0;return ot(this,l),n=h.call(this),n._alertErrorListeners=function(C){C&&n.errorListeners.forEach(function(S){return S(C)})},n.name=t,n.ably=e,n.options=o,n.eventFormatter=new fe(n.options.namespace),n.subscribedListeners=[],n.errorListeners=[],n.channel=e.channels.get(t),n.callbacks=new Map,m&&n.subscribe(),n}return st(l,[{key:"subscribe",value:function(){var t=this;this.channel.on(function(o){var n=o.previous,m=o.current,C=o.reason;n!=="attached"&&m=="attached"?t.subscribedListeners.forEach(function(S){return S()}):C&&t._alertErrorListeners(o)}),this.channel.attach(this._alertErrorListeners)}},{key:"unsubscribe",value:function(){this.channel.unsubscribe(),this.callbacks.clear(),this.unregisterError(),this.unregisterSubscribed(),this.channel.off(),this.channel.detach()}},{key:"listen",value:function(t,o){return this.callbacks.set(o,function(n){var m=n.data,C=jt(n,["data"]);return o(m,C)}),this.channel.subscribe(this.eventFormatter.format(t),this.callbacks.get(o)),this}},{key:"listenToAll",value:function(t){var o=this;return this.callbacks.set(t,function(n){var m=n.name,C=n.data,S=jt(n,["name","data"]),O=o.options.namespace.replace(/\./g,"\\"),P=m.startsWith(O)?m.substring(O.length+1):"."+m;t(P,C,S)}),this.channel.subscribe(this.callbacks.get(t)),this}},{key:"stopListening",value:function(t,o){return o?(this.channel.unsubscribe(this.eventFormatter.format(t),this.callbacks.get(o)),this.callbacks.delete(o)):this.channel.unsubscribe(this.eventFormatter.format(t)),this}},{key:"stopListeningToAll",value:function(t){return t?(this.channel.unsubscribe(this.callbacks.get(t)),this.callbacks.delete(t)):this.channel.unsubscribe(),this}},{key:"subscribed",value:function(t){return this.subscribedListeners.push(t),this}},{key:"error",value:function(t){return this.errorListeners.push(t),this}},{key:"unregisterSubscribed",value:function(t){return t?this.subscribedListeners=this.subscribedListeners.filter(function(o){return o!=t}):this.subscribedListeners=[],this}},{key:"unregisterError",value:function(t){return t?this.errorListeners=this.errorListeners.filter(function(o){return o!=t}):this.errorListeners=[],this}}]),l}(_t),gn=function(f){lt(l,f);var h=ft(l);function l(e,t,o,n){var m;return ot(this,l),m=h.call(this,e,t,o,!1),m.channel.on("failed",n.onChannelFailed(le(m))),m.subscribe(),m}return st(l,[{key:"whisper",value:function(t,o,n){return n?this.channel.publish("client-".concat(t),o,n):this.channel.publish("client-".concat(t),o),this}}]),l}(de),Ue=function(f){lt(l,f);var h=ft(l);function l(e,t,o,n){var m;return ot(this,l),m=h.call(this,e,t,o,!1),m.channel.on("failed",n.onChannelFailed(le(m))),m.channel.on("attached",function(){return m.enter(m.presenceData,m._alertErrorListeners)}),m.subscribe(),m}return st(l,[{key:"unsubscribe",value:function(){this.leave(this.presenceData,this._alertErrorListeners),this.channel.presence.unsubscribe(),Dt(St(l.prototype),"unsubscribe",this).call(this)}},{key:"here",value:function(t){var o=this;return this.channel.presence.subscribe(["enter","update","leave"],function(){return o.channel.presence.get(function(n,m){return t(m.map(function(C){var S=C.data;return S}),n)})}),this}},{key:"joining",value:function(t){return this.channel.presence.subscribe(["enter","update"],function(o){var n=o.data,m=jt(o,["data"]);t(n,m)}),this}},{key:"leaving",value:function(t){return this.channel.presence.subscribe("leave",function(o){var n=o.data,m=jt(o,["data"]);t(n,m)}),this}},{key:"enter",value:function(t,o){return this.channel.presence.enter(t,o),this}},{key:"leave",value:function(t,o){return this.channel.presence.leave(t,o),this}},{key:"update",value:function(t,o){return this.channel.presence.update(t,o),this}},{key:"whisper",value:function(t,o,n){return n?this.channel.publish("client-".concat(t),o,n):this.channel.publish("client-".concat(t),o),this}}]),l}(de),mn=function(h){return h==null||h===void 0},Be=function(h){var l=h.split(".")[0],e=l.replace("-","+").replace("_","/"),t=JSON.parse(Re(e)),o=h.split(".")[1],n=o.replace("-","+").replace("_","/"),m=JSON.parse(Re(n));return{header:t,payload:m}},Yt=function(h){var l=Be(h),e=l.payload;return{clientId:e["x-ably-clientId"],expires:e.exp*1e3,issued:e.iat*1e3,token:h}},he=(typeof window>"u"?"undefined":kt(window))==="object",Re=function(h){return he?atob(h):Buffer.from(h,"base64").toString("binary")},yn=function(h){return h&&h.indexOf("http://")===0||h.indexOf("https://")===0},On=function(h){var l,e,t;if(!yn(h)&&typeof window<"u"){var o=(l=window==null?void 0:window.location)===null||l===void 0?void 0:l.hostname,n=(e=window==null?void 0:window.location)===null||e===void 0?void 0:e.port,m=(t=window==null?void 0:window.location)===null||t===void 0?void 0:t.protocol.replace(":","");if(o&&n&&m)return m+"://"+o+":"+n+h}return h},Zt;function Cn(f,h){Zt||(Zt=new Ably.Rest.Platform.Http),he?delete f.headers["Content-Length"]:f.method=f.method.toLowerCase(),Zt.doUri(f.method,null,f.uri,f.headers,f.body,f.paramsIfNoHeaders||{},h)}var Rn=function(h){return new Promise(function(l,e){Cn(h,function(t,o){if(t)e(t);else if(typeof o=="string")l(JSON.parse(o));else if(!he&&Buffer.isBuffer(o))try{l(JSON.parse(o.toString()))}catch{l(o)}else l(o)})})},Ae=!1,An=function(h,l){var e=h.channels.get("dummy");if(Ae)return;var t=e.__proto__._attach;if(mn(t)){console.warn("Failed to enable authorize for pre-attach, please check for right library version");return}function o(n,m,C){var S=this;if(!this.authorizing){this.authorizing=!0;var O=t.bind(this);l(this,function(P){if(S.authorizing=!1,P){C(P);return}else O(n,m,C)})}}e.__proto__._attach=o,Ae=!0},Sn=st(function f(){var h=this,l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0;ot(this,f),this.execute=function(t){return new Promise(function(o,n){h.queue.run(function(){return Gt(h,void 0,void 0,Ct().mark(function m(){var C,S,O;return Ct().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.prev=0,A.next=3,t(this.cachedToken);case 3:C=A.sent,S=C.token,O=C.info,this.cachedToken=S,o({token:S,info:O}),A.next=13;break;case 10:A.prev=10,A.t0=A.catch(0),n(A.t0);case 13:case"end":return A.stop()}},m,this,[[0,10]])}))})})},this.request=function(t){return h.execute(function(o){return h.requestTokenFn(t,o)})},this.cachedToken=l,this.requestTokenFn=e,this.queue=new bn}),bn=st(function f(){var h=this,l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;ot(this,f),this.canRunNext=function(){return h.running.length<h.count&&h.todo.length},this.run=function(t){return Gt(h,void 0,void 0,Ct().mark(function o(){var n;return Ct().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:t&&this.todo.push(t);case 1:if(!this.canRunNext()){C.next=9;break}return n=this.todo.shift(),this.running.push(n),C.next=6,n();case 6:this.running.shift(),C.next=1;break;case 9:case"end":return C.stop()}},o,this)}))},this.total=l.length,this.todo=l,this.running=[],this.count=e}),En=st(function f(h){var l=this;ot(this,f),this.expiredAuthChannels=new Set,this.setExpired=function(m){return l.expiredAuthChannels.add(m)},this.isExpired=function(m){return l.expiredAuthChannels.has(m)},this.removeExpired=function(m){return l.expiredAuthChannels.delete(m)},this.options={queryTime:!0,useTokenAuth:!0,authCallback:function(C,S){return Gt(l,void 0,void 0,Ct().mark(function O(){var P,A,b;return Ct().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.prev=0,g.next=3,this.authRequestExecuter.request(null);case 3:P=g.sent,A=P.token,b=Yt(A),S(null,b),g.next=12;break;case 9:g.prev=9,g.t0=g.catch(0),S(g.t0,null);case 12:case"end":return g.stop()}},O,this,[[0,9]])}))},echoMessages:!1},this.requestToken=function(m,C){return Gt(l,void 0,void 0,Ct().mark(function S(){var O,P;return Ct().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return O=JSON.stringify({channel_name:m,token:C}),P={uri:this.authEndpoint,method:"POST",headers:gt({Accept:"application/json","Content-Type":"application/json","Content-Length":O.length},this.authHeaders),body:O},b.next=4,Rn(P);case 4:return b.abrupt("return",b.sent);case 5:case"end":return b.stop()}},S,this)}))},this.enableAuthorizeBeforeChannelAttach=function(m){var C=m.ably;C.auth.getTimestamp(l.options.queryTime,function(){}),An(C,function(S,O){var P=S.name;if(P.startsWith("public:")){O(null);return}var A=C.auth.tokenDetails;if(A&&!l.isExpired(P)){var b=Be(A.token).payload["x-ably-capability"],a=b.includes("".concat(P,'"'));if(a&&A.expires>C.auth.getTimestampUsingOffset()){O(null);return}}l.authRequestExecuter.request(P).then(function(g){var L=g.token,x=g.info,p=m.channels[P];l.setPresenceInfo(p,x),C.auth.authorize(null,gt(gt({},l.options),{token:Yt(L)}),function(y,R){y?O(y):(l.removeExpired(P),O(null))})}).catch(function(g){return O(g)})})},this.onChannelFailed=function(m){return function(C){var S;((S=C.reason)===null||S===void 0?void 0:S.code)==40160&&l.handleChannelAuthError(m)}},this.handleChannelAuthError=function(m){if(!m.skipAuth){var C=m.name;l.authRequestExecuter.request(C).then(function(S){var O=S.token,P=S.info;l.setPresenceInfo(m,P),m.ably.auth.authorize(null,gt(gt({},l.options),{token:Yt(O)}),function(A,b){A?m._alertErrorListeners(A):(m.skipAuth=!0,m.channel.once("attached",function(){m.skipAuth=!1}),m.channel.attach(m._alertErrorListeners))})}).catch(function(S){return m._alertErrorListeners(S)})}},this.setPresenceInfo=function(m,C){m instanceof Ue&&(m.presenceData=C)};var e=h.authEndpoint,t=h.auth.headers,o=h.token,n=h.requestTokenFn;this.authEndpoint=On(e),this.authHeaders=t,this.authRequestExecuter=new Sn(o,n??this.requestToken)}),Wt=function(f){lt(l,f);var h=ft(l);function l(e,t,o){var n;return ot(this,l),n=h.call(this),n.name=t,n.pusher=e,n.options=o,n.eventFormatter=new fe(n.options.namespace),n.subscribe(),n}return st(l,[{key:"subscribe",value:function(){this.subscription=this.pusher.subscribe(this.name)}},{key:"unsubscribe",value:function(){this.pusher.unsubscribe(this.name)}},{key:"listen",value:function(t,o){return this.on(this.eventFormatter.format(t),o),this}},{key:"listenToAll",value:function(t){var o=this;return this.subscription.bind_global(function(n,m){if(!n.startsWith("pusher:")){var C=o.options.namespace.replace(/\./g,"\\"),S=n.startsWith(C)?n.substring(C.length+1):"."+n;t(S,m)}}),this}},{key:"stopListening",value:function(t,o){return o?this.subscription.unbind(this.eventFormatter.format(t),o):this.subscription.unbind(this.eventFormatter.format(t)),this}},{key:"stopListeningToAll",value:function(t){return t?this.subscription.unbind_global(t):this.subscription.unbind_global(),this}},{key:"subscribed",value:function(t){return this.on("pusher:subscription_succeeded",function(){t()}),this}},{key:"error",value:function(t){return this.on("pusher:subscription_error",function(o){t(o)}),this}},{key:"on",value:function(t,o){return this.subscription.bind(t,o),this}}]),l}(_t),Tn=function(f){lt(l,f);var h=ft(l);function l(){return ot(this,l),h.apply(this,arguments)}return st(l,[{key:"whisper",value:function(t,o){return this.pusher.channels.channels[this.name].trigger("client-".concat(t),o),this}}]),l}(Wt),wn=function(f){lt(l,f);var h=ft(l);function l(){return ot(this,l),h.apply(this,arguments)}return st(l,[{key:"whisper",value:function(t,o){return this.pusher.channels.channels[this.name].trigger("client-".concat(t),o),this}}]),l}(Wt),In=function(f){lt(l,f);var h=ft(l);function l(){return ot(this,l),h.apply(this,arguments)}return st(l,[{key:"here",value:function(t){return this.on("pusher:subscription_succeeded",function(o){t(Object.keys(o.members).map(function(n){return o.members[n]}))}),this}},{key:"joining",value:function(t){return this.on("pusher:member_added",function(o){t(o.info)}),this}},{key:"whisper",value:function(t,o){return this.pusher.channels.channels[this.name].trigger("client-".concat(t),o),this}},{key:"leaving",value:function(t){return this.on("pusher:member_removed",function(o){t(o.info)}),this}}]),l}(Wt),ke=function(f){lt(l,f);var h=ft(l);function l(e,t,o){var n;return ot(this,l),n=h.call(this),n.events={},n.listeners={},n.name=t,n.socket=e,n.options=o,n.eventFormatter=new fe(n.options.namespace),n.subscribe(),n}return st(l,[{key:"subscribe",value:function(){this.socket.emit("subscribe",{channel:this.name,auth:this.options.auth||{}})}},{key:"unsubscribe",value:function(){this.unbind(),this.socket.emit("unsubscribe",{channel:this.name,auth:this.options.auth||{}})}},{key:"listen",value:function(t,o){return this.on(this.eventFormatter.format(t),o),this}},{key:"stopListening",value:function(t,o){return this.unbindEvent(this.eventFormatter.format(t),o),this}},{key:"subscribed",value:function(t){return this.on("connect",function(o){t(o)}),this}},{key:"error",value:function(t){return this}},{key:"on",value:function(t,o){var n=this;return this.listeners[t]=this.listeners[t]||[],this.events[t]||(this.events[t]=function(m,C){n.name===m&&n.listeners[t]&&n.listeners[t].forEach(function(S){return S(C)})},this.socket.on(t,this.events[t])),this.listeners[t].push(o),this}},{key:"unbind",value:function(){var t=this;Object.keys(this.events).forEach(function(o){t.unbindEvent(o)})}},{key:"unbindEvent",value:function(t,o){this.listeners[t]=this.listeners[t]||[],o&&(this.listeners[t]=this.listeners[t].filter(function(n){return n!==o})),(!o||this.listeners[t].length===0)&&(this.events[t]&&(this.socket.removeListener(t,this.events[t]),delete this.events[t]),delete this.listeners[t])}}]),l}(_t),je=function(f){lt(l,f);var h=ft(l);function l(){return ot(this,l),h.apply(this,arguments)}return st(l,[{key:"whisper",value:function(t,o){return this.socket.emit("client event",{channel:this.name,event:"client-".concat(t),data:o}),this}}]),l}(ke),Pn=function(f){lt(l,f);var h=ft(l);function l(){return ot(this,l),h.apply(this,arguments)}return st(l,[{key:"here",value:function(t){return this.on("presence:subscribed",function(o){t(o.map(function(n){return n.user_info}))}),this}},{key:"joining",value:function(t){return this.on("presence:joining",function(o){return t(o.user_info)}),this}},{key:"whisper",value:function(t,o){return this.socket.emit("client event",{channel:this.name,event:"client-".concat(t),data:o}),this}},{key:"leaving",value:function(t){return this.on("presence:leaving",function(o){return t(o.user_info)}),this}}]),l}(je),Ht=function(f){lt(l,f);var h=ft(l);function l(){return ot(this,l),h.apply(this,arguments)}return st(l,[{key:"subscribe",value:function(){}},{key:"unsubscribe",value:function(){}},{key:"listen",value:function(t,o){return this}},{key:"listenToAll",value:function(t){return this}},{key:"stopListening",value:function(t,o){return this}},{key:"subscribed",value:function(t){return this}},{key:"error",value:function(t){return this}},{key:"on",value:function(t,o){return this}}]),l}(_t),Se=function(f){lt(l,f);var h=ft(l);function l(){return ot(this,l),h.apply(this,arguments)}return st(l,[{key:"whisper",value:function(t,o){return this}}]),l}(Ht),Mn=function(f){lt(l,f);var h=ft(l);function l(){return ot(this,l),h.apply(this,arguments)}return st(l,[{key:"here",value:function(t){return this}},{key:"joining",value:function(t){return this}},{key:"whisper",value:function(t,o){return this}},{key:"leaving",value:function(t){return this}}]),l}(Ht),Vt=function(){function f(h){ot(this,f),this._defaultOptions={auth:{headers:{}},authEndpoint:"/broadcasting/auth",userAuthentication:{endpoint:"/broadcasting/user-auth",headers:{}},broadcaster:"pusher",csrfToken:null,bearerToken:null,host:null,key:null,namespace:"App.Events"},this.setOptions(h),this.connect()}return st(f,[{key:"setOptions",value:function(l){this.options=gt(this._defaultOptions,l);var e=this.csrfToken();return e&&(this.options.auth.headers["X-CSRF-TOKEN"]=e,this.options.userAuthentication.headers["X-CSRF-TOKEN"]=e),e=this.options.bearerToken,e&&(this.options.auth.headers.Authorization="Bearer "+e,this.options.userAuthentication.headers.Authorization="Bearer "+e),l}},{key:"csrfToken",value:function(){var l;return typeof window<"u"&&window.Laravel&&window.Laravel.csrfToken?window.Laravel.csrfToken:this.options.csrfToken?this.options.csrfToken:typeof document<"u"&&typeof document.querySelector=="function"&&(l=document.querySelector('meta[name="csrf-token"]'))?l.getAttribute("content"):null}}]),f}(),xn=function(f){lt(l,f);var h=ft(l);function l(){var e;return ot(this,l),e=h.apply(this,arguments),e.channels={},e}return st(l,[{key:"connect",value:function(){typeof this.options.client<"u"?this.pusher=this.options.client:this.options.Pusher?this.pusher=new this.options.Pusher(this.options.key,this.options):this.pusher=new Pusher(this.options.key,this.options)}},{key:"signin",value:function(){this.pusher.signin()}},{key:"listen",value:function(t,o,n){return this.channel(t).listen(o,n)}},{key:"channel",value:function(t){return this.channels[t]||(this.channels[t]=new Wt(this.pusher,t,this.options)),this.channels[t]}},{key:"privateChannel",value:function(t){return this.channels["private-"+t]||(this.channels["private-"+t]=new Tn(this.pusher,"private-"+t,this.options)),this.channels["private-"+t]}},{key:"encryptedPrivateChannel",value:function(t){return this.channels["private-encrypted-"+t]||(this.channels["private-encrypted-"+t]=new wn(this.pusher,"private-encrypted-"+t,this.options)),this.channels["private-encrypted-"+t]}},{key:"presenceChannel",value:function(t){return this.channels["presence-"+t]||(this.channels["presence-"+t]=new In(this.pusher,"presence-"+t,this.options)),this.channels["presence-"+t]}},{key:"leave",value:function(t){var o=this,n=[t,"private-"+t,"private-encrypted-"+t,"presence-"+t];n.forEach(function(m,C){o.leaveChannel(m)})}},{key:"leaveChannel",value:function(t){this.channels[t]&&(this.channels[t].unsubscribe(),delete this.channels[t])}},{key:"socketId",value:function(){return this.pusher.connection.socket_id}},{key:"disconnect",value:function(){this.pusher.disconnect()}}]),l}(Vt),Ln=function(f){lt(l,f);var h=ft(l);function l(){var e;return ot(this,l),e=h.apply(this,arguments),e.channels={},e}return st(l,[{key:"connect",value:function(){var t=this,o=this.getSocketIO();return this.socket=o(this.options.host,this.options),this.socket.on("reconnect",function(){Object.values(t.channels).forEach(function(n){n.subscribe()})}),this.socket}},{key:"getSocketIO",value:function(){if(typeof this.options.client<"u")return this.options.client;if(typeof io<"u")return io;throw new Error("Socket.io client not found. Should be globally available or passed via options.client")}},{key:"listen",value:function(t,o,n){return this.channel(t).listen(o,n)}},{key:"channel",value:function(t){return this.channels[t]||(this.channels[t]=new ke(this.socket,t,this.options)),this.channels[t]}},{key:"privateChannel",value:function(t){return this.channels["private-"+t]||(this.channels["private-"+t]=new je(this.socket,"private-"+t,this.options)),this.channels["private-"+t]}},{key:"presenceChannel",value:function(t){return this.channels["presence-"+t]||(this.channels["presence-"+t]=new Pn(this.socket,"presence-"+t,this.options)),this.channels["presence-"+t]}},{key:"leave",value:function(t){var o=this,n=[t,"private-"+t,"presence-"+t];n.forEach(function(m){o.leaveChannel(m)})}},{key:"leaveChannel",value:function(t){this.channels[t]&&(this.channels[t].unsubscribe(),delete this.channels[t])}},{key:"socketId",value:function(){return this.socket.id}},{key:"disconnect",value:function(){this.socket.disconnect()}}]),l}(Vt),Dn=function(f){lt(l,f);var h=ft(l);function l(){var e;return ot(this,l),e=h.apply(this,arguments),e.channels={},e}return st(l,[{key:"connect",value:function(){}},{key:"listen",value:function(t,o,n){return new Ht}},{key:"channel",value:function(t){return new Ht}},{key:"privateChannel",value:function(t){return new Se}},{key:"encryptedPrivateChannel",value:function(t){return new Se}},{key:"presenceChannel",value:function(t){return new Mn}},{key:"leave",value:function(t){}},{key:"leaveChannel",value:function(t){}},{key:"socketId",value:function(){return"fake-socket-id"}},{key:"disconnect",value:function(){}}]),l}(Vt),Ge=function(f){lt(l,f);var h=ft(l);function l(){var e;return ot(this,l),e=h.apply(this,arguments),e.channels={},e}return st(l,[{key:"connect",value:function(){typeof this.options.client<"u"?this.ably=this.options.client:(this.ablyAuth=new En(this.options),this.options.agents||(this.options.agents={}),this.options.agents["laravel-echo"]=l.LIB_VERSION,this.ably=new Ably.Realtime(gt(gt({},this.ablyAuth.options),this.options)),this.ablyAuth.enableAuthorizeBeforeChannelAttach(this))}},{key:"listen",value:function(t,o,n){return this.channel(t).listen(o,n)}},{key:"channel",value:function(t){var o="public:".concat(t);return this.channels[o]||(this.channels[o]=new de(this.ably,o,this.options)),this.channels[o]}},{key:"privateChannel",value:function(t){var o="private:".concat(t);return this.channels[o]||(this.channels[o]=new gn(this.ably,o,this.options,this.ablyAuth)),this.channels[o]}},{key:"presenceChannel",value:function(t){var o="presence:".concat(t);return this.channels[o]||(this.channels[o]=new Ue(this.ably,o,this.options,this.ablyAuth)),this.channels[o]}},{key:"leave",value:function(t){var o=this,n=["public:".concat(t),"private:".concat(t),"presence:".concat(t)];n.forEach(function(m,C){o.leaveChannel(m)})}},{key:"leaveChannel",value:function(t){if(t.indexOf("public:")!==0&&t.indexOf("private:")!==0&&t.indexOf("presence:")!==0)throw new Error("Error leaving ".concat(t,', name should be prefixed with either "public:", "private:" or "presence:"'));this.channels[t]&&(this.channels[t].unsubscribe(),this.ablyAuth.setExpired(t),delete this.channels[t])}},{key:"socketId",value:function(){return this.ably.connection.key}},{key:"disconnect",value:function(){this.ably.close()}}]),l}(Vt);Ge.LIB_VERSION="1.0.3";var Nn=function(){function f(h){ot(this,f),this.options=h,this.connect(),this.options.withoutInterceptors||this.registerInterceptors()}return st(f,[{key:"channel",value:function(l){return this.connector.channel(l)}},{key:"connect",value:function(){this.options.broadcaster=="ably"?this.connector=new Ge(this.options):this.options.broadcaster=="pusher"?this.connector=new xn(this.options):this.options.broadcaster=="socket.io"?this.connector=new Ln(this.options):this.options.broadcaster=="null"?this.connector=new Dn(this.options):typeof this.options.broadcaster=="function"&&(this.connector=new this.options.broadcaster(this.options))}},{key:"disconnect",value:function(){this.connector.disconnect()}},{key:"join",value:function(l){return this.connector.presenceChannel(l)}},{key:"leave",value:function(l){this.connector.leave(l)}},{key:"leaveChannel",value:function(l){this.connector.leaveChannel(l)}},{key:"leaveAllChannels",value:function(){for(var l in this.connector.channels)this.leaveChannel(l)}},{key:"listen",value:function(l,e,t){return this.connector.listen(l,e,t)}},{key:"private",value:function(l){return this.connector.privateChannel(l)}},{key:"encryptedPrivate",value:function(l){return this.connector.encryptedPrivateChannel(l)}},{key:"socketId",value:function(){return this.connector.socketId()}},{key:"registerInterceptors",value:function(){typeof Vue=="function"&&Vue.http&&this.registerVueRequestInterceptor(),typeof axios=="function"&&this.registerAxiosRequestInterceptor(),typeof jQuery=="function"&&this.registerjQueryAjaxSetup(),(typeof Turbo>"u"?"undefined":kt(Turbo))==="object"&&this.registerTurboRequestInterceptor()}},{key:"registerVueRequestInterceptor",value:function(){var l=this;Vue.http.interceptors.push(function(e,t){l.socketId()&&e.headers.set("X-Socket-ID",l.socketId()),t()})}},{key:"registerAxiosRequestInterceptor",value:function(){var l=this;axios.interceptors.request.use(function(e){return l.socketId()&&(e.headers["X-Socket-Id"]=l.socketId()),e})}},{key:"registerjQueryAjaxSetup",value:function(){var l=this;typeof jQuery.ajax<"u"&&jQuery.ajaxPrefilter(function(e,t,o){l.socketId()&&o.setRequestHeader("X-Socket-Id",l.socketId())})}},{key:"registerTurboRequestInterceptor",value:function(){var l=this;document.addEventListener("turbo:before-fetch-request",function(e){e.detail.fetchOptions.headers["X-Socket-Id"]=l.socketId()})}}]),f}();function Un(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}var He={exports:{}};/*!
 * @license Copyright 2015-2022 Ably Real-time Ltd (ably.com)
 * 
 * Ably JavaScript Library v1.2.48
 * https://github.com/ably/ably-js
 * 
 * Released under the Apache Licence v2.0
 */(function(f,h){(function(e,t){f.exports=t()})(window,function(){return function(l){var e={};function t(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return l[o].call(n.exports,n,n.exports,t),n.l=!0,n.exports}return t.m=l,t.c=e,t.d=function(o,n,m){t.o(o,n)||Object.defineProperty(o,n,{enumerable:!0,get:m})},t.r=function(o){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},t.t=function(o,n){if(n&1&&(o=t(o)),n&8||n&4&&typeof o=="object"&&o&&o.__esModule)return o;var m=Object.create(null);if(t.r(m),Object.defineProperty(m,"default",{enumerable:!0,value:o}),n&2&&typeof o!="string")for(var C in o)t.d(m,C,(function(S){return o[S]}).bind(null,C));return m},t.n=function(o){var n=o&&o.__esModule?function(){return o.default}:function(){return o};return t.d(n,"a",n),n},t.o=function(o,n){return Object.prototype.hasOwnProperty.call(o,n)},t.p="",t(t.s=42)}([function(l,e,t){t.r(e),t.d(e,"__extends",function(){return n}),t.d(e,"__assign",function(){return m}),t.d(e,"__rest",function(){return C}),t.d(e,"__decorate",function(){return S}),t.d(e,"__param",function(){return O}),t.d(e,"__metadata",function(){return P}),t.d(e,"__awaiter",function(){return A}),t.d(e,"__generator",function(){return b}),t.d(e,"__createBinding",function(){return a}),t.d(e,"__exportStar",function(){return g}),t.d(e,"__values",function(){return L}),t.d(e,"__read",function(){return x}),t.d(e,"__spread",function(){return p}),t.d(e,"__spreadArrays",function(){return y}),t.d(e,"__spreadArray",function(){return R}),t.d(e,"__await",function(){return c}),t.d(e,"__asyncGenerator",function(){return u}),t.d(e,"__asyncDelegator",function(){return r}),t.d(e,"__asyncValues",function(){return i}),t.d(e,"__makeTemplateObject",function(){return v}),t.d(e,"__importStar",function(){return d}),t.d(e,"__importDefault",function(){return N}),t.d(e,"__classPrivateFieldGet",function(){return D}),t.d(e,"__classPrivateFieldSet",function(){return M});/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var o=function(T,E){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(I,j){I.__proto__=j}||function(I,j){for(var k in j)Object.prototype.hasOwnProperty.call(j,k)&&(I[k]=j[k])},o(T,E)};function n(T,E){if(typeof E!="function"&&E!==null)throw new TypeError("Class extends value "+String(E)+" is not a constructor or null");o(T,E);function I(){this.constructor=T}T.prototype=E===null?Object.create(E):(I.prototype=E.prototype,new I)}var m=function(){return m=Object.assign||function(E){for(var I,j=1,k=arguments.length;j<k;j++){I=arguments[j];for(var H in I)Object.prototype.hasOwnProperty.call(I,H)&&(E[H]=I[H])}return E},m.apply(this,arguments)};function C(T,E){var I={};for(var j in T)Object.prototype.hasOwnProperty.call(T,j)&&E.indexOf(j)<0&&(I[j]=T[j]);if(T!=null&&typeof Object.getOwnPropertySymbols=="function")for(var k=0,j=Object.getOwnPropertySymbols(T);k<j.length;k++)E.indexOf(j[k])<0&&Object.prototype.propertyIsEnumerable.call(T,j[k])&&(I[j[k]]=T[j[k]]);return I}function S(T,E,I,j){var k=arguments.length,H=k<3?E:j===null?j=Object.getOwnPropertyDescriptor(E,I):j,V;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")H=Reflect.decorate(T,E,I,j);else for(var z=T.length-1;z>=0;z--)(V=T[z])&&(H=(k<3?V(H):k>3?V(E,I,H):V(E,I))||H);return k>3&&H&&Object.defineProperty(E,I,H),H}function O(T,E){return function(I,j){E(I,j,T)}}function P(T,E){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(T,E)}function A(T,E,I,j){function k(H){return H instanceof I?H:new I(function(V){V(H)})}return new(I||(I=Promise))(function(H,V){function z(U){try{w(j.next(U))}catch(B){V(B)}}function _(U){try{w(j.throw(U))}catch(B){V(B)}}function w(U){U.done?H(U.value):k(U.value).then(z,_)}w((j=j.apply(T,E||[])).next())})}function b(T,E){var I={label:0,sent:function(){if(H[0]&1)throw H[1];return H[1]},trys:[],ops:[]},j,k,H,V;return V={next:z(0),throw:z(1),return:z(2)},typeof Symbol=="function"&&(V[Symbol.iterator]=function(){return this}),V;function z(w){return function(U){return _([w,U])}}function _(w){if(j)throw new TypeError("Generator is already executing.");for(;I;)try{if(j=1,k&&(H=w[0]&2?k.return:w[0]?k.throw||((H=k.return)&&H.call(k),0):k.next)&&!(H=H.call(k,w[1])).done)return H;switch(k=0,H&&(w=[w[0]&2,H.value]),w[0]){case 0:case 1:H=w;break;case 4:return I.label++,{value:w[1],done:!1};case 5:I.label++,k=w[1],w=[0];continue;case 7:w=I.ops.pop(),I.trys.pop();continue;default:if(H=I.trys,!(H=H.length>0&&H[H.length-1])&&(w[0]===6||w[0]===2)){I=0;continue}if(w[0]===3&&(!H||w[1]>H[0]&&w[1]<H[3])){I.label=w[1];break}if(w[0]===6&&I.label<H[1]){I.label=H[1],H=w;break}if(H&&I.label<H[2]){I.label=H[2],I.ops.push(w);break}H[2]&&I.ops.pop(),I.trys.pop();continue}w=E.call(T,I)}catch(U){w=[6,U],k=0}finally{j=H=0}if(w[0]&5)throw w[1];return{value:w[0]?w[1]:void 0,done:!0}}}var a=Object.create?function(T,E,I,j){j===void 0&&(j=I),Object.defineProperty(T,j,{enumerable:!0,get:function(){return E[I]}})}:function(T,E,I,j){j===void 0&&(j=I),T[j]=E[I]};function g(T,E){for(var I in T)I!=="default"&&!Object.prototype.hasOwnProperty.call(E,I)&&a(E,T,I)}function L(T){var E=typeof Symbol=="function"&&Symbol.iterator,I=E&&T[E],j=0;if(I)return I.call(T);if(T&&typeof T.length=="number")return{next:function(){return T&&j>=T.length&&(T=void 0),{value:T&&T[j++],done:!T}}};throw new TypeError(E?"Object is not iterable.":"Symbol.iterator is not defined.")}function x(T,E){var I=typeof Symbol=="function"&&T[Symbol.iterator];if(!I)return T;var j=I.call(T),k,H=[],V;try{for(;(E===void 0||E-- >0)&&!(k=j.next()).done;)H.push(k.value)}catch(z){V={error:z}}finally{try{k&&!k.done&&(I=j.return)&&I.call(j)}finally{if(V)throw V.error}}return H}function p(){for(var T=[],E=0;E<arguments.length;E++)T=T.concat(x(arguments[E]));return T}function y(){for(var T=0,E=0,I=arguments.length;E<I;E++)T+=arguments[E].length;for(var j=Array(T),k=0,E=0;E<I;E++)for(var H=arguments[E],V=0,z=H.length;V<z;V++,k++)j[k]=H[V];return j}function R(T,E,I){if(I||arguments.length===2)for(var j=0,k=E.length,H;j<k;j++)(H||!(j in E))&&(H||(H=Array.prototype.slice.call(E,0,j)),H[j]=E[j]);return T.concat(H||Array.prototype.slice.call(E))}function c(T){return this instanceof c?(this.v=T,this):new c(T)}function u(T,E,I){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var j=I.apply(T,E||[]),k,H=[];return k={},V("next"),V("throw"),V("return"),k[Symbol.asyncIterator]=function(){return this},k;function V(G){j[G]&&(k[G]=function(W){return new Promise(function(Q,$){H.push([G,W,Q,$])>1||z(G,W)})})}function z(G,W){try{_(j[G](W))}catch(Q){B(H[0][3],Q)}}function _(G){G.value instanceof c?Promise.resolve(G.value.v).then(w,U):B(H[0][2],G)}function w(G){z("next",G)}function U(G){z("throw",G)}function B(G,W){G(W),H.shift(),H.length&&z(H[0][0],H[0][1])}}function r(T){var E,I;return E={},j("next"),j("throw",function(k){throw k}),j("return"),E[Symbol.iterator]=function(){return this},E;function j(k,H){E[k]=T[k]?function(V){return(I=!I)?{value:c(T[k](V)),done:k==="return"}:H?H(V):V}:H}}function i(T){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var E=T[Symbol.asyncIterator],I;return E?E.call(T):(T=typeof L=="function"?L(T):T[Symbol.iterator](),I={},j("next"),j("throw"),j("return"),I[Symbol.asyncIterator]=function(){return this},I);function j(H){I[H]=T[H]&&function(V){return new Promise(function(z,_){V=T[H](V),k(z,_,V.done,V.value)})}}function k(H,V,z,_){Promise.resolve(_).then(function(w){H({value:w,done:z})},V)}}function v(T,E){return Object.defineProperty?Object.defineProperty(T,"raw",{value:E}):T.raw=E,T}var s=Object.create?function(T,E){Object.defineProperty(T,"default",{enumerable:!0,value:E})}:function(T,E){T.default=E};function d(T){if(T&&T.__esModule)return T;var E={};if(T!=null)for(var I in T)I!=="default"&&Object.prototype.hasOwnProperty.call(T,I)&&a(E,T,I);return s(E,T),E}function N(T){return T&&T.__esModule?T:{default:T}}function D(T,E,I,j){if(I==="a"&&!j)throw new TypeError("Private accessor was defined without a getter");if(typeof E=="function"?T!==E||!j:!E.has(T))throw new TypeError("Cannot read private member from an object whose class did not declare it");return I==="m"?j:I==="a"?j.call(T):j?j.value:E.get(T)}function M(T,E,I,j,k){if(j==="m")throw new TypeError("Private method is not writable");if(j==="a"&&!k)throw new TypeError("Private accessor was defined without a setter");if(typeof E=="function"?T!==E||!k:!E.has(T))throw new TypeError("Cannot write private member to an object whose class did not declare it");return j==="a"?k.call(T,I):k?k.value=I:E.set(T,I),I}},function(l,e,t){(function(o){Object.defineProperty(e,"__esModule",{value:!0}),e.allToUpperCase=e.allToLowerCase=e.encodeBody=e.decodeBody=e.Format=e.promisify=e.trim=e.arrChooseN=e.randomHexString=e.randomString=e.cheapRandStr=e.dataSizeBytes=e.inspectBody=e.inspectError=e.isErrorInfoOrPartialErrorInfo=e.now=e.parseQueryString=e.toQueryString=e.arrPopRandomElement=e.defaultPostHeaders=e.defaultGetHeaders=e.allSame=e.arrEvery=e.arrFilter=e.arrMap=e.safeArrForEach=e.arrForEach=e.forInOwnNonNullProperties=e.valuesArray=e.keysArray=e.arrWithoutValue=e.arrDeleteValue=e.arrIn=e.arrIndexOf=e.arrSubtract=e.arrIntersectOb=e.arrIntersect=e.intersect=e.containsValue=e.inherits=e.prototypicalClone=e.shallowClone=e.isEmptyArg=e.isOnlyPropIn=e.isEmpty=e.isObject=e.ensureArray=e.isArray=e.copy=e.mixin=void 0,e.arrEquals=e.toBase64=e.matchDerivedChannel=e.shallowEquals=e.getGlobalObject=e.getRetryTime=e.getJitterCoefficient=e.getBackoffCoefficient=void 0;var n=t(0),m=n.__importDefault(t(3)),C=n.__importStar(t(8)),S=n.__importDefault(t(4)),O=t(11),P=t(31);function A(F){return Math.floor(Math.random()*F.length)}function b(F){for(var K=[],q=1;q<arguments.length;q++)K[q-1]=arguments[q];for(var Y=0;Y<K.length;Y++){var et=K[Y];if(!et)break;var ht=Object.prototype.hasOwnProperty;for(var Tt in et)(!ht||ht.call(et,Tt))&&(F[Tt]=et[Tt])}return F}e.mixin=b;function a(F){return b({},F)}e.copy=a,e.isArray=Array.isArray||function(F){return Object.prototype.toString.call(F)=="[object Array]"};function g(F){return y(F)?[]:(0,e.isArray)(F)?F:[F]}e.ensureArray=g;function L(F){return Object.prototype.toString.call(F)=="[object Object]"}e.isObject=L;function x(F){for(var K in F)return!1;return!0}e.isEmpty=x;function p(F,K){for(var q in F)if(q!==K)return!1;return!0}e.isOnlyPropIn=p;function y(F){return F==null}e.isEmptyArg=y;function R(F){var K=new Object;for(var q in F)K[q]=F[q];return K}e.shallowClone=R;function c(F,K){var q=function(){function et(){}return et}();q.prototype=F;var Y=new q;return K&&b(Y,K),Y}e.prototypicalClone=c;var u=function(F,K){if(m.default.Config.inherits){m.default.Config.inherits(F,K);return}F.super_=K,F.prototype=c(K.prototype,{constructor:F})};e.inherits=u;function r(F,K){for(var q in F)if(F[q]==K)return!0;return!1}e.containsValue=r;function i(F,K){return(0,e.isArray)(K)?v(F,K):s(F,K)}e.intersect=i;function v(F,K){for(var q=[],Y=0;Y<F.length;Y++){var et=F[Y];(0,e.arrIndexOf)(K,et)!=-1&&q.push(et)}return q}e.arrIntersect=v;function s(F,K){for(var q=[],Y=0;Y<F.length;Y++){var et=F[Y];et in K&&q.push(et)}return q}e.arrIntersectOb=s;function d(F,K){for(var q=[],Y=0;Y<F.length;Y++){var et=F[Y];(0,e.arrIndexOf)(K,et)==-1&&q.push(et)}return q}e.arrSubtract=d,e.arrIndexOf=Array.prototype.indexOf?function(F,K,q){return F.indexOf(K,q)}:function(F,K,q){q=q||0;for(var Y=F.length;q<Y;q++)if(F[q]===K)return q;return-1};function N(F,K){return(0,e.arrIndexOf)(F,K)!==-1}e.arrIn=N;function D(F,K){var q=(0,e.arrIndexOf)(F,K),Y=q!=-1;return Y&&F.splice(q,1),Y}e.arrDeleteValue=D;function M(F,K){var q=F.slice();return D(q,K),q}e.arrWithoutValue=M;function T(F,K){var q=[];for(var Y in F)K&&!Object.prototype.hasOwnProperty.call(F,Y)||q.push(Y);return q}e.keysArray=T;function E(F,K){var q=[];for(var Y in F)K&&!Object.prototype.hasOwnProperty.call(F,Y)||q.push(F[Y]);return q}e.valuesArray=E;function I(F,K){for(var q in F)Object.prototype.hasOwnProperty.call(F,q)&&F[q]&&K(q)}e.forInOwnNonNullProperties=I,e.arrForEach=Array.prototype.forEach?function(F,K){F.forEach(K)}:function(F,K){for(var q=F.length,Y=0;Y<q;Y++)K(F[Y],Y,F)};function j(F,K){return(0,e.arrForEach)(F.slice(),K)}e.safeArrForEach=j,e.arrMap=Array.prototype.map?function(F,K){return F.map(K)}:function(F,K){for(var q=[],Y=F.length,et=0;et<Y;et++)q.push(K(F[et],et,F));return q},e.arrFilter=Array.prototype.filter?function(F,K){return F.filter(K)}:function(F,K){for(var q=[],Y=F.length,et=0;et<Y;et++)K(F[et])&&q.push(F[et]);return q},e.arrEvery=Array.prototype.every?function(F,K){return F.every(K)}:function(F,K){for(var q=F.length,Y=0;Y<q;Y++)if(!K(F[Y],Y,F))return!1;return!0};function k(F,K){if(F.length===0)return!0;var q=F[0][K];return(0,e.arrEvery)(F,function(Y){return Y[K]===q})}e.allSame=k;var H={json:"application/json",jsonp:"application/javascript",xml:"application/xml",html:"text/html",msgpack:"application/x-msgpack"};function V(F,K){var q=H[K||it.json];return{accept:q,"X-Ably-Version":C.default.protocolVersion.toString(),"Ably-Agent":(0,C.getAgentString)(F)}}e.defaultGetHeaders=V;function z(F,K){var q,Y=q=H[K||it.json];return{accept:Y,"content-type":q,"X-Ably-Version":C.default.protocolVersion.toString(),"Ably-Agent":(0,C.getAgentString)(F)}}e.defaultPostHeaders=z;function _(F){return F.splice(A(F),1)[0]}e.arrPopRandomElement=_;function w(F){var K=[];if(F)for(var q in F)K.push(encodeURIComponent(q)+"="+encodeURIComponent(F[q]));return K.length?"?"+K.join("&"):""}e.toQueryString=w;function U(F){for(var K,q=/([^?&=]+)=?([^&]*)/g,Y={};K=q.exec(F);)Y[decodeURIComponent(K[1])]=decodeURIComponent(K[2]);return Y}e.parseQueryString=U,e.now=Date.now||function(){return new Date().getTime()};function B(F){return typeof F=="object"&&F!==null&&(F.constructor.name=="ErrorInfo"||F.constructor.name=="PartialErrorInfo")}e.isErrorInfoOrPartialErrorInfo=B;function G(F){var K,q;return F instanceof Error||((K=F==null?void 0:F.constructor)===null||K===void 0?void 0:K.name)==="ErrorInfo"||((q=F==null?void 0:F.constructor)===null||q===void 0?void 0:q.name)==="PartialErrorInfo"?F.toString():m.default.Config.inspect(F)}e.inspectError=G;function W(F){return m.default.BufferUtils.isBuffer(F)?F.toString():typeof F=="string"?F:m.default.Config.inspect(F)}e.inspectBody=W;function Q(F){if(m.default.BufferUtils.isBuffer(F))return m.default.BufferUtils.byteLength(F);if(typeof F=="string")return m.default.Config.stringByteSize(F);throw new Error("Expected input of Utils.dataSizeBytes to be a buffer or string, but was: "+typeof F)}e.dataSizeBytes=Q;function $(){return String(Math.random()).substr(2)}e.cheapRandStr=$;var Z=function(F){if(m.default.Config.getRandomValues&&typeof Uint8Array<"u"){var K=new Uint8Array(F);return m.default.Config.getRandomValues(K),m.default.BufferUtils.base64Encode(K)}for(var q=m.default.BufferUtils.base64CharSet,Y=Math.round(F*4/3),et="",ht=0;ht<Y;ht++)et+=q[A(q)];return et};e.randomString=Z;var tt=function(F){if(m.default.Config.getRandomValues&&typeof Uint8Array<"u"){var K=new Uint8Array(F);return m.default.Config.getRandomValues(K),m.default.BufferUtils.hexEncode(K)}for(var q=m.default.BufferUtils.hexCharSet,Y=F*2,et="",ht=0;ht<Y;ht++)et+=q[A(q)];return et};e.randomHexString=tt;function rt(F,K){for(var q=Math.min(K,F.length),Y=F.slice(),et=[],ht=0;ht<q;ht++)et.push(_(Y));return et}e.arrChooseN=rt,e.trim=String.prototype.trim?function(F){return F.trim()}:function(F){return F.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")};function X(F,K,q){return new Promise(function(Y,et){F[K].apply(F,n.__spreadArray(n.__spreadArray([],q,!1),[function(ht,Tt){ht?et(ht):Y(Tt)}],!1))})}e.promisify=X;var it;(function(F){F.msgpack="msgpack",F.json="json"})(it=e.Format||(e.Format={}));function ct(F,K){return K=="msgpack"?m.default.Config.msgpack.decode(F):JSON.parse(String(F))}e.decodeBody=ct;function dt(F,K){return K=="msgpack"?m.default.Config.msgpack.encode(F,!0):JSON.stringify(F)}e.encodeBody=dt;function ut(F){return F.map(function(K){return K&&K.toLowerCase()})}e.allToLowerCase=ut;function Ot(F){return F.map(function(K){return K&&K.toUpperCase()})}e.allToUpperCase=Ot;function xt(F){return Math.min((F+2)/3,2)}e.getBackoffCoefficient=xt;function vt(){return 1-Math.random()*.2}e.getJitterCoefficient=vt;function Lt(F,K){return F*xt(K)*vt()}e.getRetryTime=Lt;function $t(){return o||(typeof window<"u"?window:self)}e.getGlobalObject=$t;function Xt(F,K){return Object.keys(F).every(function(q){return F[q]===K[q]})&&Object.keys(K).every(function(q){return K[q]===F[q]})}e.shallowEquals=Xt;function cn(F){var K=/^(\[([^?]*)(?:(.*))\])?(.+)$/,q=F.match(K);if(!q||!q.length||q.length<5)throw new S.default("regex match failed",400,40010);if(q[2])throw new S.default("cannot use a derived option with a ".concat(q[2]," channel"),400,40010);return{qualifierParam:q[3]||"",channelName:q[4]}}e.matchDerivedChannel=cn;function ln(F){return m.default.Config.createHmac?Buffer.from(F,"ascii").toString("base64"):(0,O.stringify)((0,P.parse)(F))}e.toBase64=ln;function fn(F,K){return F.length===K.length&&(0,e.arrEvery)(F,function(q,Y){return q===K[Y]})}e.arrEquals=fn}).call(this,t(13))},function(l,e,t){(function(o){Object.defineProperty(e,"__esModule",{value:!0});var n=t(0),m=n.__importDefault(t(3)),C=o||(typeof window<"u"?window:self),S;(function(a){a[a.None=0]="None",a[a.Error=1]="Error",a[a.Major=2]="Major",a[a.Minor=3]="Minor",a[a.Micro=4]="Micro"})(S||(S={}));function O(a,g){return"".concat(a).padStart(g?3:2,"0")}function P(a){return m.default.Config.logTimestamps?function(g){var L=new Date;a(O(L.getHours())+":"+O(L.getMinutes())+":"+O(L.getSeconds())+"."+O(L.getMilliseconds(),1)+" "+g)}:a}var A=function(){var a,g,L,x;return typeof Window>"u"&&typeof WorkerGlobalScope>"u"||typeof((g=(a=C==null?void 0:C.console)===null||a===void 0?void 0:a.log)===null||g===void 0?void 0:g.apply)=="function"?(L=function(){for(var p=[],y=0;y<arguments.length;y++)p[y]=arguments[y];console.log.apply(console,p)},x=console.warn?function(){for(var p=[],y=0;y<arguments.length;y++)p[y]=arguments[y];console.warn.apply(console,p)}:L):C!=null&&C.console.log?L=x=function(){Function.prototype.apply.call(console.log,console,arguments)}:L=x=function(){},[L,x].map(P)},b=function(){function a(){a.logLevel=a.LOG_DEFAULT}return a.initLogHandlers=function(){var g=A(),L=g[0],x=g[1];this.logHandler=L,this.logErrorHandler=x},a.logLevel=S.Error,a.LOG_NONE=S.None,a.LOG_ERROR=S.Error,a.LOG_MAJOR=S.Major,a.LOG_MINOR=S.Minor,a.LOG_MICRO=S.Micro,a.LOG_DEFAULT=S.Error,a.LOG_DEBUG=S.Micro,a.logAction=function(g,L,x){a.shouldLog(g)&&(g===S.Error?a.logErrorHandler:a.logHandler)("Ably: "+L+": "+x)},a.deprecated=function(g,L){a.deprecatedWithMsg(g,"Please use '"+L+"' instead.")},a.deprecatedWithMsg=function(g,L){a.shouldLog(S.Error)&&a.logErrorHandler("Ably: Deprecation warning - '"+g+"' is deprecated and will be removed from a future version. "+L)},a.shouldLog=function(g){return g<=a.logLevel},a.setLog=function(g,L){g!==void 0&&(a.logLevel=g),L!==void 0&&(a.logHandler=a.logErrorHandler=L)},a}();e.default=b}).call(this,t(13))},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function n(){}return n}();e.default=o},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.PartialErrorInfo=void 0;var o=t(0),n=o.__importDefault(t(3)),m=o.__importStar(t(1));function C(P){var A="["+P.constructor.name;return P.message&&(A+=": "+P.message),P.statusCode&&(A+="; statusCode="+P.statusCode),P.code&&(A+="; code="+P.code),P.cause&&(A+="; cause="+m.inspectError(P.cause)),P.href&&!(P.message&&P.message.indexOf("help.ably.io")>-1)&&(A+="; see "+P.href+" "),A+="]",A}var S=function(P){o.__extends(A,P);function A(b,a,g,L){var x=P.call(this,b)||this;return typeof Object.setPrototypeOf<"u"&&Object.setPrototypeOf(x,A.prototype),x.code=a,x.statusCode=g,x.cause=L,x}return A.prototype.toString=function(){return C(this)},A.fromValues=function(b){var a=b,g=a.message,L=a.code,x=a.statusCode;if(typeof g!="string"||typeof L!="number"||typeof x!="number")throw new Error("ErrorInfo.fromValues(): invalid values: "+n.default.Config.inspect(b));var p=Object.assign(new A(g,L,x),b);return p.code&&!p.href&&(p.href="https://help.ably.io/error/"+p.code),p},A}(Error);e.default=S;var O=function(P){o.__extends(A,P);function A(b,a,g,L){var x=P.call(this,b)||this;return typeof Object.setPrototypeOf<"u"&&Object.setPrototypeOf(x,A.prototype),x.code=a,x.statusCode=g,x.cause=L,x}return A.prototype.toString=function(){return C(this)},A}(Error);e.PartialErrorInfo=O},function(l,e,t){(function(o,n){l.exports=n(t(6))})(this,function(o){return function(){if(typeof ArrayBuffer=="function"){var n=o,m=n.lib,C=m.WordArray,S=C.init,O=C.init=function(P){if(P instanceof ArrayBuffer&&(P=new Uint8Array(P)),(P instanceof Int8Array||typeof Uint8ClampedArray<"u"&&P instanceof Uint8ClampedArray||P instanceof Int16Array||P instanceof Uint16Array||P instanceof Int32Array||P instanceof Uint32Array||P instanceof Float32Array||P instanceof Float64Array)&&(P=new Uint8Array(P.buffer,P.byteOffset,P.byteLength)),P instanceof Uint8Array){for(var A=P.byteLength,b=[],a=0;a<A;a++)b[a>>>2]|=P[a]<<24-a%4*8;S.call(this,b,A)}else S.apply(this,arguments)};O.prototype=C}}(),o.lib.WordArray})},function(l,e,t){(function(o){(function(n,m){l.exports=m()})(this,function(){var n=n||function(m,C){var S;if(typeof window<"u"&&window.crypto&&(S=window.crypto),!S&&typeof window<"u"&&window.msCrypto&&(S=window.msCrypto),!S&&typeof o<"u"&&o.crypto&&(S=o.crypto),!S)try{S=t(44)}catch{}var O=function(){if(S){if(typeof S.getRandomValues=="function")try{return S.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof S.randomBytes=="function")try{return S.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},P=Object.create||function(){function u(){}return function(r){var i;return u.prototype=r,i=new u,u.prototype=null,i}}(),A={},b=A.lib={},a=b.Base=function(){return{extend:function(u){var r=P(this);return u&&r.mixIn(u),(!r.hasOwnProperty("init")||this.init===r.init)&&(r.init=function(){r.$super.init.apply(this,arguments)}),r.init.prototype=r,r.$super=this,r},create:function(){var u=this.extend();return u.init.apply(u,arguments),u},init:function(){},mixIn:function(u){for(var r in u)u.hasOwnProperty(r)&&(this[r]=u[r]);u.hasOwnProperty("toString")&&(this.toString=u.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),g=b.WordArray=a.extend({init:function(u,r){u=this.words=u||[],r!=C?this.sigBytes=r:this.sigBytes=u.length*4},toString:function(u){return(u||x).stringify(this)},concat:function(u){var r=this.words,i=u.words,v=this.sigBytes,s=u.sigBytes;if(this.clamp(),v%4)for(var d=0;d<s;d++){var N=i[d>>>2]>>>24-d%4*8&255;r[v+d>>>2]|=N<<24-(v+d)%4*8}else for(var d=0;d<s;d+=4)r[v+d>>>2]=i[d>>>2];return this.sigBytes+=s,this},clamp:function(){var u=this.words,r=this.sigBytes;u[r>>>2]&=4294967295<<32-r%4*8,u.length=m.ceil(r/4)},clone:function(){var u=a.clone.call(this);return u.words=this.words.slice(0),u},random:function(u){for(var r=[],i=0;i<u;i+=4)r.push(O());return new g.init(r,u)}}),L=A.enc={},x=L.Hex={stringify:function(u){for(var r=u.words,i=u.sigBytes,v=[],s=0;s<i;s++){var d=r[s>>>2]>>>24-s%4*8&255;v.push((d>>>4).toString(16)),v.push((d&15).toString(16))}return v.join("")},parse:function(u){for(var r=u.length,i=[],v=0;v<r;v+=2)i[v>>>3]|=parseInt(u.substr(v,2),16)<<24-v%8*4;return new g.init(i,r/2)}},p=L.Latin1={stringify:function(u){for(var r=u.words,i=u.sigBytes,v=[],s=0;s<i;s++){var d=r[s>>>2]>>>24-s%4*8&255;v.push(String.fromCharCode(d))}return v.join("")},parse:function(u){for(var r=u.length,i=[],v=0;v<r;v++)i[v>>>2]|=(u.charCodeAt(v)&255)<<24-v%4*8;return new g.init(i,r)}},y=L.Utf8={stringify:function(u){try{return decodeURIComponent(escape(p.stringify(u)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(u){return p.parse(unescape(encodeURIComponent(u)))}},R=b.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new g.init,this._nDataBytes=0},_append:function(u){typeof u=="string"&&(u=y.parse(u)),this._data.concat(u),this._nDataBytes+=u.sigBytes},_process:function(u){var r,i=this._data,v=i.words,s=i.sigBytes,d=this.blockSize,N=d*4,D=s/N;u?D=m.ceil(D):D=m.max((D|0)-this._minBufferSize,0);var M=D*d,T=m.min(M*4,s);if(M){for(var E=0;E<M;E+=d)this._doProcessBlock(v,E);r=v.splice(0,M),i.sigBytes-=T}return new g.init(r,T)},clone:function(){var u=a.clone.call(this);return u._data=this._data.clone(),u},_minBufferSize:0});b.Hasher=R.extend({cfg:a.extend(),init:function(u){this.cfg=this.cfg.extend(u),this.reset()},reset:function(){R.reset.call(this),this._doReset()},update:function(u){return this._append(u),this._process(),this},finalize:function(u){u&&this._append(u);var r=this._doFinalize();return r},blockSize:16,_createHelper:function(u){return function(r,i){return new u.init(i).finalize(r)}},_createHmacHelper:function(u){return function(r,i){return new c.HMAC.init(u,i).finalize(r)}}});var c=A.algo={};return A}(Math);return n})}).call(this,t(13))},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o=t(0),n=o.__importStar(t(1)),m=o.__importDefault(t(2)),C=o.__importDefault(t(3));function S(A,b,a){try{b.apply(A,a)}catch(g){m.default.logAction(m.default.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+g+"; stack = "+(g&&g.stack))}}function O(A,b,a){for(var g,L,x,p=0;p<A.length;p++)if(g=A[p],a&&(g=g[a]),n.isArray(g)){for(;(L=n.arrIndexOf(g,b))!==-1;)g.splice(L,1);a&&g.length===0&&delete A[p][a]}else if(n.isObject(g))for(x in g)Object.prototype.hasOwnProperty.call(g,x)&&n.isArray(g[x])&&O([g],b,x)}var P=function(){function A(){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null)}return A.prototype.on=function(){for(var b=this,a=[],g=0;g<arguments.length;g++)a[g]=arguments[g];if(a.length===1){var L=a[0];if(typeof L=="function")this.any.push(L);else throw new Error("EventListener.on(): Invalid arguments: "+C.default.Config.inspect(a))}if(a.length===2){var x=a[0],p=a[1];if(typeof p!="function")throw new Error("EventListener.on(): Invalid arguments: "+C.default.Config.inspect(a));if(n.isEmptyArg(x))this.any.push(p);else if(n.isArray(x))x.forEach(function(R){b.on(R,p)});else{if(typeof x!="string")throw new Error("EventListener.on(): Invalid arguments: "+C.default.Config.inspect(a));var y=this.events[x]||(this.events[x]=[]);y.push(p)}}},A.prototype.off=function(){for(var b,a=this,g=[],L=0;L<arguments.length;L++)g[L]=arguments[L];if(g.length==0||n.isEmptyArg(g[0])&&n.isEmptyArg(g[1])){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null);return}var x=g[0],p=g[1],y=null,R=null;if(g.length===1||!p)typeof x=="function"?y=x:R=x;else{if(typeof p!="function")throw new Error("EventEmitter.off(): invalid arguments:"+C.default.Config.inspect(g));b=[x,p],R=b[0],y=b[1]}if(y&&n.isEmptyArg(R)){O([this.any,this.events,this.anyOnce,this.eventsOnce],y);return}if(n.isArray(R)){R.forEach(function(c){a.off(c,y)});return}if(typeof R!="string")throw new Error("EventEmitter.off(): invalid arguments:"+C.default.Config.inspect(g));y?O([this.events,this.eventsOnce],y,R):(delete this.events[R],delete this.eventsOnce[R])},A.prototype.listeners=function(b){if(b){var a=this.events[b]||[];return this.eventsOnce[b]&&Array.prototype.push.apply(a,this.eventsOnce[b]),a.length?a:null}return this.any.length?this.any:null},A.prototype.emit=function(b){for(var a=[],g=1;g<arguments.length;g++)a[g-1]=arguments[g];var L={event:b},x=[];this.anyOnce.length&&(Array.prototype.push.apply(x,this.anyOnce),this.anyOnce=[]),this.any.length&&Array.prototype.push.apply(x,this.any);var p=this.eventsOnce[b];p&&(Array.prototype.push.apply(x,p),delete this.eventsOnce[b]);var y=this.events[b];y&&Array.prototype.push.apply(x,y),n.arrForEach(x,function(R){S(L,R,a)})},A.prototype.once=function(){for(var b=this,a=[],g=0;g<arguments.length;g++)a[g]=arguments[g];var L=a.length;if((L===0||L===1&&typeof a[0]!="function")&&C.default.Config.Promise){var x=a[0];return new C.default.Config.Promise(function(r){b.once(x,r)})}var p=a[0],y=a[1];if(a.length===1&&typeof p=="function")this.anyOnce.push(p);else if(n.isEmptyArg(p)){if(typeof y!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+C.default.Config.inspect(a));this.anyOnce.push(y)}else if(n.isArray(p)){var R=this,c=function(){var r=Array.prototype.slice.call(arguments);if(n.arrForEach(p,function(i){R.off(i,c)}),typeof y!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+C.default.Config.inspect(a));y.apply(this,r)};n.arrForEach(p,function(r){R.on(r,c)})}else{if(typeof p!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+C.default.Config.inspect(a));var u=this.eventsOnce[p]||(this.eventsOnce[p]=[]);if(y){if(typeof y!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+C.default.Config.inspect(a));u.push(y)}}},A.prototype.whenState=function(b,a,g){for(var L=this,x=[],p=3;p<arguments.length;p++)x[p-3]=arguments[p];var y={event:b};if(typeof b!="string"||typeof a!="string")throw"whenState requires a valid event String argument";if(typeof g!="function"&&C.default.Config.Promise)return new C.default.Config.Promise(function(R){A.prototype.whenState.apply(L,[b,a,R].concat(x))});b===a?S(y,g,x):this.once(b,g)},A}();e.default=P},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.getDefaults=e.normaliseOptions=e.objectifyOptions=e.getAgentString=e.getHosts=e.getFallbackHosts=e.environmentFallbackHosts=e.getHttpScheme=e.getPort=e.getHost=void 0;var o=t(0),n=o.__importDefault(t(3)),m=o.__importStar(t(1)),C=o.__importDefault(t(2)),S=o.__importDefault(t(4)),O=t(43),P="ably-js/"+O.version,A={ENVIRONMENT:"",REST_HOST:"rest.ably.io",REALTIME_HOST:"realtime.ably.io",FALLBACK_HOSTS:["A.ably-realtime.com","B.ably-realtime.com","C.ably-realtime.com","D.ably-realtime.com","E.ably-realtime.com"],PORT:80,TLS_PORT:443,TIMEOUTS:{disconnectedRetryTimeout:15e3,suspendedRetryTimeout:3e4,httpRequestTimeout:15e3,channelRetryTimeout:15e3,fallbackRetryTimeout:6e5,connectionStateTtl:12e4,realtimeRequestTimeout:1e4,recvTimeout:9e4,preferenceConnectTimeout:6e3,parallelUpgradeDelay:6e3},httpMaxRetryCount:3,maxMessageSize:65536,version:O.version,protocolVersion:2,agent:P,getHost:b,getPort:a,getHttpScheme:g,environmentFallbackHosts:L,getFallbackHosts:x,getHosts:p,checkHost:y,objectifyOptions:r,normaliseOptions:i};function b(s,d,N){return N?d=d==s.restHost&&s.realtimeHost||d||s.realtimeHost:d=d||s.restHost,d}e.getHost=b;function a(s,d){return d||s.tls?s.tlsPort:s.port}e.getPort=a;function g(s){return s.tls?"https://":"http://"}e.getHttpScheme=g;function L(s){return[s+"-a-fallback.ably-realtime.com",s+"-b-fallback.ably-realtime.com",s+"-c-fallback.ably-realtime.com",s+"-d-fallback.ably-realtime.com",s+"-e-fallback.ably-realtime.com"]}e.environmentFallbackHosts=L;function x(s){var d=s.fallbackHosts,N=typeof s.httpMaxRetryCount<"u"?s.httpMaxRetryCount:A.httpMaxRetryCount;return d?m.arrChooseN(d,N):[]}e.getFallbackHosts=x;function p(s){return[s.restHost].concat(x(s))}e.getHosts=p;function y(s){if(typeof s!="string")throw new S.default("host must be a string; was a "+typeof s,4e4,400);if(!s.length)throw new S.default("host must not be zero-length",4e4,400)}function R(s,d,N){return s.realtimeHost?s.realtimeHost:s.restHost?(C.default.logAction(C.default.LOG_MINOR,"Defaults.normaliseOptions",'restHost is set to "'+s.restHost+'" but realtimeHost is not set, so setting realtimeHost to "'+s.restHost+'" too. If this is not what you want, please set realtimeHost explicitly.'),s.restHost):d?A.REALTIME_HOST:N+"-"+A.REALTIME_HOST}function c(s){var d={};for(var N in A.TIMEOUTS)d[N]=s[N]||A.TIMEOUTS[N];return d}function u(s){var d=A.agent;if(s.agents)for(var N in s.agents)d+=" "+N+"/"+s.agents[N];return d}e.getAgentString=u;function r(s){return typeof s=="string"?s.indexOf(":")==-1?{token:s}:{key:s}:s}e.objectifyOptions=r;function i(s){if(s.host&&(C.default.deprecated("host","restHost"),s.restHost=s.host),s.wsHost&&(C.default.deprecated("wsHost","realtimeHost"),s.realtimeHost=s.wsHost),s.queueEvents&&(C.default.deprecated("queueEvents","queueMessages"),s.queueMessages=s.queueEvents),s.fallbackHostsUseDefault){if(s.fallbackHosts){var d="fallbackHosts and fallbackHostsUseDefault cannot both be set";throw C.default.logAction(C.default.LOG_ERROR,"Defaults.normaliseOptions",d),new S.default(d,4e4,400)}if(s.port||s.tlsPort){var d="fallbackHostsUseDefault cannot be set when port or tlsPort are set";throw C.default.logAction(C.default.LOG_ERROR,"Defaults.normaliseOptions",d),new S.default(d,4e4,400)}s.environment?C.default.deprecatedWithMsg("fallbackHostsUseDefault","There is no longer a need to set this when the environment option is also set since the library will now generate the correct fallback hosts using the environment option."):C.default.deprecated("fallbackHostsUseDefault","fallbackHosts: Ably.Defaults.FALLBACK_HOSTS"),s.fallbackHosts=A.FALLBACK_HOSTS}s.recover===!0&&(C.default.deprecated("{recover: true}","{recover: function(lastConnectionDetails, cb) { cb(true); }}"),s.recover=function(_,w){w(!0)}),typeof s.recover=="function"&&s.closeOnUnload===!0&&(C.default.logAction(C.default.LOG_ERROR,"Defaults.normaliseOptions","closeOnUnload was true and a session recovery function was set - these are mutually exclusive, so unsetting the latter"),s.recover=void 0),"closeOnUnload"in s||(s.closeOnUnload=!s.recover),s.transports&&m.arrIn(s.transports,"xhr")&&(C.default.deprecated('transports: ["xhr"]','transports: ["xhr_streaming"]'),m.arrDeleteValue(s.transports,"xhr"),s.transports.push("xhr_streaming")),"queueMessages"in s||(s.queueMessages=!0);var N=s.environment&&String(s.environment).toLowerCase()||A.ENVIRONMENT,D=!N||N==="production";!s.fallbackHosts&&!s.restHost&&!s.realtimeHost&&!s.port&&!s.tlsPort&&(s.fallbackHosts=D?A.FALLBACK_HOSTS:L(N));var M=s.restHost||(D?A.REST_HOST:N+"-"+A.REST_HOST),T=R(s,D,N);m.arrForEach((s.fallbackHosts||[]).concat(M,T),y),s.port=s.port||A.PORT,s.tlsPort=s.tlsPort||A.TLS_PORT,"tls"in s||(s.tls=!0);var E=c(s);if("useBinaryProtocol"in s?s.useBinaryProtocol=n.default.Config.supportsBinary&&s.useBinaryProtocol:s.useBinaryProtocol=n.default.Config.preferBinary,s.clientId){var I=s.headers=s.headers||{};I["X-Ably-ClientId"]=n.default.BufferUtils.base64Encode(n.default.BufferUtils.utf8Encode(s.clientId))}"idempotentRestPublishing"in s||(s.idempotentRestPublishing=!0),s.promises&&!n.default.Config.Promise&&(C.default.logAction(C.default.LOG_ERROR,"Defaults.normaliseOptions","{promises: true} was specified, but no Promise constructor found; disabling promises"),s.promises=!1);var j=null,k=s.connectivityCheckUrl;if(s.connectivityCheckUrl){var H=s.connectivityCheckUrl.split("?"),V=H[0],z=H[1];j=z?m.parseQueryString(z):{},V.indexOf("://")===-1&&(V="https://"+V),k=V}return o.__assign(o.__assign({},s),{useBinaryProtocol:"useBinaryProtocol"in s?n.default.Config.supportsBinary&&s.useBinaryProtocol:n.default.Config.preferBinary,realtimeHost:T,restHost:M,maxMessageSize:s.maxMessageSize||A.maxMessageSize,timeouts:E,connectivityCheckParams:j,connectivityCheckUrl:k})}e.normaliseOptions=i,e.default=A;function v(s){return Object.assign(A,s)}e.getDefaults=v},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o=t(0),n=o.__importDefault(t(3)),m=o.__importDefault(t(2)),C=o.__importDefault(t(4)),S=o.__importStar(t(1));function O(a){return!a||!a.channelOptions?{channelOptions:a,plugins:{},baseEncodedPreviousPayload:void 0}:a}function P(a){if(a&&a.cipher){if(!n.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var g=n.default.Crypto.getCipher(a.cipher);return{cipher:g.cipherParams,channelCipher:g.cipher}}return a??{}}function A(a){var g=0;return a.name&&(g+=a.name.length),a.clientId&&(g+=a.clientId.length),a.extras&&(g+=JSON.stringify(a.extras).length),a.data&&(g+=S.dataSizeBytes(a.data)),g}var b=function(){function a(){}return a.prototype.toJSON=function(){var g=this.encoding,L=this.data;return L&&n.default.BufferUtils.isBuffer(L)&&(arguments.length>0?(g=g?g+"/base64":"base64",L=n.default.BufferUtils.base64Encode(L)):L=n.default.BufferUtils.toBuffer(L)),{name:this.name,id:this.id,clientId:this.clientId,connectionId:this.connectionId,connectionKey:this.connectionKey,extras:this.extras,encoding:g,data:L}},a.prototype.toString=function(){var g="[Message";return this.name&&(g+="; name="+this.name),this.id&&(g+="; id="+this.id),this.timestamp&&(g+="; timestamp="+this.timestamp),this.clientId&&(g+="; clientId="+this.clientId),this.connectionId&&(g+="; connectionId="+this.connectionId),this.encoding&&(g+="; encoding="+this.encoding),this.extras&&(g+="; extras ="+JSON.stringify(this.extras)),this.data&&(typeof this.data=="string"?g+="; data="+this.data:n.default.BufferUtils.isBuffer(this.data)?g+="; data (buffer)="+n.default.BufferUtils.base64Encode(this.data):g+="; data (json)="+JSON.stringify(this.data)),this.extras&&(g+="; extras="+JSON.stringify(this.extras)),g+="]",g},a.encrypt=function(g,L,x){var p=g.data,y=g.encoding,R=L.channelCipher;y=y?y+"/":"",n.default.BufferUtils.isBuffer(p)||(p=n.default.BufferUtils.utf8Encode(String(p)),y=y+"utf-8/"),R.encrypt(p,function(c,u){if(c){x(c);return}g.data=u,g.encoding=y+"cipher+"+R.algorithm,x(null,g)})},a.encode=function(g,L,x){var p=g.data,y=typeof p=="string"||n.default.BufferUtils.isBuffer(p)||p===null||p===void 0;if(!y)if(S.isObject(p)||S.isArray(p))g.data=JSON.stringify(p),g.encoding=g.encoding?g.encoding+"/json":"json";else throw new C.default("Data type is unsupported",40013,400);L!=null&&L.cipher?a.encrypt(g,L,x):x(null,g)},a.encodeArray=function(g,L,x){for(var p=0,y=0;y<g.length;y++)a.encode(g[y],L,function(R){if(R){x(R);return}p++,p==g.length&&x(null,g)})},a.decode=function(g,L){var x=O(L),p=g.data,y=g.encoding;if(y){var R=y.split("/"),c=void 0,u=R.length,r=g.data,i="";try{for(;(c=u)>0;){var v=R[--u].match(/([-\w]+)(\+([\w-]+))?/);if(!v)break;switch(i=v[1],i){case"base64":r=n.default.BufferUtils.base64Decode(String(r)),c==R.length&&(p=r);continue;case"utf-8":r=n.default.BufferUtils.utf8Decode(r);continue;case"json":r=JSON.parse(r);continue;case"cipher":if(x.channelOptions!=null&&x.channelOptions.cipher&&x.channelOptions.channelCipher){var s=v[3],d=x.channelOptions.channelCipher;if(s!=d.algorithm)throw new Error("Unable to decrypt message with given cipher; incompatible cipher params");r=d.decrypt(r);continue}else throw new Error("Unable to decrypt message; not an encrypted channel");case"vcdiff":if(!x.plugins||!x.plugins.vcdiff)throw new C.default("Missing Vcdiff decoder (https://github.com/ably-forks/vcdiff-decoder)",40019,400);if(typeof Uint8Array>"u")throw new C.default("Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)",40020,400);try{var N=x.baseEncodedPreviousPayload;typeof N=="string"&&(N=n.default.BufferUtils.utf8Encode(N)),N=n.default.BufferUtils.toBuffer(N),r=n.default.BufferUtils.toBuffer(r),r=n.default.BufferUtils.typedArrayToBuffer(x.plugins.vcdiff.decode(r,N)),p=r}catch(M){throw new C.default("Vcdiff delta decode failed with "+M,40018,400)}continue;default:throw new Error("Unknown encoding")}}}catch(M){var D=M;throw new C.default("Error processing the "+i+" encoding, decoder returned "+D.message+"",D.code||40013,400)}finally{g.encoding=c<=0?null:R.slice(0,c).join("/"),g.data=r}}x.baseEncodedPreviousPayload=p},a.fromResponseBody=function(g,L,x){x&&(g=S.decodeBody(g,x));for(var p=0;p<g.length;p++){var y=g[p]=a.fromValues(g[p]);try{a.decode(y,L)}catch(R){m.default.logAction(m.default.LOG_ERROR,"Message.fromResponseBody()",R.toString())}}return g},a.fromValues=function(g){return Object.assign(new a,g)},a.fromValuesArray=function(g){for(var L=g.length,x=new Array(L),p=0;p<L;p++)x[p]=a.fromValues(g[p]);return x},a.fromEncoded=function(g,L){var x=a.fromValues(g),p=P(L??null);try{a.decode(x,p)}catch(y){m.default.logAction(m.default.LOG_ERROR,"Message.fromEncoded()",y.toString())}return x},a.fromEncodedArray=function(g,L){return g.map(function(x){return a.fromEncoded(x,L)})},a.getMessagesSize=function(g){for(var L,x=0,p=0;p<g.length;p++)L=g[p],x+=L.size||(L.size=A(L));return x},a.serialize=S.encodeBody,a}();e.default=b},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o=t(0),n=o.__importStar(t(1)),m=o.__importDefault(t(4)),C=o.__importDefault(t(9)),S=o.__importDefault(t(15)),O={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15,SYNC:16,AUTH:17,ACTIVATE:18},P=[];Object.keys(O).forEach(function(x){P[O[x]]=x});var A={HAS_PRESENCE:1,HAS_BACKLOG:2,RESUMED:4,TRANSIENT:16,ATTACH_RESUME:32,PRESENCE:65536,PUBLISH:1<<17,SUBSCRIBE:1<<18,PRESENCE_SUBSCRIBE:1<<19},b=Object.keys(A);A.MODE_ALL=A.PRESENCE|A.PUBLISH|A.SUBSCRIBE|A.PRESENCE_SUBSCRIBE;function a(x){var p=[];if(x)for(var y=0;y<x.length;y++)p.push(x[y].toString());return"[ "+p.join(", ")+" ]"}var g="id channel channelSerial connectionId count msgSerial timestamp".split(" "),L=function(){function x(){var p=this;this.hasFlag=function(y){return(p.flags&A[y])>0}}return x.prototype.setFlag=function(p){return this.flags=this.flags|A[p]},x.prototype.getMode=function(){return this.flags&&this.flags&A.MODE_ALL},x.prototype.encodeModesToFlags=function(p){var y=this;p.forEach(function(R){return y.setFlag(R)})},x.prototype.decodeModesFromFlags=function(){var p=this,y=[];return x.channelModes.forEach(function(R){p.hasFlag(R)&&y.push(R)}),y.length>0?y:void 0},x.fromValues=function(p){return Object.assign(new x,p)},x.Action=O,x.channelModes=["PRESENCE","PUBLISH","SUBSCRIBE","PRESENCE_SUBSCRIBE"],x.ActionName=P,x.serialize=n.encodeBody,x.deserialize=function(p,y){var R=n.decodeBody(p,y);return x.fromDeserialized(R)},x.fromDeserialized=function(p){var y=p.error;y&&(p.error=m.default.fromValues(y));var R=p.messages;if(R)for(var c=0;c<R.length;c++)R[c]=C.default.fromValues(R[c]);var u=p.presence;if(u)for(var c=0;c<u.length;c++)u[c]=S.default.fromValues(u[c],!0);return Object.assign(new x,p)},x.stringify=function(p){var y="[ProtocolMessage";p.action!==void 0&&(y+="; action="+x.ActionName[p.action]||!1);for(var R,c=0;c<g.length;c++)R=g[c],p[R]!==void 0&&(y+="; "+R+"="+p[R]);if(p.messages&&(y+="; messages="+a(C.default.fromValuesArray(p.messages))),p.presence&&(y+="; presence="+a(S.default.fromValuesArray(p.presence))),p.error&&(y+="; error="+m.default.fromValues(p.error).toString()),p.auth&&p.auth.accessToken&&(y+="; token="+p.auth.accessToken),p.flags&&(y+="; flags="+b.filter(p.hasFlag).join(",")),p.params){var u="";n.forInOwnNonNullProperties(p.params,function(r){u.length>0&&(u+="; "),u+=r+"="+p.params[r]}),u.length>0&&(y+="; params=["+u+"]")}return y+="]",y},x}();e.default=L},function(l,e,t){(function(o,n){l.exports=n(t(6))})(this,function(o){return function(){var n=o,m=n.lib,C=m.WordArray,S=n.enc;S.Base64={stringify:function(P){var A=P.words,b=P.sigBytes,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";P.clamp();for(var g=[],L=0;L<b;L+=3)for(var x=A[L>>>2]>>>24-L%4*8&255,p=A[L+1>>>2]>>>24-(L+1)%4*8&255,y=A[L+2>>>2]>>>24-(L+2)%4*8&255,R=x<<16|p<<8|y,c=0;c<4&&L+c*.75<b;c++)g.push(a.charAt(R>>>6*(3-c)&63));var u=a.charAt(64);if(u)for(;g.length%4;)g.push(u);return g.join("")},parse:function(P){var A=P.length,b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a=this._reverseMap;if(!a){a=this._reverseMap=[];for(var g=0;g<b.length;g++)a[b.charCodeAt(g)]=g}var L=b.charAt(64);if(L){var x=P.indexOf(L);x!==-1&&(A=x)}return O(P,A,a)}};function O(P,A,b){for(var a=[],g=0,L=0;L<A;L++)if(L%4){var x=b[P.charCodeAt(L-1)]<<L%4*2,p=b[P.charCodeAt(L)]>>>6-L%4*2,y=x|p;a[g>>>2]|=y<<24-g%4*8,g++}return C.create(a,g)}}(),o.enc.Base64})},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o=t(0),n=o.__importStar(t(1)),m=o.__importDefault(t(10)),C=o.__importDefault(t(26)),S=o.__importDefault(t(2)),O=o.__importDefault(t(8)),P=o.__importDefault(t(20)),A=o.__importDefault(t(17)),b=o.__importDefault(t(4)),a=o.__importDefault(t(21)),g=o.__importDefault(t(3));function L(y){var R=[80015,80017,80030];return y.code?A.default.isTokenErr(y)?!1:n.arrIn(R,y.code)?!0:y.code>=4e4&&y.code<5e4:!1}function x(y){return L(y)?[m.default.fromValues({action:m.default.Action.ERROR,error:y})]:[m.default.fromValues({action:m.default.Action.DISCONNECTED,error:y})]}var p=function(y){o.__extends(R,y);function R(c,u,r){var i=y.call(this,c,u,r,!0)||this;return i.onAuthUpdated=function(v){i.authParams={access_token:v.token}},i.stream="stream"in r?r.stream:!0,i.sendRequest=null,i.recvRequest=null,i.pendingCallback=null,i.pendingItems=null,i}return R.prototype.connect=function(){var c=this;S.default.logAction(S.default.LOG_MINOR,"CometTransport.connect()","starting"),C.default.prototype.connect.call(this);var u=this.params,r=u.options,i=O.default.getHost(r,u.host),v=O.default.getPort(r),s=r.tls?"https://":"http://";this.baseUri=s+i+":"+v+"/comet/";var d=this.baseUri+"connect";S.default.logAction(S.default.LOG_MINOR,"CometTransport.connect()","uri: "+d),this.auth.getAuthParams(function(N,D){if(N){c.disconnect(N);return}if(!c.isDisposed){c.authParams=D;var M=c.params.getConnectParams(D);"stream"in M&&(c.stream=M.stream),S.default.logAction(S.default.LOG_MINOR,"CometTransport.connect()","connectParams:"+n.toQueryString(M));var T=!1,E=c.recvRequest=c.createRequest(d,null,M,null,c.stream?a.default.REQ_RECV_STREAM:a.default.REQ_RECV);E.on("data",function(I){c.recvRequest&&(T||(T=!0,c.emit("preconnect")),c.onData(I))}),E.on("complete",function(I){if(c.recvRequest||(I=I||new b.default("Request cancelled",80003,400)),c.recvRequest=null,!T&&!I&&(T=!0,c.emit("preconnect")),c.onActivity(),I){I.code?c.onData(x(I)):c.disconnect(I);return}g.default.Config.nextTick(function(){c.recv()})}),E.exec()}})},R.prototype.requestClose=function(){S.default.logAction(S.default.LOG_MINOR,"CometTransport.requestClose()"),this._requestCloseOrDisconnect(!0)},R.prototype.requestDisconnect=function(){S.default.logAction(S.default.LOG_MINOR,"CometTransport.requestDisconnect()"),this._requestCloseOrDisconnect(!1)},R.prototype._requestCloseOrDisconnect=function(c){var u=this,r=c?this.closeUri:this.disconnectUri;if(r){var i=this.createRequest(r,null,this.authParams,null,a.default.REQ_SEND);i.on("complete",function(v){v&&(S.default.logAction(S.default.LOG_ERROR,"CometTransport.request"+(c?"Close()":"Disconnect()"),"request returned err = "+n.inspectError(v)),u.finish("disconnected",v))}),i.exec()}},R.prototype.dispose=function(){var c=this;S.default.logAction(S.default.LOG_MINOR,"CometTransport.dispose()",""),this.isDisposed||(this.isDisposed=!0,this.recvRequest&&(S.default.logAction(S.default.LOG_MINOR,"CometTransport.dispose()","aborting recv request"),this.recvRequest.abort(),this.recvRequest=null),this.finish("disconnected",P.default.disconnected()),g.default.Config.nextTick(function(){c.emit("disposed")}))},R.prototype.onConnect=function(c){var u;if(!this.isDisposed){var r=(u=c.connectionDetails)===null||u===void 0?void 0:u.connectionKey;C.default.prototype.onConnect.call(this,c);var i=this.baseUri+r;S.default.logAction(S.default.LOG_MICRO,"CometTransport.onConnect()","baseUri = "+i),this.sendUri=i+"/send",this.recvUri=i+"/recv",this.closeUri=i+"/close",this.disconnectUri=i+"/disconnect"}},R.prototype.send=function(c){if(this.sendRequest){this.pendingItems=this.pendingItems||[],this.pendingItems.push(c);return}var u=this.pendingItems||[];u.push(c),this.pendingItems=null,this.sendItems(u)},R.prototype.sendAnyPending=function(){var c=this.pendingItems;c&&(this.pendingItems=null,this.sendItems(c))},R.prototype.sendItems=function(c){var u=this,r=this.sendRequest=this.createRequest(this.sendUri,null,this.authParams,this.encodeRequest(c),a.default.REQ_SEND);r.on("complete",function(i,v){if(i&&S.default.logAction(S.default.LOG_ERROR,"CometTransport.sendItems()","on complete: err = "+n.inspectError(i)),u.sendRequest=null,i){i.code?u.onData(x(i)):u.disconnect(i);return}v&&u.onData(v),u.pendingItems&&g.default.Config.nextTick(function(){u.sendRequest||u.sendAnyPending()})}),r.exec()},R.prototype.recv=function(){var c=this;if(!this.recvRequest&&this.isConnected){var u=this.recvRequest=this.createRequest(this.recvUri,null,this.authParams,null,this.stream?a.default.REQ_RECV_STREAM:a.default.REQ_RECV_POLL);u.on("data",function(r){c.onData(r)}),u.on("complete",function(r){if(c.recvRequest=null,c.onActivity(),r){r.code?c.onData(x(r)):c.disconnect(r);return}g.default.Config.nextTick(function(){c.recv()})}),u.exec()}},R.prototype.onData=function(c){try{var u=this.decodeResponse(c);if(u&&u.length)for(var r=0;r<u.length;r++)this.onProtocolMessage(m.default.fromDeserialized(u[r]))}catch(i){S.default.logAction(S.default.LOG_ERROR,"CometTransport.onData()","Unexpected exception handing channel event: "+i.stack)}},R.prototype.encodeRequest=function(c){return JSON.stringify(c)},R.prototype.decodeResponse=function(c){return typeof c=="string"?JSON.parse(c):c},R}(C.default);e.default=p},function(l,e){var t;t=function(){return this}();try{t=t||new Function("return this")()}catch{typeof window=="object"&&(t=window)}l.exports=t},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o=t(0),n=o.__importDefault(t(3)),m=o.__importStar(t(1)),C=o.__importDefault(t(2)),S=o.__importDefault(t(17)),O=o.__importDefault(t(18)),P=t(4);function A(p,y,R,c,u){p.http.supportsAuthHeaders?p.auth.getAuthHeaders(function(r,i){r?c(r):u(m.mixin(i,y),R)}):p.auth.getAuthParams(function(r,i){r?c(r):u(y,m.mixin(i,R))})}function b(p,y){return function(R,c,u,r,i){if(R&&!c){p(R);return}if(!r)try{c=m.decodeBody(c,y)}catch(M){m.isErrorInfoOrPartialErrorInfo(M)?p(M):p(new P.PartialErrorInfo(m.inspectError(M),null));return}if(!c){p(new P.PartialErrorInfo("unenvelope(): Response body is missing",null));return}var v=c,s=v.statusCode,d=v.response,N=v.headers;if(s===void 0){p(R,c,u,!0,i);return}if(s<200||s>=300){var D=d&&d.error||R;D||(D=new Error("Error in unenveloping "+c),D.statusCode=s),p(D,d,N,!0,s);return}p(R,d,N,!0,s)}}function a(p){var y=[];if(p)for(var R in p)y.push(R+"="+p[R]);return y.join("&")}function g(p,y){return p+(y?"?":"")+a(y)}function L(p,y,R,c){return function(u,r,i,v,s){u?C.default.logAction(C.default.LOG_MICRO,"Resource."+y+"()","Received Error; "+g(R,c)+"; Error: "+m.inspectError(u)):C.default.logAction(C.default.LOG_MICRO,"Resource."+y+"()","Received; "+g(R,c)+"; Headers: "+a(i)+"; StatusCode: "+s+"; Body: "+(n.default.BufferUtils.isBuffer(r)?r.toString():r)),p&&p(u,r,i,v,s)}}var x=function(){function p(){}return p.get=function(y,R,c,u,r,i){p.do(O.default.Get,y,R,null,c,u,r,i)},p.delete=function(y,R,c,u,r,i){p.do(O.default.Delete,y,R,null,c,u,r,i)},p.post=function(y,R,c,u,r,i,v){p.do(O.default.Post,y,R,c,u,r,i,v)},p.patch=function(y,R,c,u,r,i,v){p.do(O.default.Patch,y,R,c,u,r,i,v)},p.put=function(y,R,c,u,r,i,v){p.do(O.default.Put,y,R,c,u,r,i,v)},p.do=function(y,R,c,u,r,i,v,s){C.default.shouldLog(C.default.LOG_MICRO)&&(s=L(s,y,c,i)),v&&(s=s&&b(s,v),(i=i||{}).envelope=v);function d(N,D){var M;if(C.default.shouldLog(C.default.LOG_MICRO)&&C.default.logAction(C.default.LOG_MICRO,"Resource."+y+"()","Sending; "+g(c,D)),C.default.shouldLog(C.default.LOG_MICRO)){var T=u;if(((M=N["content-type"])===null||M===void 0?void 0:M.indexOf("msgpack"))>0)try{T=n.default.Config.msgpack.decode(u)}catch(E){C.default.logAction(C.default.LOG_MICRO,"Resource."+y+"()","Sending MsgPack Decoding Error: "+m.inspectError(E))}C.default.logAction(C.default.LOG_MICRO,"Resource."+y+"()","Sending; "+g(c,D)+"; Body: "+T)}R.http.do(y,R,c,N,u,D,function(E,I,j,k,H){if(E&&S.default.isTokenErr(E)){R.auth.authorize(null,null,function(V){if(V){s(V);return}A(R,j,D,s,d)});return}s(E,I,j,k,H)})}A(R,r,i,s,d)},p}();e.default=x},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o=t(0),n=o.__importDefault(t(2)),m=o.__importDefault(t(3)),C=o.__importDefault(t(9)),S=o.__importStar(t(1));function O(A){return P.Actions.indexOf(A)}var P=function(){function A(){}return A.prototype.isSynthesized=function(){return!this.id||!this.connectionId?!0:this.id.substring(this.connectionId.length,0)!==this.connectionId},A.prototype.parseId=function(){if(!this.id)throw new Error("parseId(): Presence message does not contain an id");var b=this.id.split(":");return{connectionId:b[0],msgSerial:parseInt(b[1],10),index:parseInt(b[2],10)}},A.prototype.toJSON=function(){var b=this.data,a=this.encoding;return b&&m.default.BufferUtils.isBuffer(b)&&(arguments.length>0?(a=a?a+"/base64":"base64",b=m.default.BufferUtils.base64Encode(b)):b=m.default.BufferUtils.toBuffer(b)),{id:this.id,clientId:this.clientId,action:O(this.action),data:b,encoding:a,extras:this.extras}},A.prototype.toString=function(){var b="[PresenceMessage";return b+="; action="+this.action,this.id&&(b+="; id="+this.id),this.timestamp&&(b+="; timestamp="+this.timestamp),this.clientId&&(b+="; clientId="+this.clientId),this.connectionId&&(b+="; connectionId="+this.connectionId),this.encoding&&(b+="; encoding="+this.encoding),this.data&&(typeof this.data=="string"?b+="; data="+this.data:m.default.BufferUtils.isBuffer(this.data)?b+="; data (buffer)="+m.default.BufferUtils.base64Encode(this.data):b+="; data (json)="+JSON.stringify(this.data)),this.extras&&(b+="; extras="+JSON.stringify(this.extras)),b+="]",b},A.fromResponseBody=function(b,a,g){var L=[];g&&(b=S.decodeBody(b,g));for(var x=0;x<b.length;x++){var p=L[x]=A.fromValues(b[x],!0);try{A.decode(p,a)}catch(y){n.default.logAction(n.default.LOG_ERROR,"PresenceMessage.fromResponseBody()",y.toString())}}return L},A.fromValues=function(b,a){return a&&(b.action=A.Actions[b.action]),Object.assign(new A,b)},A.fromValuesArray=function(b){for(var a=b.length,g=new Array(a),L=0;L<a;L++)g[L]=A.fromValues(b[L]);return g},A.fromEncoded=function(b,a){var g=A.fromValues(b,!0);try{A.decode(g,a??{})}catch(L){n.default.logAction(n.default.LOG_ERROR,"PresenceMessage.fromEncoded()",L.toString())}return g},A.fromEncodedArray=function(b,a){return b.map(function(g){return A.fromEncoded(g,a)})},A.fromData=function(b){return b instanceof A?b:A.fromValues({data:b})},A.Actions=["absent","present","enter","leave","update"],A.encode=C.default.encode,A.decode=C.default.decode,A.getMessagesSize=C.default.getMessagesSize,A}();e.default=P},function(l,e,t){(function(o){Object.defineProperty(e,"__esModule",{value:!0});var n=t(0),m=n.__importStar(t(1)),C=n.__importDefault(t(7)),S=n.__importStar(t(4)),O=n.__importDefault(t(2)),P=n.__importDefault(t(8)),A=n.__importDefault(t(21)),b=n.__importDefault(t(3));function a(s,d){return m.arrIn(m.allToLowerCase(m.keysArray(d)),"x-ably-errorcode")}function g(s,d){if(a(s,d))return s.error&&S.default.fromValues(s.error)}var L=function(){},x=0,p={},y=typeof o<"u"&&o.XDomainRequest;function R(){var s=navigator.userAgent.toString().match(/MSIE\s([\d.]+)/);return s&&Number(s[1])}function c(){var s;return y&&(s=R())&&s===10}function u(s,d){return s.getResponseHeader&&s.getResponseHeader(d)}function r(s){return s.getResponseHeader&&(s.getResponseHeader("transfer-encoding")||!s.getResponseHeader("content-length"))}function i(s){for(var d=m.trim(s.getAllResponseHeaders()).split(`\r
`),N={},D=0;D<d.length;D++){var M=d[D].split(":").map(m.trim);N[M[0].toLowerCase()]=M[1]}return N}var v=function(s){n.__extends(d,s);function d(N,D,M,T,E,I,j){var k=s.call(this)||this;return M=M||{},M.rnd=m.cheapRandStr(),c()&&!M.envelope&&(M.envelope="json"),k.uri=N+m.toQueryString(M),k.headers=D||{},k.body=T,k.method=j?j.toUpperCase():m.isEmptyArg(T)?"GET":"POST",k.requestMode=E,k.timeouts=I,k.timedOut=!1,k.requestComplete=!1,k.id=String(++x),p[k.id]=k,k}return d.createRequest=function(N,D,M,T,E,I,j){var k=I||P.default.TIMEOUTS;return new d(N,D,m.copy(M),T,E,k,j)},d.prototype.complete=function(N,D,M,T,E){this.requestComplete||(this.requestComplete=!0,!N&&D&&this.emit("data",D),this.emit("complete",N,D,M,T,E),this.dispose())},d.prototype.abort=function(){this.dispose()},d.prototype.exec=function(){var N=this,D=this.headers,M=this.requestMode==A.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout,T=this.timer=setTimeout(function(){N.timedOut=!0,I.abort()},M),E=this.method,I=this.xhr=new XMLHttpRequest,j=D.accept,k=this.body,H="text";if(j?j.indexOf("application/x-msgpack")===0&&(H="arraybuffer"):D.accept="application/json",k){var V=D["content-type"]||(D["content-type"]="application/json");V.indexOf("application/json")>-1&&typeof k!="string"&&(k=JSON.stringify(k))}I.open(E,this.uri,!0),I.responseType=H,"authorization"in D&&(I.withCredentials=!0);for(var z in D)I.setRequestHeader(z,D[z]);var _=function(X,it,ct,dt){var ut,Ot=it+" (event type: "+X.type+")";!((ut=N==null?void 0:N.xhr)===null||ut===void 0)&&ut.statusText&&(Ot+=", current statusText is "+N.xhr.statusText),O.default.logAction(O.default.LOG_ERROR,"Request.on"+X.type+"()",Ot),N.complete(new S.PartialErrorInfo(Ot,ct,dt))};I.onerror=function(X){_(X,"XHR error occurred",null,400)},I.onabort=function(X){N.timedOut?_(X,"Request aborted due to request timeout expiring",null,408):_(X,"Request cancelled",null,400)},I.ontimeout=function(X){_(X,"Request timed out",null,408)};var w,U,B,G=0,W=!1,Q=function(){if(clearTimeout(T),B=U<400,U==204){N.complete(null,null,null,null,U);return}w=N.requestMode==A.default.REQ_RECV_STREAM&&B&&r(I)},$=function(){var X;try{var it=u(I,"content-type"),ct=it?it.indexOf("application/json")>=0:I.responseType=="text";if(ct){var dt=I.responseType==="arraybuffer"?b.default.BufferUtils.utf8Decode(I.response):String(I.responseText);dt.length?X=JSON.parse(dt):X=dt,W=!0}else X=I.response;X.response!==void 0?(U=X.statusCode,B=U<400,D=X.headers,X=X.response):D=i(I)}catch(Ot){N.complete(new S.PartialErrorInfo("Malformed response body from server: "+Ot.message,null,400));return}if(B||m.isArray(X)){N.complete(null,X,D,W,U);return}var ut=g(X,D);ut||(ut=new S.PartialErrorInfo("Error response received from server: "+U+" body was: "+b.default.Config.inspect(X),null,U)),N.complete(ut,X,D,W,U)};function Z(){for(var X=I.responseText,it=X.length-1,ct,dt;G<it&&(ct=X.indexOf(`
`,G))>-1;)dt=X.slice(G,ct),G=ct+1,tt(dt)}var tt=function(X){try{X=JSON.parse(X)}catch(it){N.complete(new S.PartialErrorInfo("Malformed response body from server: "+it.message,null,400));return}N.emit("data",X)},rt=function(){Z(),N.streamComplete=!0,b.default.Config.nextTick(function(){N.complete()})};I.onreadystatechange=function(){var X=I.readyState;X<3||I.status!==0&&(U===void 0&&(U=I.status,U===1223&&(U=204),Q()),X==3&&w?Z():X==4&&(w?rt():$()))},I.send(k)},d.prototype.dispose=function(){var N=this.xhr;if(N){N.onreadystatechange=N.onerror=N.onabort=N.ontimeout=L,this.xhr=null;var D=this.timer;D&&(clearTimeout(D),this.timer=null),this.requestComplete||N.abort()}delete p[this.id]},d}(C.default);e.default=v}).call(this,t(13))},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o=t(0),n=o.__importDefault(t(2)),m=o.__importStar(t(1)),C=o.__importDefault(t(23)),S=o.__importDefault(t(4)),O=o.__importDefault(t(45)),P=t(11),A=o.__importDefault(t(18)),b=o.__importDefault(t(25)),a=o.__importDefault(t(3)),g=o.__importDefault(t(14)),L=Math.pow(2,17);function x(){}function p(){return("000000"+Math.floor(Math.random()*1e16)).slice(-16)}function y(M){return!!M.connection}function R(M){return m.isErrorInfoOrPartialErrorInfo(M)?(M.code||(M.statusCode===403?M.code=40300:(M.code=40170,M.statusCode=401)),M):new S.default(m.inspectError(M),M.code||40170,M.statusCode||401)}var c=function(M,T){if(a.default.Config.createHmac){var E=a.default.Config.createHmac("SHA256",T);return E.update(M),E.digest("base64")}return(0,P.stringify)((0,O.default)(M,T))};function u(M){if(!M)return"";typeof M=="string"&&(M=JSON.parse(M));var T=Object.create(null),E=m.keysArray(M,!0);if(!E)return"";E.sort();for(var I=0;I<E.length;I++)T[E[I]]=M[E[I]].sort();return JSON.stringify(T)}function r(M){if(M.authCallback)n.default.logAction(n.default.LOG_MINOR,"Auth()","using token auth with authCallback");else if(M.authUrl)n.default.logAction(n.default.LOG_MINOR,"Auth()","using token auth with authUrl");else if(M.key)n.default.logAction(n.default.LOG_MINOR,"Auth()","using token auth with client-side signing");else if(M.tokenDetails)n.default.logAction(n.default.LOG_MINOR,"Auth()","using token auth with supplied token only");else{var T="authOptions must include valid authentication parameters";throw n.default.logAction(n.default.LOG_ERROR,"Auth()",T),new Error(T)}}function i(M){return"useTokenAuth"in M&&!M.useTokenAuth}function v(M){return M.useTokenAuth||!i(M)&&(M.authCallback||M.authUrl||M.token||M.tokenDetails)}function s(M){return!M.key&&!M.authCallback&&!M.authUrl}var d=0;function N(){return d++}var D=function(){function M(T,E){if(this.authOptions={},this.client=T,this.tokenParams=E.defaultTokenParams||{},this.currentTokenRequestId=null,this.waitingForTokenRequest=null,v(E)){if(E.key&&!c){var I="client-side token request signing not supported";throw n.default.logAction(n.default.LOG_ERROR,"Auth()",I),new Error(I)}s(E)&&n.default.logAction(n.default.LOG_ERROR,"Auth()","Warning: library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),this._saveTokenOptions(E.defaultTokenParams,E),r(this.authOptions)}else{if(!E.key){var I="No authentication options provided; need one of: key, authUrl, or authCallback (or for testing only, token or tokenDetails)";throw n.default.logAction(n.default.LOG_ERROR,"Auth()",I),new S.default(I,40160,401)}n.default.logAction(n.default.LOG_MINOR,"Auth()","anonymous, using basic auth"),this._saveBasicOptions(E)}}return M.prototype.authorize=function(T,E,I){var j=this,k;if(typeof T=="function"&&!I?(I=T,k=T=null):typeof E=="function"&&!I?(I=E,k=null):k=E,!I&&this.client.options.promises)return m.promisify(this,"authorize",arguments);if(k&&k.key&&this.authOptions.key!==k.key)throw new S.default("Unable to update auth options with incompatible key",40102,401);k&&"force"in k&&(n.default.logAction(n.default.LOG_ERROR,"Auth.authorize","Deprecation warning: specifying {force: true} in authOptions is no longer necessary, authorize() now always gets a new token. Please remove this, as in version 1.0 and later, having a non-null authOptions will overwrite stored library authOptions, which may not be what you want"),m.isOnlyPropIn(k,"force")&&(k=null)),this._forceNewToken(T,k,function(H,V){if(H){j.client.connection&&H.statusCode===b.default.Forbidden&&j.client.connection.connectionManager.actOnErrorFromAuthorize(H),I==null||I(H);return}y(j.client)?j.client.connection.connectionManager.onAuthUpdated(V,I||x):I==null||I(null,V)})},M.prototype.authorise=function(T,E,I){n.default.deprecated("Auth.authorise","Auth.authorize"),this.authorize(T,E,I)},M.prototype._forceNewToken=function(T,E,I){var j=this;this.tokenDetails=null,this._saveTokenOptions(T,E),r(this.authOptions),this._ensureValidAuthCredentials(!0,function(k,H){delete j.tokenParams.timestamp,delete j.authOptions.queryTime,I(k,H)})},M.prototype.requestToken=function(T,E,I){var j=this;if(typeof T=="function"&&!I?(I=T,E=T=null):typeof E=="function"&&!I&&(I=E,E=null),!I&&this.client.options.promises)return m.promisify(this,"requestToken",arguments);E=E||this.authOptions,T=T||m.copy(this.tokenParams);var k=I||x,H,V=this.client;if(E.authCallback)n.default.logAction(n.default.LOG_MINOR,"Auth.requestToken()","using token auth with authCallback"),H=E.authCallback;else if(E.authUrl)n.default.logAction(n.default.LOG_MINOR,"Auth.requestToken()","using token auth with authUrl"),H=function(G,W){var Q=m.mixin({accept:"application/json, text/plain"},E.authHeaders),$=E.authMethod&&E.authMethod.toLowerCase()==="post",Z,tt=E.authUrl.indexOf("?");tt>-1&&(Z=m.parseQueryString(E.authUrl.slice(tt)),E.authUrl=E.authUrl.slice(0,tt),$||(E.authParams=m.mixin(Z,E.authParams)));var rt=m.mixin({},E.authParams||{},G),X=function(dt,ut,Ot,xt){var vt;if(dt?n.default.logAction(n.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received Error: "+m.inspectError(dt)):(vt=Ot["content-type"],n.default.logAction(n.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received; content-type: "+vt+"; body: "+m.inspectBody(ut))),dt||xt)return W(dt,ut);if(a.default.BufferUtils.isBuffer(ut)&&(ut=ut.toString()),!vt){W(new S.default("authUrl response is missing a content-type header",40170,401));return}var Lt=vt.indexOf("application/json")>-1,$t=vt.indexOf("text/plain")>-1||vt.indexOf("application/jwt")>-1;if(!Lt&&!$t){W(new S.default("authUrl responded with unacceptable content-type "+vt+", should be either text/plain, application/jwt or application/json",40170,401));return}if(Lt){if(ut.length>L){W(new S.default("authUrl response exceeded max permitted length",40170,401));return}try{ut=JSON.parse(ut)}catch(Xt){W(new S.default("Unexpected error processing authURL response; err = "+Xt.message,40170,401));return}}W(null,ut,vt)};if(n.default.logAction(n.default.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Requesting token from "+E.authUrl+"; Params: "+JSON.stringify(rt)+"; method: "+($?"POST":"GET")),$){var it=Q||{};it["content-type"]="application/x-www-form-urlencoded";var ct=m.toQueryString(rt).slice(1);j.client.http.doUri(A.default.Post,V,E.authUrl,it,ct,Z,X)}else j.client.http.doUri(A.default.Get,V,E.authUrl,Q||{},null,rt,X)};else if(E.key)n.default.logAction(n.default.LOG_MINOR,"Auth.requestToken()","using token auth with client-side signing"),H=function(G,W){j.createTokenRequest(G,E,W)};else{var z="Need a new token, but authOptions does not include any way to request one (no authUrl, authCallback, or key)";n.default.logAction(n.default.LOG_ERROR,"Auth()","library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),k(new S.default(z,40171,403));return}"capability"in T&&(T.capability=u(T.capability));var _=function(G,W){var Q=G.keyName,$="/keys/"+Q+"/requestToken",Z=function(rt){return V.baseUri(rt)+$},tt=m.defaultPostHeaders(j.client.options);E.requestHeaders&&m.mixin(tt,E.requestHeaders),n.default.logAction(n.default.LOG_MICRO,"Auth.requestToken().requestToken","Sending POST to "+$+"; Token params: "+JSON.stringify(G)),j.client.http.do(A.default.Post,V,Z,tt,JSON.stringify(G),null,W)},w=!1,U=this.client.options.timeouts.realtimeRequestTimeout,B=setTimeout(function(){w=!0;var G="Token request callback timed out after "+U/1e3+" seconds";n.default.logAction(n.default.LOG_ERROR,"Auth.requestToken()",G),k(new S.default(G,40170,401))},U);H(T,function(G,W,Q){if(!w){if(clearTimeout(B),G){n.default.logAction(n.default.LOG_ERROR,"Auth.requestToken()","token request signing call returned error; err = "+m.inspectError(G)),k(R(G));return}if(typeof W=="string"){W.length===0?k(new S.default("Token string is empty",40170,401)):W.length>L?k(new S.default("Token string exceeded max permitted length (was "+W.length+" bytes)",40170,401)):W==="undefined"||W==="null"?k(new S.default("Token string was literal null/undefined",40170,401)):W[0]==="{"&&!(Q&&Q.indexOf("application/jwt")>-1)?k(new S.default("Token was double-encoded; make sure you're not JSON-encoding an already encoded token request or details",40170,401)):k(null,{token:W});return}if(typeof W!="object"){var $="Expected token request callback to call back with a token string or token request/details object, but got a "+typeof W;n.default.logAction(n.default.LOG_ERROR,"Auth.requestToken()",$),k(new S.default($,40170,401));return}var Z=JSON.stringify(W).length;if(Z>L&&!E.suppressMaxLengthCheck){k(new S.default("Token request/details object exceeded max permitted stringified size (was "+Z+" bytes)",40170,401));return}if("issued"in W){k(null,W);return}if(!("keyName"in W)){var $="Expected token request callback to call back with a token string, token request object, or token details object";n.default.logAction(n.default.LOG_ERROR,"Auth.requestToken()",$),k(new S.default($,40170,401));return}_(W,function(tt,rt,X,it){if(tt){n.default.logAction(n.default.LOG_ERROR,"Auth.requestToken()","token request API call returned error; err = "+m.inspectError(tt)),k(R(tt));return}it||(rt=JSON.parse(rt)),n.default.logAction(n.default.LOG_MINOR,"Auth.getToken()","token received"),k(null,rt)})}})},M.prototype.createTokenRequest=function(T,E,I){var j=this;if(typeof T=="function"&&!I?(I=T,E=T=null):typeof E=="function"&&!I&&(I=E,E=null),!I&&this.client.options.promises)return m.promisify(this,"createTokenRequest",arguments);E=E||this.authOptions,T=T||m.copy(this.tokenParams);var k=E.key;if(!k){I(new S.default("No key specified",40101,403));return}var H=k.split(":"),V=H[0],z=H[1];if(!z){I(new S.default("Invalid key specified",40101,403));return}if(T.clientId===""){I(new S.default("clientId cant be an empty string",40012,400));return}"capability"in T&&(T.capability=u(T.capability));var _=m.mixin({keyName:V},T),w=T.clientId||"",U=T.ttl||"",B=T.capability||"";(function(G){if(_.timestamp){G();return}j.getTimestamp(E&&E.queryTime,function(W,Q){if(W){I(W);return}_.timestamp=Q,G()})})(function(){var G=_.nonce||(_.nonce=p()),W=_.timestamp,Q=_.keyName+`
`+U+`
`+B+`
`+w+`
`+W+`
`+G+`
`;_.mac=_.mac||c(Q,z),n.default.logAction(n.default.LOG_MINOR,"Auth.getTokenRequest()","generated signed request"),I(null,_)})},M.prototype.getAuthParams=function(T){this.method=="basic"?T(null,{key:this.key}):this._ensureValidAuthCredentials(!1,function(E,I){if(E){T(E);return}if(!I)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");T(null,{access_token:I.token})})},M.prototype.getAuthHeaders=function(T){this.method=="basic"?T(null,{authorization:"Basic "+this.basicKey}):this._ensureValidAuthCredentials(!1,function(E,I){if(E){T(E);return}if(!I)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");T(null,{authorization:"Bearer "+m.toBase64(I.token)})})},M.prototype.getTimestamp=function(T,E){!this.isTimeOffsetSet()&&(T||this.authOptions.queryTime)?this.client.time(E):E(null,this.getTimestampUsingOffset())},M.prototype.getTimestampUsingOffset=function(){return m.now()+(this.client.serverTimeOffset||0)},M.prototype.isTimeOffsetSet=function(){return this.client.serverTimeOffset!==null},M.prototype._saveBasicOptions=function(T){this.method="basic",this.key=T.key,this.basicKey=m.toBase64(T.key),this.authOptions=T||{},"clientId"in T&&this._userSetClientId(T.clientId)},M.prototype._saveTokenOptions=function(T,E){this.method="token",T&&(this.tokenParams=T),E&&(E.token&&(E.tokenDetails=typeof E.token=="string"?{token:E.token}:E.token),E.tokenDetails&&(this.tokenDetails=E.tokenDetails),"clientId"in E&&this._userSetClientId(E.clientId),this.authOptions=E)},M.prototype._ensureValidAuthCredentials=function(T,E){var I=this,j=this.tokenDetails;if(j){if(this._tokenClientIdMismatch(j.clientId)){E(new S.default("Mismatch between clientId in token ("+j.clientId+") and current clientId ("+this.clientId+")",40102,403));return}if(!this.isTimeOffsetSet()||!j.expires||j.expires>=this.getTimestampUsingOffset()){n.default.logAction(n.default.LOG_MINOR,"Auth.getToken()","using cached token; expires = "+j.expires),E(null,j);return}n.default.logAction(n.default.LOG_MINOR,"Auth.getToken()","deleting expired token"),this.tokenDetails=null}if((this.waitingForTokenRequest||(this.waitingForTokenRequest=C.default.create())).push(E),!(this.currentTokenRequestId!==null&&!T)){var k=this.currentTokenRequestId=N();this.requestToken(this.tokenParams,this.authOptions,function(H,V){if(I.currentTokenRequestId>k){n.default.logAction(n.default.LOG_MINOR,"Auth._ensureValidAuthCredentials()","Discarding token request response; overtaken by newer one");return}I.currentTokenRequestId=null;var z=I.waitingForTokenRequest||x;if(I.waitingForTokenRequest=null,H){z(H);return}z(null,I.tokenDetails=V)})}},M.prototype._userSetClientId=function(T){if(typeof T=="string"||T===null){if(T==="*")throw new S.default('Cant use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, instantiate the library with {defaultTokenParams: {clientId: "*"}}), or if calling authorize(), pass it in as a tokenParam: authorize({clientId: "*"}, authOptions)',40012,400);var E=this._uncheckedSetClientId(T);if(E)throw E}else throw new S.default("clientId must be either a string or null",40012,400)},M.prototype._uncheckedSetClientId=function(T){if(this._tokenClientIdMismatch(T)){var E="Unexpected clientId mismatch: client has "+this.clientId+", requested "+T,I=new S.default(E,40102,401);return n.default.logAction(n.default.LOG_ERROR,"Auth._uncheckedSetClientId()",E),I}else return this.clientId=this.tokenParams.clientId=T,null},M.prototype._tokenClientIdMismatch=function(T){return!!(this.clientId&&this.clientId!=="*"&&T&&T!=="*"&&this.clientId!==T)},M.isTokenErr=function(T){return T.code&&T.code>=40140&&T.code<40150},M.prototype.revokeTokens=function(T,E,I){if(v(this.client.options))throw new S.default("Cannot revoke tokens when using token auth",40162,401);var j=this.client.options.keyName,k;if(typeof E=="function"?(I=E,k={}):k=E??{},I===void 0){if(this.client.options.promises)return m.promisify(this,"revokeTokens",[T,k]);I=x}var H=I,V=o.__assign({targets:T.map(function(U){return"".concat(U.type,":").concat(U.value)})},k),z=this.client.options.useBinaryProtocol?m.Format.msgpack:m.Format.json,_=m.defaultPostHeaders(this.client.options,z);this.client.options.headers&&m.mixin(_,this.client.options.headers);var w=m.encodeBody(V,z);g.default.post(this.client,"/keys/".concat(j,"/revokeTokens"),w,_,{newBatchResponse:"true"},null,function(U,B,G,W){if(U){H(U);return}var Q=W?B:m.decodeBody(B,z);H(null,Q)})},M}();e.default=D},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o;(function(n){n.Get="get",n.Delete="delete",n.Post="post",n.Put="put",n.Patch="patch"})(o||(o={})),e.default=o},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.HttpPaginatedResponse=e.PaginatedResult=void 0;var o=t(0),n=o.__importStar(t(1)),m=o.__importDefault(t(2)),C=o.__importDefault(t(14));function S(g){var L=g.match(/^\.\/(\w+)\?(.*)$/);return L&&L[2]&&n.parseQueryString(L[2])}function O(g){typeof g=="string"&&(g=g.split(","));for(var L={},x=0;x<g.length;x++){var p=g[x].match(/^\s*<(.+)>;\s*rel="(\w+)"$/);if(p){var y=S(p[1]);y&&(L[p[2]]=y)}}return L}function P(g,L,x){return!(x&&(L||typeof g.code=="number"))}var A=function(){function g(L,x,p,y,R,c){this.rest=L,this.path=x,this.headers=p,this.envelope=y??null,this.bodyHandler=R,this.useHttpPaginatedResponse=c||!1}return g.prototype.get=function(L,x){var p=this;C.default.get(this.rest,this.path,this.headers,L,this.envelope,function(y,R,c,u,r){p.handlePage(y,R,c,u,r,x)})},g.prototype.delete=function(L,x){var p=this;C.default.delete(this.rest,this.path,this.headers,L,this.envelope,function(y,R,c,u,r){p.handlePage(y,R,c,u,r,x)})},g.prototype.post=function(L,x,p){var y=this;C.default.post(this.rest,this.path,x,this.headers,L,this.envelope,function(R,c,u,r,i){p&&y.handlePage(R,c,u,r,i,p)})},g.prototype.put=function(L,x,p){var y=this;C.default.put(this.rest,this.path,x,this.headers,L,this.envelope,function(R,c,u,r,i){p&&y.handlePage(R,c,u,r,i,p)})},g.prototype.patch=function(L,x,p){var y=this;C.default.patch(this.rest,this.path,x,this.headers,L,this.envelope,function(R,c,u,r,i){p&&y.handlePage(R,c,u,r,i,p)})},g.prototype.handlePage=function(L,x,p,y,R,c){if(L&&P(L,x,this.useHttpPaginatedResponse)){m.default.logAction(m.default.LOG_ERROR,"PaginatedResource.handlePage()","Unexpected error getting resource: err = "+n.inspectError(L)),c==null||c(L);return}var u,r,i;try{u=this.bodyHandler(x,p||{},y)}catch(v){c==null||c(L||v);return}p&&(r=p.Link||p.link)&&(i=O(r)),this.useHttpPaginatedResponse?c(null,new a(this,u,p||{},R,i,L)):c(null,new b(this,u,i))},g}(),b=function(){function g(L,x,p){var y=this;this.resource=L,this.items=x;var R=this;p&&("first"in p&&(this.first=function(c){if(!c&&R.resource.rest.options.promises)return n.promisify(R,"first",[]);R.get(p.first,c)}),"current"in p&&(this.current=function(c){if(!c&&R.resource.rest.options.promises)return n.promisify(R,"current",[]);R.get(p.current,c)}),this.next=function(c){if(!c&&R.resource.rest.options.promises)return n.promisify(R,"next",[]);"next"in p?R.get(p.next,c):c(null)},this.hasNext=function(){return"next"in p},this.isLast=function(){var c;return!(!((c=y.hasNext)===null||c===void 0)&&c.call(y))})}return g.prototype.get=function(L,x){var p=this.resource;C.default.get(p.rest,p.path,p.headers,L,p.envelope,function(y,R,c,u,r){p.handlePage(y,R,c,u,r,x)})},g}();e.PaginatedResult=b;var a=function(g){o.__extends(L,g);function L(x,p,y,R,c,u){var r=g.call(this,x,p,c)||this;return r.statusCode=R,r.success=R<300&&R>=200,r.headers=y,r.errorCode=u&&u.code,r.errorMessage=u&&u.message,r}return L.prototype.toJSON=function(){return{items:this.items,statusCode:this.statusCode,success:this.success,headers:this.headers,errorCode:this.errorCode,errorMessage:this.errorMessage}},L}(b);e.HttpPaginatedResponse=a,e.default=A},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.isRetriable=void 0;var o=t(0),n=o.__importDefault(t(4)),m={DISCONNECTED:80003,SUSPENDED:80002,FAILED:8e4,CLOSING:80017,CLOSED:80017,UNKNOWN_CONNECTION_ERR:50002,UNKNOWN_CHANNEL_ERR:50001},C={disconnected:function(){return n.default.fromValues({statusCode:400,code:m.DISCONNECTED,message:"Connection to server temporarily unavailable"})},suspended:function(){return n.default.fromValues({statusCode:400,code:m.SUSPENDED,message:"Connection to server unavailable"})},failed:function(){return n.default.fromValues({statusCode:400,code:m.FAILED,message:"Connection failed or disconnected by server"})},closing:function(){return n.default.fromValues({statusCode:400,code:m.CLOSING,message:"Connection closing"})},closed:function(){return n.default.fromValues({statusCode:400,code:m.CLOSED,message:"Connection closed"})},unknownConnectionErr:function(){return n.default.fromValues({statusCode:500,code:m.UNKNOWN_CONNECTION_ERR,message:"Internal connection error"})},unknownChannelErr:function(){return n.default.fromValues({statusCode:500,code:m.UNKNOWN_CONNECTION_ERR,message:"Internal channel error"})}};function S(O){return!O.statusCode||!O.code||O.statusCode>=500?!0:Object.values(m).includes(O.code)}e.isRetriable=S,e.default=C},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o;(function(n){n[n.REQ_SEND=0]="REQ_SEND",n[n.REQ_RECV=1]="REQ_RECV",n[n.REQ_RECV_POLL=2]="REQ_RECV_POLL",n[n.REQ_RECV_STREAM=3]="REQ_RECV_STREAM"})(o||(o={})),e.default=o},function(l,e,t){(function(o,n){l.exports=n(t(6),t(5),t(58),t(11),t(40),t(32),t(24),t(27),t(28),t(59),t(60))})(this,function(o){return o})},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o=t(0),n=o.__importDefault(t(2)),m=function(){function C(S){this.members=S||[]}return C.prototype.call=function(){for(var S=[],O=0;O<arguments.length;O++)S[O]=arguments[O];for(var P=0,A=this.members;P<A.length;P++){var b=A[P];if(b)try{b.apply(void 0,S)}catch(a){n.default.logAction(n.default.LOG_ERROR,"Multicaster multiple callback handler","Unexpected exception: "+a+"; stack = "+a.stack)}}},C.prototype.push=function(){for(var S,O=[],P=0;P<arguments.length;P++)O[P]=arguments[P];(S=this.members).push.apply(S,O)},C.create=function(S){var O=new C(S);return Object.assign(function(){for(var P=[],A=0;A<arguments.length;A++)P[A]=arguments[A];return O.call.apply(O,P)},{push:function(P){return O.push(P)}})},C}();e.default=m},function(l,e,t){(function(o,n){l.exports=n(t(6))})(this,function(o){(function(){var n=o,m=n.lib,C=m.Base,S=n.enc,O=S.Utf8,P=n.algo;P.HMAC=C.extend({init:function(A,b){A=this._hasher=new A.init,typeof b=="string"&&(b=O.parse(b));var a=A.blockSize,g=a*4;b.sigBytes>g&&(b=A.finalize(b)),b.clamp();for(var L=this._oKey=b.clone(),x=this._iKey=b.clone(),p=L.words,y=x.words,R=0;R<a;R++)p[R]^=1549556828,y[R]^=909522486;L.sigBytes=x.sigBytes=g,this.reset()},reset:function(){var A=this._hasher;A.reset(),A.update(this._iKey)},update:function(A){return this._hasher.update(A),this},finalize:function(A){var b=this._hasher,a=b.finalize(A);b.reset();var g=b.finalize(this._oKey.clone().concat(a));return g}})})()})},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.isSuccessCode=void 0;var o;(function(m){m[m.Success=200]="Success",m[m.NoContent=204]="NoContent",m[m.BadRequest=400]="BadRequest",m[m.Unauthorized=401]="Unauthorized",m[m.Forbidden=403]="Forbidden",m[m.RequestTimeout=408]="RequestTimeout",m[m.InternalServerError=500]="InternalServerError"})(o||(o={}));function n(m){return m>=o.Success&&m<o.BadRequest}e.isSuccessCode=n,e.default=o},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o=t(0),n=o.__importDefault(t(10)),m=o.__importStar(t(1)),C=o.__importDefault(t(7)),S=o.__importDefault(t(2)),O=o.__importDefault(t(20)),P=o.__importDefault(t(4)),A=o.__importDefault(t(3)),b=n.default.Action,a=n.default.fromValues({action:b.CLOSE}),g=n.default.fromValues({action:b.DISCONNECT}),L=function(x){o.__extends(p,x);function p(y,R,c,u){var r=x.call(this)||this;return u&&(c.format=void 0,c.heartbeats=!0),r.connectionManager=y,y.registerProposedTransport(r),r.auth=R,r.params=c,r.timeouts=c.options.timeouts,r.format=c.format,r.isConnected=!1,r.isFinished=!1,r.isDisposed=!1,r.maxIdleInterval=null,r.idleTimer=null,r.lastActivity=null,r}return p.prototype.connect=function(){},p.prototype.close=function(){this.isConnected&&this.requestClose(),this.finish("closed",O.default.closed())},p.prototype.disconnect=function(y){this.isConnected&&this.requestDisconnect(),this.finish("disconnected",y||O.default.disconnected())},p.prototype.fail=function(y){this.isConnected&&this.requestDisconnect(),this.finish("failed",y||O.default.failed())},p.prototype.finish=function(y,R){var c;this.isFinished||(this.isFinished=!0,this.isConnected=!1,this.maxIdleInterval=null,clearTimeout((c=this.idleTimer)!==null&&c!==void 0?c:void 0),this.idleTimer=null,this.emit(y,R),this.dispose())},p.prototype.onProtocolMessage=function(y){switch(S.default.shouldLog(S.default.LOG_MICRO)&&S.default.logAction(S.default.LOG_MICRO,"Transport.onProtocolMessage()","received on "+this.shortName+": "+n.default.stringify(y)+"; connectionId = "+this.connectionManager.connectionId),this.onActivity(),y.action){case b.HEARTBEAT:S.default.logAction(S.default.LOG_MICRO,"Transport.onProtocolMessage()",this.shortName+" heartbeat; connectionId = "+this.connectionManager.connectionId),this.emit("heartbeat",y.id);break;case b.CONNECTED:this.onConnect(y),this.emit("connected",y.error,y.connectionId,y.connectionDetails,y);break;case b.CLOSED:this.onClose(y);break;case b.DISCONNECTED:this.onDisconnect(y);break;case b.ACK:this.emit("ack",y.msgSerial,y.count);break;case b.NACK:this.emit("nack",y.msgSerial,y.count,y.error);break;case b.SYNC:this.connectionManager.onChannelMessage(y,this);break;case b.ACTIVATE:break;case b.AUTH:this.auth.authorize(function(R){R&&S.default.logAction(S.default.LOG_ERROR,"Transport.onProtocolMessage()","Ably requested re-authentication, but unable to obtain a new token: "+m.inspectError(R))});break;case b.ERROR:if(S.default.logAction(S.default.LOG_MINOR,"Transport.onProtocolMessage()","received error action; connectionId = "+this.connectionManager.connectionId+"; err = "+A.default.Config.inspect(y.error)+(y.channel?", channel: "+y.channel:"")),y.channel===void 0){this.onFatalError(y);break}this.connectionManager.onChannelMessage(y,this);break;default:this.connectionManager.onChannelMessage(y,this)}},p.prototype.onConnect=function(y){if(this.isConnected=!0,!y.connectionDetails)throw new Error("Transport.onConnect(): Connect message recieved without connectionDetails");var R=y.connectionDetails.maxIdleInterval;R&&(this.maxIdleInterval=R+this.timeouts.realtimeRequestTimeout,this.onActivity())},p.prototype.onDisconnect=function(y){var R=y&&y.error;S.default.logAction(S.default.LOG_MINOR,"Transport.onDisconnect()","err = "+m.inspectError(R)),this.finish("disconnected",R)},p.prototype.onFatalError=function(y){var R=y&&y.error;S.default.logAction(S.default.LOG_MINOR,"Transport.onFatalError()","err = "+m.inspectError(R)),this.finish("failed",R)},p.prototype.onClose=function(y){var R=y&&y.error;S.default.logAction(S.default.LOG_MINOR,"Transport.onClose()","err = "+m.inspectError(R)),this.finish("closed",R)},p.prototype.requestClose=function(){S.default.logAction(S.default.LOG_MINOR,"Transport.requestClose()",""),this.send(a)},p.prototype.requestDisconnect=function(){S.default.logAction(S.default.LOG_MINOR,"Transport.requestDisconnect()",""),this.send(g)},p.prototype.ping=function(y){var R={action:n.default.Action.HEARTBEAT};y&&(R.id=y),this.send(n.default.fromValues(R))},p.prototype.dispose=function(){S.default.logAction(S.default.LOG_MINOR,"Transport.dispose()",""),this.isDisposed=!0,this.off()},p.prototype.onActivity=function(){this.maxIdleInterval&&(this.lastActivity=this.connectionManager.lastActivity=m.now(),this.setIdleTimer(this.maxIdleInterval+100))},p.prototype.setIdleTimer=function(y){var R=this;this.idleTimer||(this.idleTimer=setTimeout(function(){R.onIdleTimerExpire()},y))},p.prototype.onIdleTimerExpire=function(){if(!this.lastActivity||!this.maxIdleInterval)throw new Error("Transport.onIdleTimerExpire(): lastActivity/maxIdleInterval not set");this.idleTimer=null;var y=m.now()-this.lastActivity,R=this.maxIdleInterval-y;if(R<=0){var c="No activity seen from realtime in "+y+"ms; assuming connection has dropped";S.default.logAction(S.default.LOG_ERROR,"Transport.onIdleTimerExpire()",c),this.disconnect(new P.default(c,80003,408))}else this.setIdleTimer(R+100)},p.tryConnect=function(y,R,c,u,r){var i=new y(R,c,u),v,s=function(N){clearTimeout(v),r({event:this.event,error:N})},d=R.options.timeouts.realtimeRequestTimeout;v=setTimeout(function(){i.off(["preconnect","disconnected","failed"]),i.dispose(),s.call({event:"disconnected"},new P.default("Timeout waiting for transport to indicate itself viable",5e4,500))},d),i.on(["failed","disconnected"],s),i.on("preconnect",function(){S.default.logAction(S.default.LOG_MINOR,"Transport.tryConnect()","viable transport "+i),clearTimeout(v),i.off(["failed","disconnected"],s),r(null,i)}),i.connect()},p}(C.default);e.default=L},function(l,e,t){(function(o,n){l.exports=n(t(6),t(40),t(24))})(this,function(o){return function(){var n=o,m=n.lib,C=m.Base,S=m.WordArray,O=n.algo,P=O.MD5,A=O.EvpKDF=C.extend({cfg:C.extend({keySize:128/32,hasher:P,iterations:1}),init:function(b){this.cfg=this.cfg.extend(b)},compute:function(b,a){for(var g,L=this.cfg,x=L.hasher.create(),p=S.create(),y=p.words,R=L.keySize,c=L.iterations;y.length<R;){g&&x.update(g),g=x.update(b).finalize(a),x.reset();for(var u=1;u<c;u++)g=x.finalize(g),x.reset();p.concat(g)}return p.sigBytes=R*4,p}});n.EvpKDF=function(b,a,g){return A.create(g).compute(b,a)}}(),o.EvpKDF})},function(l,e,t){(function(o,n){l.exports=n(t(6),t(27))})(this,function(o){o.lib.Cipher||function(n){var m=o,C=m.lib,S=C.Base,O=C.WordArray,P=C.BufferedBlockAlgorithm,A=m.enc;A.Utf8;var b=A.Base64,a=m.algo,g=a.EvpKDF,L=C.Cipher=P.extend({cfg:S.extend(),createEncryptor:function(D,M){return this.create(this._ENC_XFORM_MODE,D,M)},createDecryptor:function(D,M){return this.create(this._DEC_XFORM_MODE,D,M)},init:function(D,M,T){this.cfg=this.cfg.extend(T),this._xformMode=D,this._key=M,this.reset()},reset:function(){P.reset.call(this),this._doReset()},process:function(D){return this._append(D),this._process()},finalize:function(D){D&&this._append(D);var M=this._doFinalize();return M},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function D(M){return typeof M=="string"?N:v}return function(M){return{encrypt:function(T,E,I){return D(E).encrypt(M,T,E,I)},decrypt:function(T,E,I){return D(E).decrypt(M,T,E,I)}}}}()});C.StreamCipher=L.extend({_doFinalize:function(){var D=this._process(!0);return D},blockSize:1});var x=m.mode={},p=C.BlockCipherMode=S.extend({createEncryptor:function(D,M){return this.Encryptor.create(D,M)},createDecryptor:function(D,M){return this.Decryptor.create(D,M)},init:function(D,M){this._cipher=D,this._iv=M}}),y=x.CBC=function(){var D=p.extend();D.Encryptor=D.extend({processBlock:function(T,E){var I=this._cipher,j=I.blockSize;M.call(this,T,E,j),I.encryptBlock(T,E),this._prevBlock=T.slice(E,E+j)}}),D.Decryptor=D.extend({processBlock:function(T,E){var I=this._cipher,j=I.blockSize,k=T.slice(E,E+j);I.decryptBlock(T,E),M.call(this,T,E,j),this._prevBlock=k}});function M(T,E,I){var j,k=this._iv;k?(j=k,this._iv=n):j=this._prevBlock;for(var H=0;H<I;H++)T[E+H]^=j[H]}return D}(),R=m.pad={},c=R.Pkcs7={pad:function(D,M){for(var T=M*4,E=T-D.sigBytes%T,I=E<<24|E<<16|E<<8|E,j=[],k=0;k<E;k+=4)j.push(I);var H=O.create(j,E);D.concat(H)},unpad:function(D){var M=D.words[D.sigBytes-1>>>2]&255;D.sigBytes-=M}};C.BlockCipher=L.extend({cfg:L.cfg.extend({mode:y,padding:c}),reset:function(){var D;L.reset.call(this);var M=this.cfg,T=M.iv,E=M.mode;this._xformMode==this._ENC_XFORM_MODE?D=E.createEncryptor:(D=E.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==D?this._mode.init(this,T&&T.words):(this._mode=D.call(E,this,T&&T.words),this._mode.__creator=D)},_doProcessBlock:function(D,M){this._mode.processBlock(D,M)},_doFinalize:function(){var D,M=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(M.pad(this._data,this.blockSize),D=this._process(!0)):(D=this._process(!0),M.unpad(D)),D},blockSize:128/32});var u=C.CipherParams=S.extend({init:function(D){this.mixIn(D)},toString:function(D){return(D||this.formatter).stringify(this)}}),r=m.format={},i=r.OpenSSL={stringify:function(D){var M,T=D.ciphertext,E=D.salt;return E?M=O.create([1398893684,1701076831]).concat(E).concat(T):M=T,M.toString(b)},parse:function(D){var M,T=b.parse(D),E=T.words;return E[0]==1398893684&&E[1]==1701076831&&(M=O.create(E.slice(2,4)),E.splice(0,4),T.sigBytes-=16),u.create({ciphertext:T,salt:M})}},v=C.SerializableCipher=S.extend({cfg:S.extend({format:i}),encrypt:function(D,M,T,E){E=this.cfg.extend(E);var I=D.createEncryptor(T,E),j=I.finalize(M),k=I.cfg;return u.create({ciphertext:j,key:T,iv:k.iv,algorithm:D,mode:k.mode,padding:k.padding,blockSize:D.blockSize,formatter:E.format})},decrypt:function(D,M,T,E){E=this.cfg.extend(E),M=this._parse(M,E.format);var I=D.createDecryptor(T,E).finalize(M.ciphertext);return I},_parse:function(D,M){return typeof D=="string"?M.parse(D,this):D}}),s=m.kdf={},d=s.OpenSSL={execute:function(D,M,T,E){E||(E=O.random(64/8));var I=g.create({keySize:M+T}).compute(D,E),j=O.create(I.words.slice(M),T*4);return I.sigBytes=M*4,u.create({key:I,iv:j,salt:E})}},N=C.PasswordBasedCipher=v.extend({cfg:v.cfg.extend({kdf:d}),encrypt:function(D,M,T,E){E=this.cfg.extend(E);var I=E.kdf.execute(T,D.keySize,D.ivSize);E.iv=I.iv;var j=v.encrypt.call(this,D,M,I.key,E);return j.mixIn(I),j},decrypt:function(D,M,T,E){E=this.cfg.extend(E),M=this._parse(M,E.format);var I=E.kdf.execute(T,D.keySize,D.ivSize,M.salt);E.iv=I.iv;var j=v.decrypt.call(this,D,M,I.key,E);return j}})}()})},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.Request=e.createRequest=void 0;var o=t(0),n=o.__importStar(t(1)),m=o.__importDefault(t(12)),C=o.__importDefault(t(3)),S=o.__importDefault(t(7)),O=t(4),P=o.__importDefault(t(8)),A=o.__importDefault(t(2)),b=o.__importDefault(t(21)),a=n.getGlobalObject(),g=function(){},L=a._ablyjs_jsonp={};L._=function(r){return L["_"+r]||g};var x=1,p="jsonp";function y(r,i,v,s,d,N,D){return N=N||P.default.TIMEOUTS,new c(void 0,r,i,n.copy(v),s,d,N,D)}e.createRequest=y;var R=function(r){o.__extends(i,r);function i(v,s,d){var N=r.call(this,v,s,d)||this;return N.shortName=p,d.stream=!1,N}return i.isAvailable=function(){return C.default.Config.jsonpSupported&&C.default.Config.allowComet},i.prototype.toString=function(){return"JSONPTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},i.prototype.createRequest=function(v,s,d,N,D,M,T){return M=(this===null||this===void 0?void 0:this.timeouts)||M||P.default.TIMEOUTS,y(v,s,d,N,D,M,T)},i}(m.default),c=function(r){o.__extends(i,r);function i(v,s,d,N,D,M,T,E){var I=r.call(this)||this;return v===void 0&&(v=x++),I.id=v,I.uri=s,I.params=N||{},I.params.rnd=n.cheapRandStr(),d&&(d["X-Ably-Version"]&&(I.params.v=d["X-Ably-Version"]),d["X-Ably-Lib"]&&(I.params.lib=d["X-Ably-Lib"])),I.body=D,I.method=E,I.requestMode=M,I.timeouts=T,I.requestComplete=!1,I}return i.prototype.exec=function(){var v=this,s=this.id,d=this.body,N=this.method,D=this.uri,M=this.params;M.callback="_ablyjs_jsonp._("+s+")",M.envelope="jsonp",d&&(M.body=d),N&&N!=="get"&&(M.method=N);var T=this.script=document.createElement("script"),E=D+n.toQueryString(M);T.src=E,T.src.split("/").slice(-1)[0]!==E.split("/").slice(-1)[0]&&A.default.logAction(A.default.LOG_ERROR,"JSONP Request.exec()","Warning: the browser appears to have truncated the script URI. This will likely result in the request failing due to an unparseable body param"),T.async=!0,T.type="text/javascript",T.charset="UTF-8",T.onerror=function(k){v.complete(new O.PartialErrorInfo("JSONP script error (event: "+C.default.Config.inspect(k)+")",null,400))},L["_"+s]=function(k){if(k.statusCode){var H=k.response;if(k.statusCode==204)v.complete(null,null,null,k.statusCode);else if(!H)v.complete(new O.PartialErrorInfo("Invalid server response: no envelope detected",null,500));else if(k.statusCode<400||n.isArray(H))v.complete(null,H,k.headers,k.statusCode);else{var V=H.error||new O.PartialErrorInfo("Error response received from server",null,k.statusCode);v.complete(V)}}else v.complete(null,k)};var I=this.requestMode==b.default.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout;this.timer=setTimeout(this.abort.bind(this),I);var j=document.getElementsByTagName("head")[0];j.insertBefore(T,j.firstChild)},i.prototype.complete=function(v,s,d,N){if(d=d||{},!this.requestComplete){this.requestComplete=!0;var D=void 0;s&&(D=typeof s=="string"?"text/plain":"application/json",d["content-type"]=D,this.emit("data",s)),this.emit("complete",v,s,d,!0,N),this.dispose()}},i.prototype.abort=function(){this.dispose()},i.prototype.dispose=function(){var v=this.timer;v&&(clearTimeout(v),this.timer=null);var s=this.script;s.parentNode&&s.parentNode.removeChild(s),delete L[this.id],this.emit("disposed")},i}(S.default);e.Request=c;function u(r){return a.JSONPTransport=R,R.isAvailable()&&(r.supportedTransports[p]=R),R}e.default=u},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o=t(0),n=o.__importStar(t(1)),m=o.__importDefault(t(2)),C=o.__importDefault(t(8)),S=o.__importDefault(t(17)),O=o.__importDefault(t(46)),P=o.__importDefault(t(19)),A=o.__importDefault(t(33)),b=o.__importDefault(t(4)),a=o.__importDefault(t(49)),g=o.__importDefault(t(18)),L=o.__importDefault(t(3)),x=o.__importDefault(t(9)),p=o.__importDefault(t(15)),y=o.__importDefault(t(14)),R=function(){},c=function(){function r(i){if(!i){var v="no options provided";throw m.default.logAction(m.default.LOG_ERROR,"Rest()",v),new Error(v)}var s=C.default.objectifyOptions(i);s.log&&m.default.setLog(s.log.level,s.log.handler),m.default.logAction(m.default.LOG_MICRO,"Rest()","initialized with clientOptions "+L.default.Config.inspect(i));var d=this.options=C.default.normaliseOptions(s);if(d.key){var N=d.key.match(/^([^:\s]+):([^:.\s]+)$/);if(!N){var v="invalid key parameter";throw m.default.logAction(m.default.LOG_ERROR,"Rest()",v),new b.default(v,40400,404)}d.keyName=N[1],d.keySecret=N[2]}if("clientId"in d)if(typeof d.clientId=="string"||d.clientId===null){if(d.clientId==="*")throw new b.default('Cant use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, use {defaultTokenParams: {clientId: "*"}})',40012,400)}else throw new b.default("clientId must be either a string or null",40012,400);m.default.logAction(m.default.LOG_MINOR,"Rest()","started; version = "+C.default.version),this.baseUri=this.authority=function(D){return C.default.getHttpScheme(d)+D+":"+C.default.getPort(d,!1)},this._currentFallback=null,this.serverTimeOffset=null,this.http=new L.default.Http(d),this.auth=new S.default(this,d),this.channels=new u(this),this.push=new O.default(this)}return r.prototype.stats=function(i,v){if(v===void 0)if(typeof i=="function")v=i,i=null;else{if(this.options.promises)return n.promisify(this,"stats",[i]);v=R}var s=n.defaultGetHeaders(this.options),d=this.options.useBinaryProtocol?n.Format.msgpack:n.Format.json,N=this.http.supportsLinkHeaders?void 0:d;this.options.headers&&n.mixin(s,this.options.headers),new P.default(this,"/stats",s,N,function(D,M,T){for(var E=T?D:JSON.parse(D),I=0;I<E.length;I++)E[I]=a.default.fromValues(E[I]);return E}).get(i,v)},r.prototype.time=function(i,v){var s=this;if(v===void 0){if(typeof i=="function")v=i,i=null;else if(this.options.promises)return n.promisify(this,"time",[i])}var d=v||R,N=n.defaultGetHeaders(this.options);this.options.headers&&n.mixin(N,this.options.headers);var D=function(M){return s.authority(M)+"/time"};this.http.do(g.default.Get,this,D,N,null,i,function(M,T,E,I){if(M){d(M);return}I||(T=JSON.parse(T));var j=T[0];if(!j){d(new b.default("Internal error (unexpected result type from GET /time)",5e4,500));return}s.serverTimeOffset=j-n.now(),d(null,j)})},r.prototype.request=function(i,v,s,d,N,D){var M=this.options.useBinaryProtocol,T=M?L.default.Config.msgpack.encode:JSON.stringify,E=M?L.default.Config.msgpack.decode:JSON.parse,I=M?n.Format.msgpack:n.Format.json,j=this.http.supportsLinkHeaders?void 0:I;s=s||{};var k=i.toLowerCase(),H=k=="get"?n.defaultGetHeaders(this.options,I):n.defaultPostHeaders(this.options,I);if(D===void 0){if(this.options.promises)return n.promisify(this,"request",[i,v,s,d,N]);D=R}typeof d!="string"&&(d=T(d)),this.options.headers&&n.mixin(H,this.options.headers),N&&n.mixin(H,N);var V=new P.default(this,v,H,j,function(z,_,w){return n.ensureArray(w?z:E(z))},!0);if(!n.arrIn(L.default.Http.methods,k))throw new b.default("Unsupported method "+k,40500,405);n.arrIn(L.default.Http.methodsWithBody,k)?V[k](s,d,D):V[k](s,D)},r.prototype.batchPublish=function(i,v){if(v===void 0){if(this.options.promises)return n.promisify(this,"batchPublish",[i]);v=R}var s=v,d,N;n.isArray(i)?(d=i,N=!1):(d=[i],N=!0);var D=this.options.useBinaryProtocol?n.Format.msgpack:n.Format.json,M=n.defaultPostHeaders(this.options,D);this.options.headers&&n.mixin(M,this.options.headers);var T=n.encodeBody(d,D);y.default.post(this,"/messages",T,M,{newBatchResponse:"true"},null,function(E,I,j,k){if(E){s(E);return}var H=k?I:n.decodeBody(I,D);N?s(null,H[0]):s(null,H)})},r.prototype.batchPresence=function(i,v){if(v===void 0){if(this.options.promises)return n.promisify(this,"batchPresence",[i]);v=R}var s=v,d=this.options.useBinaryProtocol?n.Format.msgpack:n.Format.json,N=n.defaultPostHeaders(this.options,d);this.options.headers&&n.mixin(N,this.options.headers);var D=i.join(",");y.default.get(this,"/presence",N,{newBatchResponse:"true",channels:D},null,function(M,T,E,I){if(M){s(M);return}var j=I?T:n.decodeBody(T,d);s(null,j)})},r.prototype.setLog=function(i){m.default.setLog(i.level,i.handler)},r.Promise=function(i){return i=C.default.objectifyOptions(i),i.promises=!0,new r(i)},r.Callbacks=r,r.Platform=L.default,r.Message=x.default,r.PresenceMessage=p.default,r}(),u=function(){function r(i){this.rest=i,this.all=Object.create(null)}return r.prototype.get=function(i,v){i=String(i);var s=this.all[i];return s?v&&s.setOptions(v):this.all[i]=s=new A.default(this.rest,i,v),s},r.prototype.release=function(i){delete this.all[String(i)]},r}();e.default=c},function(l,e,t){(function(o,n){l.exports=n(t(6))})(this,function(o){return o.enc.Utf8})},function(l,e,t){(function(o,n){l.exports=n(t(6))})(this,function(o){return function(n){var m=o,C=m.lib,S=C.WordArray,O=C.Hasher,P=m.algo,A=[],b=[];(function(){function L(R){for(var c=n.sqrt(R),u=2;u<=c;u++)if(!(R%u))return!1;return!0}function x(R){return(R-(R|0))*4294967296|0}for(var p=2,y=0;y<64;)L(p)&&(y<8&&(A[y]=x(n.pow(p,1/2))),b[y]=x(n.pow(p,1/3)),y++),p++})();var a=[],g=P.SHA256=O.extend({_doReset:function(){this._hash=new S.init(A.slice(0))},_doProcessBlock:function(L,x){for(var p=this._hash.words,y=p[0],R=p[1],c=p[2],u=p[3],r=p[4],i=p[5],v=p[6],s=p[7],d=0;d<64;d++){if(d<16)a[d]=L[x+d]|0;else{var N=a[d-15],D=(N<<25|N>>>7)^(N<<14|N>>>18)^N>>>3,M=a[d-2],T=(M<<15|M>>>17)^(M<<13|M>>>19)^M>>>10;a[d]=D+a[d-7]+T+a[d-16]}var E=r&i^~r&v,I=y&R^y&c^R&c,j=(y<<30|y>>>2)^(y<<19|y>>>13)^(y<<10|y>>>22),k=(r<<26|r>>>6)^(r<<21|r>>>11)^(r<<7|r>>>25),H=s+k+E+b[d]+a[d],V=j+I;s=v,v=i,i=r,r=u+H|0,u=c,c=R,R=y,y=H+V|0}p[0]=p[0]+y|0,p[1]=p[1]+R|0,p[2]=p[2]+c|0,p[3]=p[3]+u|0,p[4]=p[4]+r|0,p[5]=p[5]+i|0,p[6]=p[6]+v|0,p[7]=p[7]+s|0},_doFinalize:function(){var L=this._data,x=L.words,p=this._nDataBytes*8,y=L.sigBytes*8;return x[y>>>5]|=128<<24-y%32,x[(y+64>>>9<<4)+14]=n.floor(p/4294967296),x[(y+64>>>9<<4)+15]=p,L.sigBytes=x.length*4,this._process(),this._hash},clone:function(){var L=O.clone.call(this);return L._hash=this._hash.clone(),L}});m.SHA256=O._createHelper(g),m.HmacSHA256=O._createHmacHelper(g)}(Math),o.SHA256})},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o=t(0),n=o.__importStar(t(1)),m=o.__importDefault(t(7)),C=o.__importDefault(t(2)),S=o.__importDefault(t(34)),O=o.__importDefault(t(9)),P=o.__importDefault(t(4)),A=o.__importDefault(t(19)),b=o.__importDefault(t(14)),a=o.__importDefault(t(3));function g(){}var L=9;function x(R){return n.arrEvery(R,function(c){return!c.id})}function p(R){var c=R||{};if(c.cipher){if(!a.default.Crypto)throw new Error("Encryption not enabled; use ably.encryption.js instead");var u=a.default.Crypto.getCipher(c.cipher);c.cipher=u.cipherParams,c.channelCipher=u.cipher}else"cipher"in c&&(c.cipher=void 0,c.channelCipher=null);return c}var y=function(R){o.__extends(c,R);function c(u,r,i){var v=R.call(this)||this;return C.default.logAction(C.default.LOG_MINOR,"Channel()","started; name = "+r),v.rest=u,v.name=r,v.basePath="/channels/"+encodeURIComponent(r),v.presence=new S.default(v),v.channelOptions=p(i),v}return c.prototype.setOptions=function(u){this.channelOptions=p(u)},c.prototype.history=function(u,r){if(C.default.logAction(C.default.LOG_MICRO,"Channel.history()","channel = "+this.name),r===void 0)if(typeof u=="function")r=u,u=null;else{if(this.rest.options.promises)return n.promisify(this,"history",arguments);r=g}this._history(u,r)},c.prototype._history=function(u,r){var i=this.rest,v=i.options.useBinaryProtocol?n.Format.msgpack:n.Format.json,s=this.rest.http.supportsLinkHeaders?void 0:v,d=n.defaultGetHeaders(i.options,v);i.options.headers&&n.mixin(d,i.options.headers);var N=this.channelOptions;new A.default(i,this.basePath+"/messages",d,s,function(D,M,T){return O.default.fromResponseBody(D,N,T?void 0:v)}).get(u,r)},c.prototype.publish=function(){var u=this,r=arguments.length,i=arguments[0],v=arguments[1],s=arguments[r-1],d,N;if(typeof s!="function"){if(this.rest.options.promises)return n.promisify(this,"publish",arguments);s=g}if(typeof i=="string"||i===null)d=[O.default.fromValues({name:i,data:v})],N=arguments[2];else if(n.isObject(i))d=[O.default.fromValues(i)],N=arguments[1];else if(n.isArray(i))d=O.default.fromValuesArray(i),N=arguments[1];else throw new P.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);(typeof N!="object"||!N)&&(N={});var D=this.rest,M=D.options,T=M.useBinaryProtocol?n.Format.msgpack:n.Format.json,E=D.options.idempotentRestPublishing,I=n.defaultPostHeaders(D.options,T);if(M.headers&&n.mixin(I,M.headers),E&&x(d)){var j=n.randomString(L);n.arrForEach(d,function(k,H){k.id=j+":"+H.toString()})}O.default.encodeArray(d,this.channelOptions,function(k){if(k){s(k);return}var H=O.default.getMessagesSize(d),V=M.maxMessageSize;if(H>V){s(new P.default("Maximum size of messages that can be published at once exceeded ( was "+H+" bytes; limit is "+V+" bytes)",40009,400));return}u._publish(O.default.serialize(d,T),I,N,s)})},c.prototype._publish=function(u,r,i,v){b.default.post(this.rest,this.basePath+"/messages",u,r,i,null,v)},c.prototype.status=function(u){if(typeof u!="function"&&this.rest.options.promises)return n.promisify(this,"status",[]);var r=this.rest.options.useBinaryProtocol?n.Format.msgpack:n.Format.json,i=n.defaultPostHeaders(this.rest.options,r);b.default.get(this.rest,this.basePath,i,{},r,u||g)},c}(m.default);e.default=y},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o=t(0),n=o.__importStar(t(1)),m=o.__importDefault(t(7)),C=o.__importDefault(t(2)),S=o.__importDefault(t(19)),O=o.__importDefault(t(15));function P(){}var A=function(b){o.__extends(a,b);function a(g){var L=b.call(this)||this;return L.channel=g,L.basePath=g.basePath+"/presence",L}return a.prototype.get=function(g,L){if(C.default.logAction(C.default.LOG_MICRO,"Presence.get()","channel = "+this.channel.name),L===void 0)if(typeof g=="function")L=g,g=null;else{if(this.channel.rest.options.promises)return n.promisify(this,"get",arguments);L=P}var x=this.channel.rest,p=x.options.useBinaryProtocol?n.Format.msgpack:n.Format.json,y=this.channel.rest.http.supportsLinkHeaders?void 0:p,R=n.defaultGetHeaders(x.options,p);x.options.headers&&n.mixin(R,x.options.headers);var c=this.channel.channelOptions;new S.default(x,this.basePath,R,y,function(u,r,i){return O.default.fromResponseBody(u,c,i?void 0:p)}).get(g,L)},a.prototype.history=function(g,L){return C.default.logAction(C.default.LOG_MICRO,"Presence.history()","channel = "+this.channel.name),this._history(g,L)},a.prototype._history=function(g,L){if(L===void 0)if(typeof g=="function")L=g,g=null;else{if(this.channel.rest.options.promises)return n.promisify(this,"_history",[g]);L=P}var x=this.channel.rest,p=x.options.useBinaryProtocol?n.Format.msgpack:n.Format.json,y=this.channel.rest.http.supportsLinkHeaders?void 0:p,R=n.defaultGetHeaders(x.options,p);x.options.headers&&n.mixin(R,x.options.headers);var c=this.channel.channelOptions;new S.default(x,this.basePath+"/history",R,y,function(u,r,i){return O.default.fromResponseBody(u,c,i?void 0:p)}).get(g,L)},a}(m.default);e.default=A},function(l,e,t){(function(o){Object.defineProperty(e,"__esModule",{value:!0}),e.TransportParams=void 0;var n=t(0),m=n.__importDefault(t(10)),C=n.__importStar(t(1)),S=n.__importStar(t(52)),O=n.__importStar(t(8)),P=n.__importDefault(t(3)),A=n.__importDefault(t(7)),b=n.__importDefault(t(36)),a=n.__importDefault(t(2)),g=n.__importDefault(t(37)),L=n.__importStar(t(20)),x=n.__importStar(t(4)),p=n.__importDefault(t(17)),y=n.__importDefault(t(9)),R=n.__importDefault(t(23)),c=n.__importDefault(t(53)),u=n.__importDefault(t(26)),r=n.__importDefault(t(25)),i=function(){var z;return typeof P.default.WebStorage<"u"&&((z=P.default.WebStorage)===null||z===void 0?void 0:z.localSupported)},v=function(){var z;return typeof P.default.WebStorage<"u"&&((z=P.default.WebStorage)===null||z===void 0?void 0:z.sessionSupported)},s=m.default.Action,d=function(){},N="ably-transport-preference",D="ably-connection-recovery";function M(){var z,_;return v()&&((_=(z=P.default.WebStorage)===null||z===void 0?void 0:z.getSession)===null||_===void 0?void 0:_.call(z,D))}function T(z){var _,w;return v()&&((w=(_=P.default.WebStorage)===null||_===void 0?void 0:_.setSession)===null||w===void 0?void 0:w.call(_,D,z))}function E(){var z,_;return v()&&((_=(z=P.default.WebStorage)===null||z===void 0?void 0:z.removeSession)===null||_===void 0?void 0:_.call(z,D))}function I(z,_){return C.arrIndexOf(P.default.Defaults.transportPreferenceOrder,z.shortName)>C.arrIndexOf(P.default.Defaults.transportPreferenceOrder,_.shortName)}function j(z,_,w){var U;if(z.channel!==_.channel||(U=z.action)!==s.PRESENCE&&U!==s.MESSAGE||U!==_.action)return!1;var B=U===s.PRESENCE?"presence":"messages",G=z[B].concat(_[B]),W=y.default.getMessagesSize(G);return W>w||!C.allSame(G,"clientId")||!C.arrEvery(G,function(Q){return!Q.id})?!1:(z[B]=G,!0)}function k(z){try{return JSON.parse(z)}catch{return null}}var H=function(){function z(_,w,U,B){this.options=_,this.host=w,this.mode=U,this.connectionKey=B,this.format=_.useBinaryProtocol?C.Format.msgpack:C.Format.json}return z.prototype.getConnectParams=function(_){var w=_?C.copy(_):{},U=this.options;switch(this.mode){case"upgrade":w.upgrade=this.connectionKey;break;case"resume":w.resume=this.connectionKey;break;case"recover":{var B=k(U.recover);B&&(w.recover=B.connectionKey);break}}return U.clientId!==void 0&&(w.clientId=U.clientId),U.echoMessages===!1&&(w.echo="false"),this.format!==void 0&&(w.format=this.format),this.stream!==void 0&&(w.stream=this.stream),this.heartbeats!==void 0&&(w.heartbeats=this.heartbeats),w.v=O.default.protocolVersion,w.agent=(0,O.getAgentString)(this.options),U.transportParams!==void 0&&C.mixin(w,U.transportParams),w},z.prototype.toString=function(){var _="[mode="+this.mode;return this.host&&(_+=",host="+this.host),this.connectionKey&&(_+=",connectionKey="+this.connectionKey),this.format&&(_+=",format="+this.format),_+="]",_},z}();e.TransportParams=H;var V=function(z){n.__extends(_,z);function _(w,U){var B=z.call(this)||this;B.disconnectedRetryCount=0,_.initTransports(),B.realtime=w,B.options=U;var G=U.timeouts,W=G.preferenceConnectTimeout+G.realtimeRequestTimeout;if(B.states={initialized:{state:"initialized",terminal:!1,queueEvents:!0,sendEvents:!1,failState:"disconnected"},connecting:{state:"connecting",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:W,failState:"disconnected"},connected:{state:"connected",terminal:!1,queueEvents:!1,sendEvents:!0,failState:"disconnected"},synchronizing:{state:"connected",terminal:!1,queueEvents:!0,sendEvents:!1,forceQueueEvents:!0,failState:"disconnected"},disconnected:{state:"disconnected",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:G.disconnectedRetryTimeout,failState:"disconnected"},suspended:{state:"suspended",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:G.suspendedRetryTimeout,failState:"suspended"},closing:{state:"closing",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:G.realtimeRequestTimeout,failState:"closed"},closed:{state:"closed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"closed"},failed:{state:"failed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"failed"}},B.state=B.states.initialized,B.errorReason=null,B.queuedMessages=new b.default,B.msgSerial=0,B.connectionDetails=void 0,B.connectionId=void 0,B.connectionKey=void 0,B.connectionStateTtl=G.connectionStateTtl,B.maxIdleInterval=null,B.transports=C.intersect(U.transports||O.default.defaultTransports,_.supportedTransports),B.baseTransport=C.intersect(O.default.baseTransportOrder,B.transports)[0],B.upgradeTransports=C.intersect(B.transports,O.default.upgradeTransports),B.transportPreference=null,B.httpHosts=O.default.getHosts(U),B.activeProtocol=null,B.proposedTransports=[],B.pendingTransports=[],B.host=null,B.lastAutoReconnectAttempt=null,B.lastActivity=null,B.forceFallbackHost=!1,B.connectCounter=0,a.default.logAction(a.default.LOG_MINOR,"Realtime.ConnectionManager()","started"),a.default.logAction(a.default.LOG_MICRO,"Realtime.ConnectionManager()","requested transports = ["+(U.transports||O.default.defaultTransports)+"]"),a.default.logAction(a.default.LOG_MICRO,"Realtime.ConnectionManager()","available transports = ["+B.transports+"]"),a.default.logAction(a.default.LOG_MICRO,"Realtime.ConnectionManager()","http hosts = ["+B.httpHosts+"]"),!B.transports.length){var Q="no requested transports available";throw a.default.logAction(a.default.LOG_ERROR,"realtime.ConnectionManager()",Q),new Error(Q)}var $=P.default.Config.addEventListener;return $&&(v()&&typeof U.recover=="function"&&$("beforeunload",B.persistConnection.bind(B)),U.closeOnUnload===!0&&$("beforeunload",function(){a.default.logAction(a.default.LOG_MAJOR,"Realtime.ConnectionManager()","beforeunload event has triggered the connection to close as closeOnUnload is true"),B.requestState({state:"closing"})}),$("online",function(){B.state==B.states.disconnected||B.state==B.states.suspended?(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager caught browser online event","reattempting connection"),B.requestState({state:"connecting"})):B.state==B.states.connecting&&(B.pendingTransports.forEach(function(Z){Z.off()}),B.disconnectAllTransports(),B.startConnect())}),$("offline",function(){B.state==B.states.connected&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager caught browser offline event","disconnecting active transport"),B.disconnectAllTransports())})),B}return _.initTransports=function(){(0,c.default)(_),C.arrForEach(P.default.Transports,function(w){w(_)})},_.prototype.createTransportParams=function(w,U){return new H(this.options,w,U,this.connectionKey)},_.prototype.getTransportParams=function(w){var U=this,B=function(G){if(U.connectionKey){G("resume");return}if(typeof U.options.recover=="string"){G("recover");return}var W=U.options.recover,Q=M();if(Q&&typeof W=="function"){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Calling clientOptions-provided recover function with last session data"),W(Q,function($){$?(U.options.recover=Q.recoveryKey,G("recover")):G("clean")});return}G("clean")};B(function(G){var W=U.createTransportParams(null,G);if(G==="recover"){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport recovery mode = recover; recoveryKey = "+U.options.recover);var Q=k(U.options.recover);Q&&(U.msgSerial=Q.msgSerial)}else a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport params = "+W.toString());w(W)})},_.prototype.tryATransport=function(w,U,B){var G=this;a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.tryATransport()","trying "+U),u.default.tryConnect(_.supportedTransports[U],this,this.realtime.auth,w,function(W,Q){var $=G.state;if($==G.states.closing||$==G.states.closed||$==G.states.failed){Q&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.tryATransport()","connection "+$.state+" while we were attempting the transport; closing "+Q),Q.close()),B(!0);return}if(W){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.tryATransport()","transport "+U+" "+W.event+", err: "+W.error.toString()),p.default.isTokenErr(W.error)&&!(G.errorReason&&p.default.isTokenErr(G.errorReason))?(G.errorReason=W.error,G.realtime.auth._forceNewToken(null,null,function(Z){if(Z){G.actOnErrorFromAuthorize(Z);return}G.tryATransport(w,U,B)})):W.event==="failed"?(G.notifyState({state:"failed",error:W.error}),B(!0)):W.event==="disconnected"&&((0,L.isRetriable)(W.error)?B(!1):(G.notifyState({state:G.states.connecting.failState,error:W.error}),B(!0)));return}a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.tryATransport()","viable transport "+U+"; setting pending"),G.setTransportPending(Q,w),B(null,Q)})},_.prototype.setTransportPending=function(w,U){var B=this,G=U.mode;a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.setTransportPending()","transport = "+w+"; mode = "+G),C.arrDeleteValue(this.proposedTransports,w),this.pendingTransports.push(w);var W=P.default.Defaults.transportPreferenceOrder[P.default.Defaults.transportPreferenceOrder.length-1];w.once("connected",function($,Z,tt){G=="upgrade"&&B.activeProtocol?w.shortName!==W&&C.arrIn(B.getUpgradePossibilities(),W)&&B.activeProtocol?setTimeout(function(){B.scheduleTransportActivation($,w,Z,tt)},B.options.timeouts.parallelUpgradeDelay):B.scheduleTransportActivation($,w,Z,tt):(B.activateTransport($,w,Z,tt),P.default.Config.nextTick(function(){B.connectImpl(U)})),G==="recover"&&B.options.recover&&(B.options.recover=null,B.unpersistConnection())});var Q=this;w.on(["disconnected","closed","failed"],function($){Q.deactivateTransport(w,this.event,$)}),this.emit("transport.pending",w)},_.prototype.scheduleTransportActivation=function(w,U,B,G){var W=this,Q=this.activeProtocol&&this.activeProtocol.getTransport(),$=function(){U.disconnect(),C.arrDeleteValue(W.pendingTransports,U)};if(this.state!==this.states.connected&&this.state!==this.states.connecting){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+U.shortName),$();return}if(Q&&!I(U,Q)){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+U.shortName+" is no better than current active transport "+Q.shortName+" - abandoning upgrade"),$();return}a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Scheduling transport upgrade; transport = "+U);var Z=null;if(!U.isConnected){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Proposed transport "+U.shortName+"is no longer connected; abandoning upgrade"),$();return}if(this.state===this.states.connected)a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Currently connected, so temporarily pausing events until the upgrade is complete"),this.state=this.states.synchronizing,Z=this.activeProtocol;else if(this.state!==this.states.connecting){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Current connection state ("+this.state.state+(this.state===this.states.synchronizing?", but with an upgrade already in progress":"")+") is not valid to upgrade in; abandoning upgrade to "+U.shortName),$();return}a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Syncing transport; transport = "+U);var tt=function(){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Activating transport; transport = "+U),U.send(m.default.fromValues({action:s.ACTIVATE})),W.activateTransport(w,U,B,G),W.state===W.states.synchronizing?(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, sending queued messages on upgraded transport; transport = "+U),W.state=W.states.connected):a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.scheduleTransportActivation()","Pre-upgrade protocol idle, but state is now "+W.state.state+", so leaving unchanged"),W.state.sendEvents&&W.sendQueuedMessages()};Z?Z.onceIdle(tt):tt()},_.prototype.activateTransport=function(w,U,B,G){var W=this;a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.activateTransport()","transport = "+U),w&&a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.activateTransport()","error = "+w),B&&a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionId =  "+B),G&&a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.activateTransport()","connectionDetails =  "+JSON.stringify(G)),this.persistTransportPreference(U);var Q=this.state,$=this.states.connected.state;if(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.activateTransport()","current state = "+Q.state),Q.state==this.states.closing.state||Q.state==this.states.closed.state||Q.state==this.states.failed.state)return a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.activateTransport()","Disconnecting transport and abandoning"),U.disconnect(),!1;if(C.arrDeleteValue(this.pendingTransports,U),!U.isConnected)return a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.activateTransport()","Declining to activate transport "+U+" since it appears to no longer be connected"),!1;var Z=this.activeProtocol;this.activeProtocol=new S.default(U),this.host=U.params.host;var tt=G.connectionKey;if(tt&&this.connectionKey!=tt&&this.setConnection(B,G,!!w),this.onConnectionDetailsUpdate(G,U),P.default.Config.nextTick(function(){U.on("connected",function(X,it,ct){W.onConnectionDetailsUpdate(ct,U),W.emit("update",new g.default($,$,null,X))})}),Q.state===this.states.connected.state?w&&(this.errorReason=this.realtime.connection.errorReason=w,this.emit("update",new g.default($,$,null,w))):(this.notifyState({state:"connected",error:w}),this.errorReason=this.realtime.connection.errorReason=w||null),this.emit("transport.active",U),Z)if(Z.messageQueue.count()>0&&a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.activateTransport()","Previous active protocol (for transport "+Z.transport.shortName+", new one is "+U.shortName+") finishing with "+Z.messageQueue.count()+" messages still pending"),Z.transport===U){var rt="Assumption violated: activating a transport that was also the transport for the previous active protocol; transport = "+U.shortName+"; stack = "+new Error().stack;a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.activateTransport()",rt)}else Z.finish();return C.safeArrForEach(this.pendingTransports,function(X){if(X===U){var it="Assumption violated: activating a transport that is still marked as a pending transport; transport = "+U.shortName+"; stack = "+new Error().stack;a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.activateTransport()",it),C.arrDeleteValue(W.pendingTransports,U)}else X.disconnect()}),C.safeArrForEach(this.proposedTransports,function(X){X===U?(a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.activateTransport()","Assumption violated: activating a transport that is still marked as a proposed transport; transport = "+U.shortName+"; stack = "+new Error().stack),C.arrDeleteValue(W.proposedTransports,U)):X.dispose()}),!0},_.prototype.deactivateTransport=function(w,U,B){var G=this.activeProtocol,W=G&&G.getTransport()===w,Q=C.arrDeleteValue(this.pendingTransports,w),$=C.arrDeleteValue(this.proposedTransports,w),Z=this.noTransportsScheduledForActivation();if(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","transport = "+w),a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.deactivateTransport()","state = "+U+(W?"; was active":Q?"; was pending":$?"; was proposed":"")+(Z?"":"; another transport is scheduled for activation")),B&&B.message&&a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","reason =  "+B.message),W&&(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","Getting, clearing, and requeuing "+this.activeProtocol.messageQueue.count()+" pending messages"),this.queuePendingMessages(G.getPendingMessages()),P.default.Config.nextTick(function(){G.clearPendingMessages()}),this.activeProtocol=this.host=null),this.emit("transport.inactive",w),W&&Z||W&&U==="failed"||U==="closed"||G===null&&Q&&this.pendingTransports.length===0){if(U==="disconnected"&&B&&B.statusCode>500&&this.httpHosts.length>1){this.unpersistTransportPreference(),this.forceFallbackHost=!0,this.notifyState({state:U,error:B,retryImmediately:!0});return}var tt=U==="failed"&&p.default.isTokenErr(B)?"disconnected":U;this.notifyState({state:tt,error:B});return}W&&U==="disconnected"&&this.state!==this.states.synchronizing&&(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.deactivateTransport()","wasActive but another transport is connected and scheduled for activation, so going into the connecting state until it activates"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),this.notifyState({state:"connecting",error:B}))},_.prototype.noTransportsScheduledForActivation=function(){return C.isEmpty(this.pendingTransports)||this.pendingTransports.every(function(w){return!w.isConnected})},_.prototype.setConnection=function(w,U,B){var G=this.connectionId,W=G&&G!==w,Q=!G&&B;(W||Q)&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.setConnection()","Resetting msgSerial"),this.msgSerial=0,this.queuedMessages.resetSendAttempted()),this.connectionId!==w&&a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.setConnection()","New connectionId; reattaching any attached channels"),this.realtime.connection.id=this.connectionId=w,this.realtime.connection.key=this.connectionKey=U.connectionKey},_.prototype.clearConnection=function(){this.realtime.connection.id=this.connectionId=void 0,this.realtime.connection.key=this.connectionKey=void 0,this.msgSerial=0,this.unpersistConnection()},_.prototype.createRecoveryKey=function(){return this.connectionKey?JSON.stringify({connectionKey:this.connectionKey,msgSerial:this.msgSerial,channelSerials:this.realtime.channels.channelSerials()}):null},_.prototype.checkConnectionStateFreshness=function(){if(!(!this.lastActivity||!this.connectionId)){var w=C.now()-this.lastActivity;w>this.connectionStateTtl+this.maxIdleInterval&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.checkConnectionStateFreshness()","Last known activity from realtime was "+w+"ms ago; discarding connection state"),this.clearConnection(),this.states.connecting.failState="suspended")}},_.prototype.persistConnection=function(){if(v()){var w=this.createRecoveryKey();w&&T({recoveryKey:w,disconnectedAt:C.now(),location:o.location,clientId:this.realtime.auth.clientId})}},_.prototype.unpersistConnection=function(){E()},_.prototype.getError=function(){return this.errorReason||this.getStateError()},_.prototype.getStateError=function(){var w,U;return(U=(w=L.default)[this.state.state])===null||U===void 0?void 0:U.call(w)},_.prototype.activeState=function(){return this.state.queueEvents||this.state.sendEvents},_.prototype.enactStateChange=function(w){var U=w.current==="failed"?a.default.LOG_ERROR:a.default.LOG_MAJOR;a.default.logAction(U,"Connection state",w.current+(w.reason?"; reason: "+w.reason:"")),a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.enactStateChange","setting new state: "+w.current+"; reason = "+(w.reason&&w.reason.message));var B=this.state=this.states[w.current];w.reason&&(this.errorReason=w.reason,this.realtime.connection.errorReason=w.reason),(B.terminal||B.state==="suspended")&&this.clearConnection(),this.emit("connectionstate",w)},_.prototype.startTransitionTimer=function(w){var U=this;a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","transitionState: "+w.state),this.transitionTimer&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.startTransitionTimer()","clearing already-running timer"),clearTimeout(this.transitionTimer)),this.transitionTimer=setTimeout(function(){U.transitionTimer&&(U.transitionTimer=null,a.default.logAction(a.default.LOG_MINOR,"ConnectionManager "+w.state+" timer expired","requesting new state: "+w.failState),U.notifyState({state:w.failState}))},w.retryDelay)},_.prototype.cancelTransitionTimer=function(){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.cancelTransitionTimer()",""),this.transitionTimer&&(clearTimeout(this.transitionTimer),this.transitionTimer=null)},_.prototype.startSuspendTimer=function(){var w=this;this.suspendTimer||(this.suspendTimer=setTimeout(function(){w.suspendTimer&&(w.suspendTimer=null,a.default.logAction(a.default.LOG_MINOR,"ConnectionManager suspend timer expired","requesting new state: suspended"),w.states.connecting.failState="suspended",w.notifyState({state:"suspended"}))},this.connectionStateTtl))},_.prototype.checkSuspendTimer=function(w){w!=="disconnected"&&w!=="suspended"&&w!=="connecting"&&this.cancelSuspendTimer()},_.prototype.cancelSuspendTimer=function(){this.states.connecting.failState="disconnected",this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null)},_.prototype.startRetryTimer=function(w){var U=this;this.retryTimer=setTimeout(function(){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager retry timer expired","retrying"),U.retryTimer=null,U.requestState({state:"connecting"})},w)},_.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},_.prototype.notifyState=function(w){var U=this,B,G,W=w.state,Q=W==="disconnected"&&(this.state===this.states.connected||this.state===this.states.synchronizing||w.retryImmediately||this.state===this.states.connecting&&w.error&&p.default.isTokenErr(w.error)&&!(this.errorReason&&p.default.isTokenErr(this.errorReason)));if(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.notifyState()","new state: "+W+(Q?"; will retry connection immediately":"")),W!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(w.state),(W==="suspended"||W==="connected")&&(this.disconnectedRetryCount=0),!this.state.terminal)){var $=this.states[w.state],Z=$.retryDelay;$.state==="disconnected"&&(this.disconnectedRetryCount++,Z=C.getRetryTime($.retryDelay,this.disconnectedRetryCount));var tt=new g.default(this.state.state,$.state,Z,w.error||((G=(B=L.default)[$.state])===null||G===void 0?void 0:G.call(B)));if(Q){var rt=function(){U.state===U.states.disconnected&&(U.lastAutoReconnectAttempt=C.now(),U.requestState({state:"connecting"}))},X=this.lastAutoReconnectAttempt&&C.now()-this.lastAutoReconnectAttempt+1;X&&X<1e3?(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.notifyState()","Last reconnect attempt was only "+X+"ms ago, waiting another "+(1e3-X)+"ms before trying again"),setTimeout(rt,1e3-X)):P.default.Config.nextTick(rt)}else(W==="disconnected"||W==="suspended")&&this.startRetryTimer(Z);(W==="disconnected"&&!Q||W==="suspended"||$.terminal)&&P.default.Config.nextTick(function(){U.disconnectAllTransports()}),W=="connected"&&!this.activeProtocol&&a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.notifyState()","Broken invariant: attempted to go into connected state, but there is no active protocol"),this.enactStateChange(tt),this.state.sendEvents?this.sendQueuedMessages():this.state.queueEvents||(this.realtime.channels.propogateConnectionInterruption(W,tt.reason),this.failQueuedMessages(tt.reason))}},_.prototype.requestState=function(w){var U=this,B,G,W=w.state;if(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.requestState()","requested state: "+W+"; current state: "+this.state.state),W!=this.state.state&&(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(W),!(W=="connecting"&&this.state.state=="connected")&&!(W=="closing"&&this.state.state=="closed"))){var Q=this.states[W],$=new g.default(this.state.state,Q.state,null,w.error||((G=(B=L.default)[Q.state])===null||G===void 0?void 0:G.call(B)));this.enactStateChange($),W=="connecting"&&P.default.Config.nextTick(function(){U.startConnect()}),W=="closing"&&this.closeImpl()}},_.prototype.startConnect=function(){var w=this;if(this.state!==this.states.connecting){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.startConnect()","Must be in connecting state to connect, but was "+this.state.state);return}var U=this.realtime.auth,B=++this.connectCounter,G=function(){w.checkConnectionStateFreshness(),w.getTransportParams(function(Q){if(Q.mode==="recover"&&Q.options.recover){var $=k(Q.options.recover);$&&w.realtime.channels.recoverChannels($.channelSerials)}B===w.connectCounter&&w.connectImpl(Q,B)})};if(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.startConnect()","starting connection"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),U.method==="basic")G();else{var W=function(Q){B===w.connectCounter&&(Q?w.actOnErrorFromAuthorize(Q):G())};this.errorReason&&p.default.isTokenErr(this.errorReason)?U._forceNewToken(null,null,W):U._ensureValidAuthCredentials(!1,W)}},_.prototype.connectImpl=function(w,U){var B=this.state.state;B!==this.states.connecting.state&&B!==this.states.connected.state?a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.connectImpl()","Must be in connecting state to connect (or connected to upgrade), but was "+B):this.pendingTransports.length?a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.connectImpl()","Transports "+this.pendingTransports[0].toString()+" currently pending; taking no action"):B==this.states.connected.state?this.upgradeIfNeeded(w):this.transports.length>1&&this.getTransportPreference()?this.connectPreference(w,U):this.connectBase(w,U)},_.prototype.connectPreference=function(w,U){var B=this,G=this.getTransportPreference(),W=!1;C.arrIn(this.transports,G)||(this.unpersistTransportPreference(),this.connectImpl(w,U)),a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.connectPreference()","Trying to connect with stored transport preference "+G);var Q=setTimeout(function(){W=!0,B.state.state!==B.states.connected.state&&(a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.connectPreference()","Shortcircuit connection attempt with "+G+" failed; clearing preference and trying from scratch"),B.disconnectAllTransports(),B.unpersistTransportPreference()),B.connectImpl(w,U)},this.options.timeouts.preferenceConnectTimeout);w.host=this.httpHosts[0],this.tryATransport(w,G,function($,Z){clearTimeout(Q),W&&Z?(Z.off(),Z.disconnect(),C.arrDeleteValue(B.pendingTransports,Z)):!Z&&!$&&(B.unpersistTransportPreference(),B.connectImpl(w,U))})},_.prototype.connectBase=function(w,U){var B=this,G=function(tt){B.notifyState({state:B.states.connecting.failState,error:tt})},W=this.httpHosts.slice(),Q=function(tt,rt){U===B.connectCounter&&!rt&&!tt&&Z()};a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.connectBase()","Trying to connect with base transport "+this.baseTransport);var $=W.shift();if(!$){G(new x.default("Unable to connect (no available host)",80003,404));return}w.host=$;var Z=function(){if(!W.length){G(new x.default("Unable to connect (and no more fallback hosts to try)",80003,404));return}if(!B.realtime.http.checkConnectivity){G(new x.PartialErrorInfo("Internal error: Http.checkConnectivity not set",null,500));return}B.realtime.http.checkConnectivity(function(tt,rt){if(U===B.connectCounter){if(tt){G(tt);return}if(!rt){G(new x.default("Unable to connect (network unreachable)",80003,404));return}w.host=C.arrPopRandomElement(W),B.tryATransport(w,B.baseTransport,Q)}})};if(this.forceFallbackHost&&W.length){this.forceFallbackHost=!1,Z();return}this.tryATransport(w,this.baseTransport,Q)},_.prototype.getUpgradePossibilities=function(){var w=this.activeProtocol.getTransport().shortName,U=C.arrIndexOf(this.upgradeTransports,w);return this.upgradeTransports.slice(U+1)},_.prototype.upgradeIfNeeded=function(w){var U=this,B=this.getUpgradePossibilities();a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.upgradeIfNeeded()","upgrade possibilities: "+P.default.Config.inspect(B)),B.length&&C.arrForEach(B,function(G){var W=U.createTransportParams(w.host,"upgrade");U.tryATransport(W,G,d)})},_.prototype.closeImpl=function(){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.closeImpl()","closing connection"),this.cancelSuspendTimer(),this.startTransitionTimer(this.states.closing),C.safeArrForEach(this.pendingTransports,function(w){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing pending transport: "+w),w&&w.close()}),C.safeArrForEach(this.proposedTransports,function(w){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.closeImpl()","Disposing of proposed transport: "+w),w&&w.dispose()}),this.activeProtocol&&(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.closeImpl()","Closing active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().close()),this.notifyState({state:"closed"})},_.prototype.onAuthUpdated=function(w,U){var B=this,G;switch(this.state.state){case"connected":{if(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Sending AUTH message on active transport"),(this.pendingTransports.length||this.proposedTransports.length)&&this.state!==this.states.synchronizing){this.disconnectAllTransports(!0);var W=this.activeProtocol.getTransport().params;P.default.Config.nextTick(function(){B.state.state==="connected"&&B.upgradeIfNeeded(W)})}var Q=(G=this.activeProtocol)===null||G===void 0?void 0:G.getTransport();Q&&Q.onAuthUpdated&&Q.onAuthUpdated(w);var $=m.default.fromValues({action:s.AUTH,auth:{accessToken:w.token}});this.send($);var Z=function(){B.off(tt),U(null,w)},tt=function(X){X.current==="failed"&&(B.off(Z),B.off(tt),U(X.reason||B.getStateError()))};this.once("connectiondetails",Z),this.on("connectionstate",tt);break}case"connecting":a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Aborting current connection attempts in order to start again with the new auth details"),this.disconnectAllTransports();default:{a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Connection state is "+this.state.state+"; waiting until either connected or failed");var rt=function(X){switch(X.current){case"connected":B.off(rt),U(null,w);break;case"failed":case"closed":case"suspended":B.off(rt),U(X.reason||B.getStateError());break}};this.on("connectionstate",rt),this.state.state==="connecting"?this.startConnect():this.requestState({state:"connecting"})}}},_.prototype.disconnectAllTransports=function(w){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.disconnectAllTransports()","Disconnecting all transports"+(w?" except the active transport":"")),this.connectCounter++,C.safeArrForEach(this.pendingTransports,function(U){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting pending transport: "+U),U&&U.disconnect()}),this.pendingTransports=[],C.safeArrForEach(this.proposedTransports,function(U){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disposing of proposed transport: "+U),U&&U.dispose()}),this.proposedTransports=[],this.activeProtocol&&!w&&(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().disconnect())},_.prototype.send=function(w,U,B){B=B||d;var G=this.state;if(G.sendEvents){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.send()","sending event"),this.sendImpl(new S.PendingMessage(w,B));return}var W=U&&G.queueEvents||G.forceQueueEvents;if(!W){var Q="rejecting event, queueEvent was "+U+", state was "+G.state;a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.send()",Q),B(this.errorReason||new x.default(Q,9e4,400));return}a.default.shouldLog(a.default.LOG_MICRO)&&a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.send()","queueing msg; "+m.default.stringify(w)),this.queue(w,B)},_.prototype.sendImpl=function(w){var U=w.message;w.ackRequired&&!w.sendAttempted&&(U.msgSerial=this.msgSerial++);try{this.activeProtocol.send(w)}catch(B){a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.sendImpl()","Unexpected exception in transport.send(): "+B.stack)}},_.prototype.queue=function(w,U){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.queue()","queueing event");var B=this.queuedMessages.last(),G=this.options.maxMessageSize;B&&!B.sendAttempted&&j(B.message,w,G)?(B.merged||(B.callback=R.default.create([B.callback]),B.merged=!0),B.callback.push(U)):this.queuedMessages.push(new S.PendingMessage(w,U))},_.prototype.sendQueuedMessages=function(){a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.sendQueuedMessages()","sending "+this.queuedMessages.count()+" queued messages");for(var w;w=this.queuedMessages.shift();)this.sendImpl(w)},_.prototype.queuePendingMessages=function(w){w&&w.length&&(a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.queuePendingMessages()","queueing "+w.length+" pending messages"),this.queuedMessages.prepend(w))},_.prototype.failQueuedMessages=function(w){var U=this.queuedMessages.count();U>0&&(a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.failQueuedMessages()","failing "+U+" queued messages, err = "+C.inspectError(w)),this.queuedMessages.completeAllMessages(w))},_.prototype.onChannelMessage=function(w,U){var B=this.activeProtocol&&U===this.activeProtocol.getTransport(),G=C.arrIn(this.pendingTransports,U)&&this.state==this.states.synchronizing;B||G?this.realtime.channels.onChannelMessage(w):C.arrIndexOf([s.ACK,s.NACK,s.ERROR],w.action)>-1?this.realtime.channels.onChannelMessage(w):a.default.logAction(a.default.LOG_MICRO,"ConnectionManager.onChannelMessage()","received message "+JSON.stringify(w)+"on defunct transport; discarding")},_.prototype.ping=function(w,U){var B=this;if(w){a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.ping()","transport = "+w);var G=function(){w.off("heartbeat",$),U(new x.default("Timeout waiting for heartbeat response",5e4,500))},W=C.now(),Q=C.cheapRandStr(),$=function(it){if(it===Q){w.off("heartbeat",$),clearTimeout(Z);var ct=C.now()-W;U(null,ct)}},Z=setTimeout(G,this.options.timeouts.realtimeRequestTimeout);w.on("heartbeat",$),w.ping(Q);return}if(this.state.state!=="connected"){U(new x.default("Unable to ping service; not connected",4e4,400));return}var tt=!1,rt=function(it,ct){B.off("transport.active",X),tt||(tt=!0,U(it,ct))},X=function(){tt||(tt=!0,P.default.Config.nextTick(function(){B.ping(null,U)}))};this.on("transport.active",X),this.ping(this.activeProtocol.getTransport(),rt)},_.prototype.abort=function(w){this.activeProtocol.getTransport().fail(w)},_.prototype.registerProposedTransport=function(w){this.proposedTransports.push(w)},_.prototype.getTransportPreference=function(){var w,U;return this.transportPreference||i()&&((U=(w=P.default.WebStorage)===null||w===void 0?void 0:w.get)===null||U===void 0?void 0:U.call(w,N))},_.prototype.persistTransportPreference=function(w){var U,B;C.arrIn(O.default.upgradeTransports,w.shortName)&&(this.transportPreference=w.shortName,i()&&((B=(U=P.default.WebStorage)===null||U===void 0?void 0:U.set)===null||B===void 0||B.call(U,N,w.shortName)))},_.prototype.unpersistTransportPreference=function(){var w,U;this.transportPreference=null,i()&&((U=(w=P.default.WebStorage)===null||w===void 0?void 0:w.remove)===null||U===void 0||U.call(w,N))},_.prototype.actOnErrorFromAuthorize=function(w){if(w.code===40171)this.notifyState({state:"failed",error:w});else if(w.code===40102)this.notifyState({state:"failed",error:w});else if(w.statusCode===r.default.Forbidden){var U="Client configured authentication provider returned 403; failing the connection";a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.actOnErrorFromAuthorize()",U),this.notifyState({state:"failed",error:new x.default(U,80019,403,w)})}else{var U="Client configured authentication provider request failed";a.default.logAction(a.default.LOG_MINOR,"ConnectionManager.actOnErrorFromAuthorize",U),this.notifyState({state:this.state.failState,error:new x.default(U,80019,401,w)})}},_.prototype.onConnectionDetailsUpdate=function(w,U){if(w){this.connectionDetails=w,w.maxMessageSize&&(this.options.maxMessageSize=w.maxMessageSize);var B=w.clientId;if(B){var G=this.realtime.auth._uncheckedSetClientId(B);if(G){a.default.logAction(a.default.LOG_ERROR,"ConnectionManager.onConnectionDetailsUpdate()",G.message),U.fail(G);return}}var W=w.connectionStateTtl;W&&(this.connectionStateTtl=W),this.maxIdleInterval=w.maxIdleInterval,this.emit("connectiondetails",w)}},_.supportedTransports={},_}(A.default);e.default=V}).call(this,t(13))},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o=t(0),n=o.__importDefault(t(7)),m=o.__importDefault(t(2)),C=function(S){o.__extends(O,S);function O(){var P=S.call(this)||this;return P.messages=[],P}return O.prototype.count=function(){return this.messages.length},O.prototype.push=function(P){this.messages.push(P)},O.prototype.shift=function(){return this.messages.shift()},O.prototype.last=function(){return this.messages[this.messages.length-1]},O.prototype.copyAll=function(){return this.messages.slice()},O.prototype.append=function(P){this.messages.push.apply(this.messages,P)},O.prototype.prepend=function(P){this.messages.unshift.apply(this.messages,P)},O.prototype.completeMessages=function(P,A,b){m.default.logAction(m.default.LOG_MICRO,"MessageQueue.completeMessages()","serial = "+P+"; count = "+A),b=b||null;var a=this.messages;if(a.length===0)throw new Error("MessageQueue.completeMessages(): completeMessages called on any empty MessageQueue");var g=a[0];if(g){var L=g.message.msgSerial,x=P+A;if(x>L)for(var p=a.splice(0,x-L),y=0,R=p;y<R.length;y++){var c=R[y];c.callback(b)}a.length==0&&this.emit("idle")}},O.prototype.completeAllMessages=function(P){this.completeMessages(0,Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,P)},O.prototype.resetSendAttempted=function(){for(var P=0,A=this.messages;P<A.length;P++){var b=A[P];b.sendAttempted=!1}},O.prototype.clear=function(){m.default.logAction(m.default.LOG_MICRO,"MessageQueue.clear()","clearing "+this.messages.length+" messages"),this.messages=[],this.emit("idle")},O}(n.default);e.default=C},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function n(m,C,S,O){this.previous=m,this.current=C,S&&(this.retryIn=S),O&&(this.reason=O)}return n}();e.default=o},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o=t(0),n=o.__importDefault(t(10)),m=o.__importDefault(t(7)),C=o.__importStar(t(1)),S=o.__importDefault(t(33)),O=o.__importDefault(t(2)),P=o.__importDefault(t(54)),A=o.__importDefault(t(9)),b=o.__importDefault(t(39)),a=o.__importStar(t(4)),g=o.__importDefault(t(15)),L=o.__importDefault(t(20)),x=n.default.Action,p=function(){};function y(c){if(c&&"params"in c&&!C.isObject(c.params))return new a.default("options.params must be an object",4e4,400);if(c&&"modes"in c){if(!C.isArray(c.modes))return new a.default("options.modes must be an array",4e4,400);for(var u=0;u<c.modes.length;u++){var r=c.modes[u];if(!r||typeof r!="string"||!C.arrIn(n.default.channelModes,String.prototype.toUpperCase.call(r)))return new a.default("Invalid channel mode: "+r,4e4,400)}}}var R=function(c){o.__extends(u,c);function u(r,i,v){var s=c.call(this,r,i,v)||this;return s.retryCount=0,s.history=function(d,N){if(O.default.logAction(O.default.LOG_MICRO,"RealtimeChannel.history()","channel = "+this.name),N===void 0)if(typeof d=="function")N=d,d=null;else{if(this.rest.options.promises)return C.promisify(this,"history",arguments);N=p}if(d&&d.untilAttach){if(this.state!=="attached"){N(new a.default("option untilAttach requires the channel to be attached",4e4,400));return}if(!this.properties.attachSerial){N(new a.default("untilAttach was specified and channel is attached, but attachSerial is not defined",4e4,400));return}delete d.untilAttach,d.from_serial=this.properties.attachSerial}S.default.prototype._history.call(this,d,N)},s.whenState=function(d,N){return m.default.prototype.whenState.call(s,d,s.state,N)},O.default.logAction(O.default.LOG_MINOR,"RealtimeChannel()","started; name = "+i),s.realtime=r,s.presence=new P.default(s),s.connectionManager=r.connection.connectionManager,s.state="initialized",s.subscriptions=new m.default,s.syncChannelSerial=void 0,s.properties={attachSerial:void 0,channelSerial:void 0},s.setOptions(v),s.errorReason=null,s._requestedFlags=null,s._mode=null,s._attachResume=!1,s._decodingContext={channelOptions:s.channelOptions,plugins:r.options.plugins||{},baseEncodedPreviousPayload:void 0},s._lastPayload={messageId:null,protocolMessageChannelSerial:null,decodeFailureRecoveryInProgress:null},s._allChannelChanges=new m.default,s}return u.prototype.invalidStateError=function(){return new a.default("Channel operation failed as channel state is "+this.state,90001,400,this.errorReason||void 0)},u.processListenerArgs=function(r){return r=Array.prototype.slice.call(r),typeof r[0]=="function"&&r.unshift(null),r[r.length-1]==null&&r.pop(),r},u.prototype.setOptions=function(r,i){if(!i&&this.rest.options.promises)return C.promisify(this,"setOptions",arguments);var v=i||function(d){d&&O.default.logAction(O.default.LOG_ERROR,"RealtimeChannel.setOptions()","Set options failed: "+d.toString())},s=y(r);if(s){v(s);return}S.default.prototype.setOptions.call(this,r),this._decodingContext&&(this._decodingContext.channelOptions=this.channelOptions),this._shouldReattachToSetOptions(r)?(this.attachImpl(),this._allChannelChanges.once(["attached","update","detached","failed"],function(d){switch(this.event){case"update":case"attached":v==null||v(null);return;default:v==null||v(d.reason);return}})):v()},u.prototype._shouldReattachToSetOptions=function(r){if(!(this.state==="attached"||this.state==="attaching"))return!1;if(r!=null&&r.params){var i=Object.assign({},r.params);if(delete i.agent,Object.keys(i).length!==0&&!this.params||this.params&&!C.shallowEquals(this.params,i))return!0}return!!(r!=null&&r.modes&&(!this.modes||!C.arrEquals(r.modes,this.modes)))},u.prototype.publish=function(){for(var r=this,i=[],v=0;v<arguments.length;v++)i[v]=arguments[v];var s=i[0],d=i.length,N=i[d-1];if(typeof N!="function"){if(this.realtime.options.promises)return C.promisify(this,"publish",arguments);N=p,++d}if(!this.connectionManager.activeState()){N(this.connectionManager.getError());return}if(d==2)if(C.isObject(s))s=[A.default.fromValues(s)];else if(C.isArray(s))s=A.default.fromValuesArray(s);else throw new a.default("The single-argument form of publish() expects a message object or an array of message objects",40013,400);else s=[A.default.fromValues({name:i[0],data:i[1]})];var D=this.realtime.options.maxMessageSize;A.default.encodeArray(s,this.channelOptions,function(M){if(M){N(M);return}var T=A.default.getMessagesSize(s);if(T>D){N(new a.default("Maximum size of messages that can be published at once exceeded ( was "+T+" bytes; limit is "+D+" bytes)",40009,400));return}r.__publish(s,N)})},u.prototype.__publish=function(r,i){O.default.logAction(O.default.LOG_MICRO,"RealtimeChannel.publish()","message count = "+r.length);var v=this.state;switch(v){case"failed":case"suspended":i(a.default.fromValues(this.invalidStateError()));break;default:{O.default.logAction(O.default.LOG_MICRO,"RealtimeChannel.publish()","sending message; channel state is "+v);var s=new n.default;s.action=x.MESSAGE,s.channel=this.name,s.messages=r,this.sendMessage(s,i);break}}},u.prototype.onEvent=function(r){O.default.logAction(O.default.LOG_MICRO,"RealtimeChannel.onEvent()","received message");for(var i=this.subscriptions,v=0;v<r.length;v++){var s=r[v];i.emit(s.name,s)}},u.prototype.attach=function(r,i){var v;if(typeof r=="function"?(i=r,v=null):v=r,!i){if(this.realtime.options.promises)return C.promisify(this,"attach",arguments);i=function(s){s&&O.default.logAction(O.default.LOG_MAJOR,"RealtimeChannel.attach()","Channel attach failed: "+s.toString())}}if(v)O.default.deprecated("channel.attach() with flags","channel.setOptions() with channelOptions.params"),this._requestedFlags=v;else if(this.state==="attached"){i(null,null);return}this._attach(!1,null,i)},u.prototype._attach=function(r,i,v){v||(v=function(d){d&&O.default.logAction(O.default.LOG_ERROR,"RealtimeChannel._attach()","Channel attach failed: "+d.toString())});var s=this.connectionManager;if(!s.activeState()){v(s.getError());return}(this.state!=="attaching"||r)&&this.requestState("attaching",i),this.once(function(d){switch(this.event){case"attached":v==null||v(null,d);break;case"detached":case"suspended":case"failed":v==null||v(d.reason||s.getError()||new a.default("Unable to attach; reason unknown; state = "+this.event,9e4,500));break;case"detaching":v==null||v(new a.default("Attach request superseded by a subsequent detach request",9e4,409));break}})},u.prototype.attachImpl=function(){O.default.logAction(O.default.LOG_MICRO,"RealtimeChannel.attachImpl()","sending ATTACH message");var r=n.default.fromValues({action:x.ATTACH,channel:this.name,params:this.channelOptions.params,channelSerial:this.properties.channelSerial});this._requestedFlags?r.encodeModesToFlags(this._requestedFlags):this.channelOptions.modes&&r.encodeModesToFlags(C.allToUpperCase(this.channelOptions.modes)),this._attachResume&&r.setFlag("ATTACH_RESUME"),this._lastPayload.decodeFailureRecoveryInProgress&&(r.channelSerial=this._lastPayload.protocolMessageChannelSerial),this.sendMessage(r,p)},u.prototype.detach=function(r){if(!r){if(this.realtime.options.promises)return C.promisify(this,"detach",arguments);r=p}var i=this.connectionManager;if(!i.activeState()){r(i.getError());return}switch(this.state){case"suspended":this.notifyState("detached"),r();break;case"detached":r();break;case"failed":r(new a.default("Unable to detach; channel state = failed",90001,400));break;default:this.requestState("detaching");case"detaching":this.once(function(v){switch(this.event){case"detached":r();break;case"attached":case"suspended":case"failed":r(v.reason||i.getError()||new a.default("Unable to detach; reason unknown; state = "+this.event,9e4,500));break;case"attaching":r(new a.default("Detach request superseded by a subsequent attach request",9e4,409));break}})}},u.prototype.detachImpl=function(r){O.default.logAction(O.default.LOG_MICRO,"RealtimeChannel.detach()","sending DETACH message");var i=n.default.fromValues({action:x.DETACH,channel:this.name});this.sendMessage(i,r||p)},u.prototype.subscribe=function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var v=u.processListenerArgs(r),s=v[0],d=v[1],N=v[2];if(!N&&this.realtime.options.promises)return C.promisify(this,"subscribe",[s,d]);if(this.state==="failed"){N==null||N(a.default.fromValues(this.invalidStateError()));return}return s&&typeof s=="object"&&!Array.isArray(s)?this._subscribeFilter(s,d):this.subscriptions.on(s,d),this.attach(N||p)},u.prototype._subscribeFilter=function(r,i){var v=function(s){var d,N,D,M,T,E,I={name:s.name,refTimeserial:(N=(d=s.extras)===null||d===void 0?void 0:d.ref)===null||N===void 0?void 0:N.timeserial,refType:(M=(D=s.extras)===null||D===void 0?void 0:D.ref)===null||M===void 0?void 0:M.type,isRef:!!(!((E=(T=s.extras)===null||T===void 0?void 0:T.ref)===null||E===void 0)&&E.timeserial),clientId:s.clientId};Object.entries(r).find(function(j){var k=j[0],H=j[1];return H!==void 0?I[k]!==H:!1})||i(s)};this._addFilteredSubscription(r,i,v),this.subscriptions.on(v)},u.prototype._addFilteredSubscription=function(r,i,v){var s;if(this.filteredSubscriptions||(this.filteredSubscriptions=new Map),this.filteredSubscriptions.has(i)){var d=this.filteredSubscriptions.get(i);d.set(r,((s=d==null?void 0:d.get(r))===null||s===void 0?void 0:s.concat(v))||[v])}else this.filteredSubscriptions.set(i,new Map([[r,[v]]]))},u.prototype._getAndDeleteFilteredSubscriptions=function(r,i){var v=this;if(!this.filteredSubscriptions)return[];if(!i&&r)return Array.from(this.filteredSubscriptions.entries()).map(function(D){var M,T=D[0],E=D[1],I=E.get(r);return E.delete(r),E.size===0&&((M=v.filteredSubscriptions)===null||M===void 0||M.delete(T)),I}).reduce(function(D,M){var T;return M?(T=D).concat.apply(T,M):D},[]);if(!i||!this.filteredSubscriptions.has(i))return[];var s=this.filteredSubscriptions.get(i);if(!r){var d=Array.from(s.values()).reduce(function(D,M){return D.concat.apply(D,M)},[]);return this.filteredSubscriptions.delete(i),d}var N=s.get(r);return s.delete(r),N||[]},u.prototype.unsubscribe=function(){for(var r=this,i,v=[],s=0;s<arguments.length;s++)v[s]=arguments[s];var d=u.processListenerArgs(v),N=d[0],D=d[1];if(typeof N=="object"&&!D||!((i=this.filteredSubscriptions)===null||i===void 0)&&i.has(D)){this._getAndDeleteFilteredSubscriptions(N,D).forEach(function(M){return r.subscriptions.off(M)});return}this.subscriptions.off(N,D)},u.prototype.sync=function(){switch(this.state){case"initialized":case"detaching":case"detached":throw new a.PartialErrorInfo("Unable to sync to channel; not attached",4e4)}var r=this.connectionManager;if(!r.activeState())throw r.getError();var i=n.default.fromValues({action:x.SYNC,channel:this.name});this.syncChannelSerial&&(i.channelSerial=this.syncChannelSerial),r.send(i)},u.prototype.sendMessage=function(r,i){this.connectionManager.send(r,this.realtime.options.queueMessages,i)},u.prototype.sendPresence=function(r,i){var v=n.default.fromValues({action:x.PRESENCE,channel:this.name,presence:C.isArray(r)?g.default.fromValuesArray(r):[g.default.fromValues(r)]});this.sendMessage(v,i)},u.prototype.onMessage=function(r){(r.action===x.ATTACHED||r.action===x.MESSAGE||r.action===x.PRESENCE)&&this.setChannelSerial(r.channelSerial);var i,v=!1;switch(r.action){case x.ATTACHED:{this.properties.attachSerial=r.channelSerial,this._mode=r.getMode(),this.params=r.params||{};var s=r.decodeModesFromFlags();this.modes=s&&C.allToLowerCase(s)||void 0;var d=r.hasFlag("RESUMED"),N=r.hasFlag("HAS_PRESENCE"),D=r.hasFlag("HAS_BACKLOG");if(this.state==="attached"){d||this.presence.onAttached(N);var M=new b.default(this.state,this.state,d,D,r.error);this._allChannelChanges.emit("update",M),(!d||this.channelOptions.updateOnAttached)&&this.emit("update",M)}else this.state==="detaching"?this.checkPendingState():this.notifyState("attached",r.error,d,N,D);break}case x.DETACHED:{var T=r.error?a.default.fromValues(r.error):new a.default("Channel detached",90001,404);this.state==="detaching"?this.notifyState("detached",T):this.state==="attaching"?this.notifyState("suspended",T):this.requestState("attaching",T);break}case x.SYNC:if(v=!0,i=this.syncChannelSerial=r.channelSerial,!r.presence)break;case x.PRESENCE:{for(var E=r.presence,I=r.id,j=r.connectionId,k=r.timestamp,H=this.channelOptions,V=void 0,z=0;z<E.length;z++)try{V=E[z],g.default.decode(V,H),V.connectionId||(V.connectionId=j),V.timestamp||(V.timestamp=k),V.id||(V.id=I+":"+z)}catch(W){O.default.logAction(O.default.LOG_ERROR,"RealtimeChannel.onMessage()",W.toString())}this.presence.setPresence(E,v,i);break}case x.MESSAGE:{if(this.state!=="attached"){O.default.logAction(O.default.LOG_MAJOR,"RealtimeChannel.onMessage()",'Message "'+r.id+'" skipped as this channel "'+this.name+'" state is not "attached" (state is "'+this.state+'").');return}var _=r.messages,w=_[0],U=_[_.length-1],I=r.id,j=r.connectionId,k=r.timestamp;if(w.extras&&w.extras.delta&&w.extras.delta.from!==this._lastPayload.messageId){var B='Delta message decode failure - previous message not available for message "'+r.id+'" on this channel "'+this.name+'".';O.default.logAction(O.default.LOG_ERROR,"RealtimeChannel.onMessage()",B),this._startDecodeFailureRecovery(new a.default(B,40018,400));break}for(var z=0;z<_.length;z++){var B=_[z];try{A.default.decode(B,this._decodingContext)}catch(rt){switch(O.default.logAction(O.default.LOG_ERROR,"RealtimeChannel.onMessage()",rt.toString()),rt.code){case 40018:this._startDecodeFailureRecovery(rt);return;case 40019:case 40021:this.notifyState("failed",rt);return}}B.connectionId||(B.connectionId=j),B.timestamp||(B.timestamp=k),B.id||(B.id=I+":"+z)}this._lastPayload.messageId=U.id,this._lastPayload.protocolMessageChannelSerial=r.channelSerial,this.onEvent(_);break}case x.ERROR:{var G=r.error;G&&G.code==80016?this.checkPendingState():this.notifyState("failed",a.default.fromValues(G));break}default:O.default.logAction(O.default.LOG_ERROR,"RealtimeChannel.onMessage()","Fatal protocol error: unrecognised action ("+r.action+")"),this.connectionManager.abort(L.default.unknownChannelErr())}},u.prototype._startDecodeFailureRecovery=function(r){var i=this;this._lastPayload.decodeFailureRecoveryInProgress||(O.default.logAction(O.default.LOG_MAJOR,"RealtimeChannel.onMessage()","Starting decode failure recovery process."),this._lastPayload.decodeFailureRecoveryInProgress=!0,this._attach(!0,r,function(){i._lastPayload.decodeFailureRecoveryInProgress=!1}))},u.prototype.onAttached=function(){O.default.logAction(O.default.LOG_MINOR,"RealtimeChannel.onAttached","activating channel; name = "+this.name)},u.prototype.notifyState=function(r,i,v,s,d){if(O.default.logAction(O.default.LOG_MICRO,"RealtimeChannel.notifyState","name = "+this.name+", current state = "+this.state+", notifying state "+r),this.clearStateTimer(),C.arrIn(["detached","suspended","failed"],r)&&(this.properties.channelSerial=null),r!==this.state){this.presence.actOnChannelState(r,s,i),r==="suspended"&&this.connectionManager.state.sendEvents?this.startRetryTimer():this.cancelRetryTimer(),i&&(this.errorReason=i);var N=new b.default(this.state,r,v,d,i),D=r==="failed"?O.default.LOG_ERROR:O.default.LOG_MAJOR;O.default.logAction(D,'Channel state for channel "'+this.name+'"',r+(i?"; reason: "+i:"")),r!=="attaching"&&r!=="suspended"&&(this.retryCount=0),r==="attached"&&this.onAttached(),r==="attached"?this._attachResume=!0:(r==="detaching"||r==="failed")&&(this._attachResume=!1),this.state=r,this._allChannelChanges.emit(r,N),this.emit(r,N)}},u.prototype.requestState=function(r,i){O.default.logAction(O.default.LOG_MINOR,"RealtimeChannel.requestState","name = "+this.name+", state = "+r),this.notifyState(r,i),this.checkPendingState()},u.prototype.checkPendingState=function(){var r=this.connectionManager.state;if(!(r.sendEvents||r.forceQueueEvents)){O.default.logAction(O.default.LOG_MINOR,"RealtimeChannel.checkPendingState","sendEvents is false; state is "+this.connectionManager.state.state);return}switch(O.default.logAction(O.default.LOG_MINOR,"RealtimeChannel.checkPendingState","name = "+this.name+", state = "+this.state),this.state){case"attaching":this.startStateTimerIfNotRunning(),this.attachImpl();break;case"detaching":this.startStateTimerIfNotRunning(),this.detachImpl();break;case"attached":this.sync();break}},u.prototype.timeoutPendingState=function(){switch(this.state){case"attaching":{var r=new a.default("Channel attach timed out",90007,408);this.notifyState("suspended",r);break}case"detaching":{var r=new a.default("Channel detach timed out",90007,408);this.notifyState("attached",r);break}default:this.checkPendingState();break}},u.prototype.startStateTimerIfNotRunning=function(){var r=this;this.stateTimer||(this.stateTimer=setTimeout(function(){O.default.logAction(O.default.LOG_MINOR,"RealtimeChannel.startStateTimerIfNotRunning","timer expired"),r.stateTimer=null,r.timeoutPendingState()},this.realtime.options.timeouts.realtimeRequestTimeout))},u.prototype.clearStateTimer=function(){var r=this.stateTimer;r&&(clearTimeout(r),this.stateTimer=null)},u.prototype.startRetryTimer=function(){var r=this;if(!this.retryTimer){this.retryCount++;var i=C.getRetryTime(this.realtime.options.timeouts.channelRetryTimeout,this.retryCount);this.retryTimer=setTimeout(function(){r.state==="suspended"&&r.connectionManager.state.sendEvents&&(r.retryTimer=null,O.default.logAction(O.default.LOG_MINOR,"RealtimeChannel retry timer expired","attempting a new attach"),r.requestState("attaching"))},i)}},u.prototype.cancelRetryTimer=function(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)},u.prototype.getReleaseErr=function(){var r=this.state;return r==="initialized"||r==="detached"||r==="failed"?null:new a.default("Can only release a channel in a state where there is no possibility of further updates from the server being received (initialized, detached, or failed); was "+r,90001,400)},u.prototype.setChannelSerial=function(r){O.default.logAction(O.default.LOG_MICRO,"RealtimeChannel.setChannelSerial()","Updating channel serial; serial = "+r+"; previous = "+this.properties.channelSerial),r&&(this.properties.channelSerial=r)},u}(S.default);e.default=R},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function n(m,C,S,O,P){this.previous=m,this.current=C,C==="attached"&&(this.resumed=S,this.hasBacklog=O),P&&(this.reason=P)}return n}();e.default=o},function(l,e,t){(function(o,n){l.exports=n(t(6))})(this,function(o){return function(){var n=o,m=n.lib,C=m.WordArray,S=m.Hasher,O=n.algo,P=[],A=O.SHA1=S.extend({_doReset:function(){this._hash=new C.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(b,a){for(var g=this._hash.words,L=g[0],x=g[1],p=g[2],y=g[3],R=g[4],c=0;c<80;c++){if(c<16)P[c]=b[a+c]|0;else{var u=P[c-3]^P[c-8]^P[c-14]^P[c-16];P[c]=u<<1|u>>>31}var r=(L<<5|L>>>27)+R+P[c];c<20?r+=(x&p|~x&y)+1518500249:c<40?r+=(x^p^y)+1859775393:c<60?r+=(x&p|x&y|p&y)-1894007588:r+=(x^p^y)-899497514,R=y,y=p,p=x<<30|x>>>2,x=L,L=r}g[0]=g[0]+L|0,g[1]=g[1]+x|0,g[2]=g[2]+p|0,g[3]=g[3]+y|0,g[4]=g[4]+R|0},_doFinalize:function(){var b=this._data,a=b.words,g=this._nDataBytes*8,L=b.sigBytes*8;return a[L>>>5]|=128<<24-L%32,a[(L+64>>>9<<4)+14]=Math.floor(g/4294967296),a[(L+64>>>9<<4)+15]=g,b.sigBytes=a.length*4,this._process(),this._hash},clone:function(){var b=S.clone.call(this);return b._hash=this._hash.clone(),b}});n.SHA1=S._createHelper(A),n.HmacSHA1=S._createHmacHelper(A)}(),o.SHA1})},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});function o(c){if(c===void 0)return"undefined";var u,r;if(c instanceof ArrayBuffer?(r="ArrayBuffer",u=new DataView(c)):c instanceof DataView&&(r="DataView",u=c),!u)return JSON.stringify(c);for(var i=[],v=0;v<c.byteLength;v++){if(v>20){i.push("...");break}var s=u.getUint8(v).toString(16);s.length===1&&(s="0"+s),i.push(s)}return"<"+r+" "+i.join(" ")+">"}function n(c,u,r){for(var i=0,v=r.length;i<v;i++){var s=r.charCodeAt(i);if(s<128){c.setUint8(u++,s>>>0&127|0);continue}if(s<2048){c.setUint8(u++,s>>>6&31|192),c.setUint8(u++,s>>>0&63|128);continue}if(s<65536){c.setUint8(u++,s>>>12&15|224),c.setUint8(u++,s>>>6&63|128),c.setUint8(u++,s>>>0&63|128);continue}if(s<1114112){c.setUint8(u++,s>>>18&7|240),c.setUint8(u++,s>>>12&63|128),c.setUint8(u++,s>>>6&63|128),c.setUint8(u++,s>>>0&63|128);continue}throw new Error("bad codepoint "+s)}}function m(c,u,r){for(var i="",v=u,s=u+r;v<s;v++){var d=c.getUint8(v);if(!(d&128)){i+=String.fromCharCode(d);continue}if((d&224)===192){i+=String.fromCharCode((d&15)<<6|c.getUint8(++v)&63);continue}if((d&240)===224){i+=String.fromCharCode((d&15)<<12|(c.getUint8(++v)&63)<<6|(c.getUint8(++v)&63)<<0);continue}if((d&248)===240){i+=String.fromCharCode((d&7)<<18|(c.getUint8(++v)&63)<<12|(c.getUint8(++v)&63)<<6|(c.getUint8(++v)&63)<<0);continue}throw new Error("Invalid byte "+d.toString(16))}return i}function C(c){for(var u=0,r=0,i=c.length;r<i;r++){var v=c.charCodeAt(r);if(v<128){u+=1;continue}if(v<2048){u+=2;continue}if(v<65536){u+=3;continue}if(v<1114112){u+=4;continue}throw new Error("bad codepoint "+v)}return u}function S(c,u){var r=R(c,u);if(r!==0){var i=new ArrayBuffer(r),v=new DataView(i);return y(c,v,0,u),i}}var O=65536*65536,P=1/O;function A(c,u){return u=u||0,c.getInt32(u)*O+c.getUint32(u+4)}function b(c,u){return u=u||0,c.getUint32(u)*O+c.getUint32(u+4)}function a(c,u,r){r<9223372036854776e3?(c.setInt32(u,Math.floor(r*P)),c.setInt32(u+4,r&-1)):(c.setUint32(u,2147483647),c.setUint32(u+4,2147483647))}function g(c,u,r){r<18446744073709552e3?(c.setUint32(u,Math.floor(r*P)),c.setInt32(u+4,r&-1)):(c.setUint32(u,4294967295),c.setUint32(u+4,4294967295))}var L=function(){function c(u,r){var i=this;this.map=function(v){for(var s={},d=0;d<v;d++){var N=i.parse();s[N]=i.parse()}return s},this.bin=function(v){var s=new ArrayBuffer(v);return new Uint8Array(s).set(new Uint8Array(i.view.buffer,i.offset,v),0),i.offset+=v,s},this.buf=this.bin,this.str=function(v){var s=m(i.view,i.offset,v);return i.offset+=v,s},this.array=function(v){for(var s=new Array(v),d=0;d<v;d++)s[d]=i.parse();return s},this.ext=function(v){return i.offset+=v,{type:i.view.getInt8(i.offset),data:i.buf(v)}},this.parse=function(){var v=i.view.getUint8(i.offset),s,d;if(!(v&128))return i.offset++,v;if((v&240)===128)return d=v&15,i.offset++,i.map(d);if((v&240)===144)return d=v&15,i.offset++,i.array(d);if((v&224)===160)return d=v&31,i.offset++,i.str(d);if((v&224)===224)return s=i.view.getInt8(i.offset),i.offset++,s;switch(v){case 192:return i.offset++,null;case 193:i.offset++;return;case 194:return i.offset++,!1;case 195:return i.offset++,!0;case 196:return d=i.view.getUint8(i.offset+1),i.offset+=2,i.bin(d);case 197:return d=i.view.getUint16(i.offset+1),i.offset+=3,i.bin(d);case 198:return d=i.view.getUint32(i.offset+1),i.offset+=5,i.bin(d);case 199:return d=i.view.getUint8(i.offset+1),i.offset+=2,i.ext(d);case 200:return d=i.view.getUint16(i.offset+1),i.offset+=3,i.ext(d);case 201:return d=i.view.getUint32(i.offset+1),i.offset+=5,i.ext(d);case 202:return s=i.view.getFloat32(i.offset+1),i.offset+=5,s;case 203:return s=i.view.getFloat64(i.offset+1),i.offset+=9,s;case 204:return s=i.view.getUint8(i.offset+1),i.offset+=2,s;case 205:return s=i.view.getUint16(i.offset+1),i.offset+=3,s;case 206:return s=i.view.getUint32(i.offset+1),i.offset+=5,s;case 207:return s=b(i.view,i.offset+1),i.offset+=9,s;case 208:return s=i.view.getInt8(i.offset+1),i.offset+=2,s;case 209:return s=i.view.getInt16(i.offset+1),i.offset+=3,s;case 210:return s=i.view.getInt32(i.offset+1),i.offset+=5,s;case 211:return s=A(i.view,i.offset+1),i.offset+=9,s;case 212:return d=1,i.offset++,i.ext(d);case 213:return d=2,i.offset++,i.ext(d);case 214:return d=4,i.offset++,i.ext(d);case 215:return d=8,i.offset++,i.ext(d);case 216:return d=16,i.offset++,i.ext(d);case 217:return d=i.view.getUint8(i.offset+1),i.offset+=2,i.str(d);case 218:return d=i.view.getUint16(i.offset+1),i.offset+=3,i.str(d);case 219:return d=i.view.getUint32(i.offset+1),i.offset+=5,i.str(d);case 220:return d=i.view.getUint16(i.offset+1),i.offset+=3,i.array(d);case 221:return d=i.view.getUint32(i.offset+1),i.offset+=5,i.array(d);case 222:return d=i.view.getUint16(i.offset+1),i.offset+=3,i.map(d);case 223:return d=i.view.getUint32(i.offset+1),i.offset+=5,i.map(d)}throw new Error("Unknown type 0x"+v.toString(16))},this.offset=r||0,this.view=u}return c}();function x(c){var u=new DataView(c),r=new L(u),i=r.parse();if(r.offset!==c.byteLength)throw new Error(c.byteLength-r.offset+" trailing bytes");return i}function p(c,u){return Object.keys(c).filter(function(r){var i=c[r],v=typeof i;return(!u||i!=null)&&(v!=="function"||!!i.toJSON)})}function y(c,u,r,i){var v=typeof c;if(typeof c=="string"){var s=C(c);if(s<32)return u.setUint8(r,s|160),n(u,r+1,c),1+s;if(s<256)return u.setUint8(r,217),u.setUint8(r+1,s),n(u,r+2,c),2+s;if(s<65536)return u.setUint8(r,218),u.setUint16(r+1,s),n(u,r+3,c),3+s;if(s<4294967296)return u.setUint8(r,219),u.setUint32(r+1,s),n(u,r+5,c),5+s}if(ArrayBuffer.isView&&ArrayBuffer.isView(c)&&(c=c.buffer),c instanceof ArrayBuffer){var d=c.byteLength;if(d<256)return u.setUint8(r,196),u.setUint8(r+1,d),new Uint8Array(u.buffer).set(new Uint8Array(c),r+2),2+d;if(d<65536)return u.setUint8(r,197),u.setUint16(r+1,d),new Uint8Array(u.buffer).set(new Uint8Array(c),r+3),3+d;if(d<4294967296)return u.setUint8(r,198),u.setUint32(r+1,d),new Uint8Array(u.buffer).set(new Uint8Array(c),r+5),5+d}if(typeof c=="number"){if(Math.floor(c)!==c)return u.setUint8(r,203),u.setFloat64(r+1,c),9;if(c>=0){if(c<128)return u.setUint8(r,c),1;if(c<256)return u.setUint8(r,204),u.setUint8(r+1,c),2;if(c<65536)return u.setUint8(r,205),u.setUint16(r+1,c),3;if(c<4294967296)return u.setUint8(r,206),u.setUint32(r+1,c),5;if(c<18446744073709552e3)return u.setUint8(r,207),g(u,r+1,c),9;throw new Error("Number too big 0x"+c.toString(16))}if(c>=-32)return u.setInt8(r,c),1;if(c>=-128)return u.setUint8(r,208),u.setInt8(r+1,c),2;if(c>=-32768)return u.setUint8(r,209),u.setInt16(r+1,c),3;if(c>=-2147483648)return u.setUint8(r,210),u.setInt32(r+1,c),5;if(c>=-9223372036854776e3)return u.setUint8(r,211),a(u,r+1,c),9;throw new Error("Number too small -0x"+(-c).toString(16).substr(1))}if(v==="undefined")return i?0:(u.setUint8(r,212),u.setUint8(r+1,0),u.setUint8(r+2,0),3);if(c===null)return i?0:(u.setUint8(r,192),1);if(v==="boolean")return u.setUint8(r,c?195:194),1;if(typeof c.toJSON=="function")return y(c.toJSON(),u,r,i);if(v==="object"){var N,D=0,M=void 0,T=Array.isArray(c);if(T?N=c.length:(M=p(c,i),N=M.length),N<16?(u.setUint8(r,N|(T?144:128)),D=1):N<65536?(u.setUint8(r,T?220:222),u.setUint16(r+1,N),D=3):N<4294967296&&(u.setUint8(r,T?221:223),u.setUint32(r+1,N),D=5),T)for(var E=0;E<N;E++)D+=y(c[E],u,r+D,i);else if(M)for(var E=0;E<N;E++){var I=M[E];D+=y(I,u,r+D),D+=y(c[I],u,r+D,i)}return D}if(v==="function")return 0;throw new Error("Unknown type "+v)}function R(c,u){var r=typeof c;if(r==="string"){var i=C(c);if(i<32)return 1+i;if(i<256)return 2+i;if(i<65536)return 3+i;if(i<4294967296)return 5+i}if(ArrayBuffer.isView&&ArrayBuffer.isView(c)&&(c=c.buffer),c instanceof ArrayBuffer){var v=c.byteLength;if(v<256)return 2+v;if(v<65536)return 3+v;if(v<4294967296)return 5+v}if(typeof c=="number"){if(Math.floor(c)!==c)return 9;if(c>=0){if(c<128)return 1;if(c<256)return 2;if(c<65536)return 3;if(c<4294967296)return 5;if(c<18446744073709552e3)return 9;throw new Error("Number too big 0x"+c.toString(16))}if(c>=-32)return 1;if(c>=-128)return 2;if(c>=-32768)return 3;if(c>=-2147483648)return 5;if(c>=-9223372036854776e3)return 9;throw new Error("Number too small -0x"+c.toString(16).substr(1))}if(r==="boolean")return 1;if(c===null)return u?0:1;if(c===void 0)return u?0:3;if(typeof c.toJSON=="function")return R(c.toJSON(),u);if(r==="object"){var s,d=0;if(Array.isArray(c)){s=c.length;for(var N=0;N<s;N++)d+=R(c[N],u)}else{var D=p(c,u);s=D.length;for(var N=0;N<s;N++){var M=D[N];d+=R(M)+R(c[M],u)}}if(s<16)return 1+d;if(s<65536)return 3+d;if(s<4294967296)return 5+d;throw new Error("Array or object too long 0x"+s.toString(16))}if(r==="function")return 0;throw new Error("Unknown type "+r)}e.default={encode:S,decode:x,inspect:o,utf8Write:n,utf8Read:m,utf8ByteCount:C}},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o=t(0),n=o.__importDefault(t(30)),m=o.__importDefault(t(50)),C=o.__importDefault(t(3)),S=o.__importDefault(t(4)),O=o.__importDefault(t(55)),P=o.__importDefault(t(57)),A=o.__importDefault(t(62)),b=o.__importDefault(t(64)),a=o.__importDefault(t(68)),g=o.__importDefault(t(2)),L=t(8),x=o.__importDefault(t(65)),p=o.__importDefault(t(66)),y=o.__importDefault(t(41)),R=(0,P.default)(b.default,O.default);C.default.Crypto=R,C.default.BufferUtils=O.default,C.default.Http=A.default,C.default.Config=b.default,C.default.Transports=a.default,C.default.WebStorage=x.default,n.default.Crypto=R,m.default.Crypto=R,g.default.initLogHandlers(),C.default.Defaults=(0,L.getDefaults)(p.default),C.default.Config.agent&&(C.default.Defaults.agent+=" "+C.default.Config.agent),C.default.Config.noUpgrade&&(C.default.Defaults.upgradeTransports=[]),e.default={ErrorInfo:S.default,Rest:n.default,Realtime:m.default,msgpack:y.default}},function(l){l.exports=JSON.parse('{"name":"ably","description":"Realtime client library for Ably, the realtime messaging service","version":"1.2.48","license":"Apache-2.0","bugs":{"url":"https://github.com/ably/ably-js/issues","email":"support@ably.com"},"main":"./build/ably-node.js","typings":"./ably.d.ts","react-native":{"./build/ably-node.js":"./build/ably-reactnative.js"},"browser":{"./build/ably-node.js":"./build/ably-commonjs.js"},"files":["build/**","ably.d.ts","callbacks.d.ts","callbacks.js","promises.d.ts","promises.js","resources/**","src/**","react/**"],"dependencies":{"@ably/msgpack-js":"^0.4.0","got":"^11.8.5","ws":"^8.14.2"},"peerDependencies":{"react":">=16.8.0","react-dom":">=16.8.0"},"peerDependenciesMeta":{"react":{"optional":true},"react-dom":{"optional":true}},"devDependencies":{"@ably/vcdiff-decoder":"1.0.4","@testing-library/react":"^13.3.0","@types/crypto-js":"^4.0.1","@types/jmespath":"^0.15.2","@types/node":"^15.0.0","@types/request":"^2.48.7","@types/ws":"^8.2.0","@typescript-eslint/eslint-plugin":"^5.14.0","@typescript-eslint/parser":"^5.14.0","@vitejs/plugin-react":"^1.3.2","async":"ably-forks/async#requirejs","aws-sdk":"^2.1413.0","chai":"^4.2.0","copy-webpack-plugin":"^6.4.1","cors":"^2.8.5","crypto-js":"ably-forks/crypto-js#crypto-lite","eslint":"^7.13.0","eslint-plugin-import":"^2.28.0","eslint-plugin-jsdoc":"^40.0.0","eslint-plugin-react":"^7.32.2","eslint-plugin-react-hooks":"^4.6.0","eslint-plugin-security":"^1.4.0","express":"^4.17.1","glob":"~4.4","google-closure-compiler":"^20180610.0.1","grunt":"^1.6.1","grunt-bump":"^0.3.1","grunt-cli":"~1.2.0","grunt-closure-tools":"^1.0.0","grunt-contrib-concat":"~0.5","grunt-shell":"~1.1","grunt-webpack":"^4.0.2","hexy":"~0.2","jmespath":"^0.16.0","jsdom":"^20.0.0","kexec":"ably-forks/node-kexec#update-for-node-12","minimist":"^1.2.5","mocha":"^8.1.3","null-loader":"^4.0.1","playwright":"^1.39.0","prettier":"^2.5.1","react":">=18.1.0","react-dom":">=18.1.0","requirejs":"~2.1","shelljs":"~0.8","source-map-explorer":"^2.5.2","ts-loader":"^8.2.0","tsconfig-paths-webpack-plugin":"^4.0.1","tslib":"^2.3.1","typedoc":"^0.23.8","typescript":"^4.6.4","vite":"^4.4.9","vitest":"^0.18.0","webpack":"^4.44.2","webpack-cli":"^4.2.0"},"engines":{"node":">=5.10.x"},"repository":"ably/ably-js","jspm":{"registry":"npm","directories":{"lib":"build"},"main":"ably"},"scripts":{"start:react":"npx vite serve","grunt":"grunt","test":"grunt test","test:node":"grunt test:node","test:node:skip-build":"grunt mocha","test:webserver":"grunt test:webserver","test:playwright":"node test/support/runPlaywrightTests.js","test:react":"vitest run","concat":"grunt concat","build":"grunt build:all && npm run build:react","build:node":"grunt build:node","build:browser":"grunt build:browser","build:react":"npm run build:react:mjs && npm run build:react:cjs && cp src/platform/react-hooks/res/package.react.json react/package.json","build:react:mjs":"tsc --project src/platform/react-hooks/tsconfig.mjs.json && cp src/platform/react-hooks/res/package.mjs.json react/mjs/package.json","build:react:cjs":"tsc --project src/platform/react-hooks/tsconfig.cjs.json && cp src/platform/react-hooks/res/package.cjs.json react/cjs/package.json","requirejs":"grunt requirejs","lint":"eslint .","lint:fix":"eslint --fix .","check-closure-compiler":"grunt check-closure-compiler","prepare":"npm run build","format":"prettier --write --ignore-path .gitignore --ignore-path .prettierignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js docs/chrome-mv3.md","format:check":"prettier --check --ignore-path .gitignore --ignore-path .prettierignore src test ably.d.ts webpack.config.js Gruntfile.js scripts/cdn_deploy.js","sourcemap":"source-map-explorer build/ably.min.js","sourcemap:noencryption":"source-map-explorer build/ably.noencryption.min.js","docs":"typedoc --entryPoints ably.d.ts --out docs/generated/default --readme docs/landing-pages/default.md && typedoc --entryPoints promises.d.ts --out docs/generated/promises --name \\"ably (Promise-based)\\" --readme docs/landing-pages/promises.md && cp docs/landing-pages/choose-library.html docs/generated/index.html"}}')},function(l,e){},function(l,e,t){(function(o,n){l.exports=n(t(6),t(32),t(24))})(this,function(o){return o.HmacSHA256})},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o=t(0),n=o.__importStar(t(1)),m=o.__importDefault(t(47)),C=o.__importDefault(t(14)),S=o.__importDefault(t(19)),O=o.__importDefault(t(4)),P=o.__importDefault(t(48)),A=function(){},b=function(){function x(p){this.rest=p,this.admin=new a(p)}return x}(),a=function(){function x(p){this.rest=p,this.deviceRegistrations=new g(p),this.channelSubscriptions=new L(p)}return x.prototype.publish=function(p,y,R){var c=this.rest,u=c.options.useBinaryProtocol?n.Format.msgpack:n.Format.json,r=n.defaultPostHeaders(c.options,u),i={},v=n.mixin({recipient:p},y);if(typeof R!="function"){if(this.rest.options.promises)return n.promisify(this,"publish",arguments);R=A}c.options.headers&&n.mixin(r,c.options.headers),c.options.pushFullWait&&n.mixin(i,{fullWait:"true"});var s=n.encodeBody(v,u);C.default.post(c,"/push/publish",s,r,i,null,function(d){return R(d)})},x}(),g=function(){function x(p){this.rest=p}return x.prototype.save=function(p,y){var R=this.rest,c=m.default.fromValues(p),u=R.options.useBinaryProtocol?n.Format.msgpack:n.Format.json,r=n.defaultPostHeaders(R.options,u),i={};if(typeof y!="function"){if(this.rest.options.promises)return n.promisify(this,"save",arguments);y=A}R.options.headers&&n.mixin(r,R.options.headers),R.options.pushFullWait&&n.mixin(i,{fullWait:"true"});var v=n.encodeBody(c,u);C.default.put(R,"/push/deviceRegistrations/"+encodeURIComponent(p.id),v,r,i,null,function(s,d,N,D){y(s,s?void 0:m.default.fromResponseBody(d,D?void 0:u))})},x.prototype.get=function(p,y){var R=this.rest,c=R.options.useBinaryProtocol?n.Format.msgpack:n.Format.json,u=n.defaultGetHeaders(R.options,c),r=p.id||p;if(typeof y!="function"){if(this.rest.options.promises)return n.promisify(this,"get",arguments);y=A}if(typeof r!="string"||!r.length){y(new O.default("First argument to DeviceRegistrations#get must be a deviceId string or DeviceDetails",4e4,400));return}R.options.headers&&n.mixin(u,R.options.headers),C.default.get(R,"/push/deviceRegistrations/"+encodeURIComponent(r),u,{},null,function(i,v,s,d){y(i,i?void 0:m.default.fromResponseBody(v,d?void 0:c))})},x.prototype.list=function(p,y){var R=this.rest,c=R.options.useBinaryProtocol?n.Format.msgpack:n.Format.json,u=this.rest.http.supportsLinkHeaders?void 0:c,r=n.defaultGetHeaders(R.options,c);if(typeof y!="function"){if(this.rest.options.promises)return n.promisify(this,"list",arguments);y=A}R.options.headers&&n.mixin(r,R.options.headers),new S.default(R,"/push/deviceRegistrations",r,u,function(i,v,s){return m.default.fromResponseBody(i,s?void 0:c)}).get(p,y)},x.prototype.remove=function(p,y){var R=this.rest,c=R.options.useBinaryProtocol?n.Format.msgpack:n.Format.json,u=n.defaultGetHeaders(R.options,c),r={},i=p.id||p;if(typeof y!="function"){if(this.rest.options.promises)return n.promisify(this,"remove",arguments);y=A}if(typeof i!="string"||!i.length){y(new O.default("First argument to DeviceRegistrations#remove must be a deviceId string or DeviceDetails",4e4,400));return}R.options.headers&&n.mixin(u,R.options.headers),R.options.pushFullWait&&n.mixin(r,{fullWait:"true"}),C.default.delete(R,"/push/deviceRegistrations/"+encodeURIComponent(i),u,r,null,function(v){return y(v)})},x.prototype.removeWhere=function(p,y){var R=this.rest,c=R.options.useBinaryProtocol?n.Format.msgpack:n.Format.json,u=n.defaultGetHeaders(R.options,c);if(typeof y!="function"){if(this.rest.options.promises)return n.promisify(this,"removeWhere",arguments);y=A}R.options.headers&&n.mixin(u,R.options.headers),R.options.pushFullWait&&n.mixin(p,{fullWait:"true"}),C.default.delete(R,"/push/deviceRegistrations",u,p,null,function(r){return y(r)})},x}(),L=function(){function x(p){this.remove=x.prototype.removeWhere,this.rest=p}return x.prototype.save=function(p,y){var R=this.rest,c=P.default.fromValues(p),u=R.options.useBinaryProtocol?n.Format.msgpack:n.Format.json,r=n.defaultPostHeaders(R.options,u),i={};if(typeof y!="function"){if(this.rest.options.promises)return n.promisify(this,"save",arguments);y=A}R.options.headers&&n.mixin(r,R.options.headers),R.options.pushFullWait&&n.mixin(i,{fullWait:"true"});var v=n.encodeBody(c,u);C.default.post(R,"/push/channelSubscriptions",v,r,i,null,function(s,d,N,D){y(s,!s&&P.default.fromResponseBody(d,D?void 0:u))})},x.prototype.list=function(p,y){var R=this.rest,c=R.options.useBinaryProtocol?n.Format.msgpack:n.Format.json,u=this.rest.http.supportsLinkHeaders?void 0:c,r=n.defaultGetHeaders(R.options,c);if(typeof y!="function"){if(this.rest.options.promises)return n.promisify(this,"list",arguments);y=A}R.options.headers&&n.mixin(r,R.options.headers),new S.default(R,"/push/channelSubscriptions",r,u,function(i,v,s){return P.default.fromResponseBody(i,s?void 0:c)}).get(p,y)},x.prototype.removeWhere=function(p,y){var R=this.rest,c=R.options.useBinaryProtocol?n.Format.msgpack:n.Format.json,u=n.defaultGetHeaders(R.options,c);if(typeof y!="function"){if(this.rest.options.promises)return n.promisify(this,"removeWhere",arguments);y=A}R.options.headers&&n.mixin(u,R.options.headers),R.options.pushFullWait&&n.mixin(p,{fullWait:"true"}),C.default.delete(R,"/push/channelSubscriptions",u,p,null,function(r){return y(r)})},x.prototype.listChannels=function(p,y){var R=this.rest,c=R.options.useBinaryProtocol?n.Format.msgpack:n.Format.json,u=this.rest.http.supportsLinkHeaders?void 0:c,r=n.defaultGetHeaders(R.options,c);if(typeof y!="function"){if(this.rest.options.promises)return n.promisify(this,"listChannels",arguments);y=A}R.options.headers&&n.mixin(r,R.options.headers),R.options.pushFullWait&&n.mixin(p,{fullWait:"true"}),new S.default(R,"/push/channels",r,u,function(i,v,s){for(var d=!s&&c?n.decodeBody(i,c):i,N=0;N<d.length;N++)d[N]=String(d[N]);return d}).get(p,y)},x}();e.default=b},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o=t(0),n=o.__importStar(t(1)),m=o.__importDefault(t(4)),C;(function(P){P.Phone="phone",P.Tablet="tablet",P.Desktop="desktop",P.TV="tv",P.Watch="watch",P.Car="car",P.Embedded="embedded",P.Other="other"})(C||(C={}));var S;(function(P){P.Android="android",P.IOS="ios",P.Browser="browser"})(S||(S={}));var O=function(){function P(){}return P.prototype.toJSON=function(){var A,b,a;return{id:this.id,deviceSecret:this.deviceSecret,platform:this.platform,formFactor:this.formFactor,clientId:this.clientId,metadata:this.metadata,deviceIdentityToken:this.deviceIdentityToken,push:{recipient:(A=this.push)===null||A===void 0?void 0:A.recipient,state:(b=this.push)===null||b===void 0?void 0:b.state,error:(a=this.push)===null||a===void 0?void 0:a.error}}},P.prototype.toString=function(){var A,b,a,g,L="[DeviceDetails";return this.id&&(L+="; id="+this.id),this.platform&&(L+="; platform="+this.platform),this.formFactor&&(L+="; formFactor="+this.formFactor),this.clientId&&(L+="; clientId="+this.clientId),this.metadata&&(L+="; metadata="+this.metadata),this.deviceIdentityToken&&(L+="; deviceIdentityToken="+JSON.stringify(this.deviceIdentityToken)),!((A=this.push)===null||A===void 0)&&A.recipient&&(L+="; push.recipient="+JSON.stringify(this.push.recipient)),!((b=this.push)===null||b===void 0)&&b.state&&(L+="; push.state="+this.push.state),!((a=this.push)===null||a===void 0)&&a.error&&(L+="; push.error="+JSON.stringify(this.push.error)),!((g=this.push)===null||g===void 0)&&g.metadata&&(L+="; push.metadata="+this.push.metadata),L+="]",L},P.fromResponseBody=function(A,b){return b&&(A=n.decodeBody(A,b)),n.isArray(A)?P.fromValuesArray(A):P.fromValues(A)},P.fromValues=function(A){return A.error=A.error&&m.default.fromValues(A.error),Object.assign(new P,A)},P.fromValuesArray=function(A){for(var b=A.length,a=new Array(b),g=0;g<b;g++)a[g]=P.fromValues(A[g]);return a},P.toRequestBody=n.encodeBody,P}();e.default=O},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o=t(0),n=o.__importStar(t(1)),m=function(){function C(){}return C.prototype.toJSON=function(){return{channel:this.channel,deviceId:this.deviceId,clientId:this.clientId}},C.prototype.toString=function(){var S="[PushChannelSubscription";return this.channel&&(S+="; channel="+this.channel),this.deviceId&&(S+="; deviceId="+this.deviceId),this.clientId&&(S+="; clientId="+this.clientId),S+="]",S},C.fromResponseBody=function(S,O){return O&&(S=n.decodeBody(S,O)),n.isArray(S)?C.fromValuesArray(S):C.fromValues(S)},C.fromValues=function(S){return Object.assign(new C,S)},C.fromValuesArray=function(S){for(var O=S.length,P=new Array(O),A=0;A<O;A++)P[A]=C.fromValues(S[A]);return P},C.toRequestBody=n.encodeBody,C}();e.default=m},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o=t(0),n=o.__importStar(t(1)),m=function(){function R(c){this.count=c&&c.count||0,this.data=c&&c.data||0,this.uncompressedData=c&&c.uncompressedData||0,this.failed=c&&c.failed||0,this.refused=c&&c.refused||0}return R}(),C=function(R){o.__extends(c,R);function c(u){var r=R.call(this,u)||this;return u&&u.category&&(r.category={},n.forInOwnNonNullProperties(u.category,function(i){r.category[i]=new m(u.category[i])})),r}return c}(m),S=function(){function R(c){this.peak=c&&c.peak||0,this.min=c&&c.min||0,this.mean=c&&c.mean||0,this.opened=c&&c.opened||0,this.refused=c&&c.refused||0}return R}(),O=function(){function R(c){this.succeeded=c&&c.succeeded||0,this.failed=c&&c.failed||0,this.refused=c&&c.refused||0}return R}(),P=function(){function R(c){this.plain=new S(c&&c.plain),this.tls=new S(c&&c.tls),this.all=new S(c&&c.all)}return R}(),A=function(){function R(c){this.messages=new C(c&&c.messages),this.presence=new C(c&&c.presence),this.all=new C(c&&c.all)}return R}(),b=function(){function R(c){this.realtime=new A(c&&c.realtime),this.rest=new A(c&&c.rest),this.webhook=new A(c&&c.webhook),this.sharedQueue=new A(c&&c.sharedQueue),this.externalQueue=new A(c&&c.externalQueue),this.httpEvent=new A(c&&c.httpEvent),this.push=new A(c&&c.push),this.all=new A(c&&c.all)}return R}(),a=function(){function R(c){this.all=new A(c&&c.all),this.inbound=new b(c&&c.inbound),this.outbound=new b(c&&c.outbound)}return R}(),g=function(){function R(c){this.all=new A(c&&c.all),this.producerPaid=new a(c&&c.producerPaid),this.consumerPaid=new a(c&&c.consumerPaid)}return R}(),L=function(){function R(c){this.messages=c&&c.messages||0;var u=c&&c.notifications;this.notifications={invalid:u&&u.invalid||0,attempted:u&&u.attempted||0,successful:u&&u.successful||0,failed:u&&u.failed||0},this.directPublishes=c&&c.directPublishes||0}return R}(),x=function(){function R(c){this.succeeded=c&&c.succeeded||0,this.skipped=c&&c.skipped||0,this.failed=c&&c.failed||0}return R}(),p=function(){function R(c){var u=this;this.delta=void 0,c&&c.delta&&(this.delta={},n.forInOwnNonNullProperties(c.delta,function(r){u.delta[r]=new x(c.delta[r])}))}return R}(),y=function(R){o.__extends(c,R);function c(u){var r=R.call(this,u)||this;return r.persisted=new A(u&&u.persisted),r.connections=new P(u&&u.connections),r.channels=new S(u&&u.channels),r.apiRequests=new O(u&&u.apiRequests),r.tokenRequests=new O(u&&u.tokenRequests),r.xchgProducer=new g(u&&u.xchgProducer),r.xchgConsumer=new g(u&&u.xchgConsumer),r.push=new L(u&&u.pushStats),r.processed=new p(u&&u.processed),r.inProgress=u&&u.inProgress||void 0,r.unit=u&&u.unit||void 0,r.intervalId=u&&u.intervalId||void 0,r}return c.fromValues=function(u){return new c(u)},c}(a);e.default=y},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o=t(0),n=o.__importStar(t(1)),m=o.__importDefault(t(30)),C=o.__importDefault(t(7)),S=o.__importDefault(t(2)),O=o.__importDefault(t(51)),P=o.__importDefault(t(38)),A=o.__importDefault(t(8)),b=o.__importDefault(t(4)),a=o.__importDefault(t(10)),g=o.__importDefault(t(35)),L=o.__importDefault(t(3)),x=o.__importDefault(t(9)),p=function(R){o.__extends(c,R);function c(u){var r=R.call(this,u)||this;return S.default.logAction(S.default.LOG_MINOR,"Realtime()",""),r.connection=new O.default(r,r.options),r.channels=new y(r),u.autoConnect!==!1&&r.connect(),r}return c.prototype.connect=function(){S.default.logAction(S.default.LOG_MINOR,"Realtime.connect()",""),this.connection.connect()},c.prototype.close=function(){S.default.logAction(S.default.LOG_MINOR,"Realtime.close()",""),this.connection.close()},c.Promise=function(u){return u=A.default.objectifyOptions(u),u.promises=!0,new c(u)},c.Callbacks=c,c.Utils=n,c.ConnectionManager=g.default,c.Platform=L.default,c.ProtocolMessage=a.default,c.Message=x.default,c}(m.default),y=function(R){o.__extends(c,R);function c(u){var r=R.call(this)||this;return r.realtime=u,r.all=Object.create(null),u.connection.connectionManager.on("transport.active",function(){r.onTransportActive()}),r}return c.prototype.channelSerials=function(){for(var u={},r=0,i=n.keysArray(this.all,!0);r<i.length;r++){var v=i[r],s=this.all[v];s.properties.channelSerial&&(u[v]=s.properties.channelSerial)}return u},c.prototype.recoverChannels=function(u){for(var r=0,i=n.keysArray(u,!0);r<i.length;r++){var v=i[r],s=this.get(v);s.properties.channelSerial=u[v]}},c.prototype.onChannelMessage=function(u){var r=u.channel;if(r===void 0){S.default.logAction(S.default.LOG_ERROR,"Channels.onChannelMessage()","received event unspecified channel, action = "+u.action);return}var i=this.all[r];if(!i){S.default.logAction(S.default.LOG_ERROR,"Channels.onChannelMessage()","received event for non-existent channel: "+r);return}i.onMessage(u)},c.prototype.onTransportActive=function(){for(var u in this.all){var r=this.all[u];r.state==="attaching"||r.state==="detaching"?r.checkPendingState():r.state==="suspended"?r._attach(!1,null):r.state==="attached"&&r.requestState("attaching")}},c.prototype.propogateConnectionInterruption=function(u,r){var i={closing:"detached",closed:"detached",failed:"failed",suspended:"suspended"},v=["attaching","attached","detaching","suspended"],s=i[u];for(var d in this.all){var N=this.all[d];n.arrIn(v,N.state)&&N.notifyState(s,r)}},c.prototype.get=function(u,r){u=String(u);var i=this.all[u];if(!i)i=this.all[u]=new P.default(this.realtime,u,r);else if(r){if(i._shouldReattachToSetOptions(r))throw new b.default("Channels.get() cannot be used to set channel options that would cause the channel to reattach. Please, use RealtimeChannel.setOptions() instead.",4e4,400);i.setOptions(r)}return i},c.prototype.getDerived=function(u,r,i){if(r.filter){var v=n.toBase64(r.filter),s=n.matchDerivedChannel(u);u="[filter=".concat(v).concat(s.qualifierParam,"]").concat(s.channelName)}return this.get(u,i)},c.prototype.release=function(u){u=String(u);var r=this.all[u];if(r){var i=r.getReleaseErr();if(i)throw i;delete this.all[u]}},c}(C.default);e.default=p},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o=t(0),n=o.__importStar(t(1)),m=o.__importDefault(t(7)),C=o.__importDefault(t(35)),S=o.__importDefault(t(2)),O=o.__importDefault(t(37)),P=o.__importDefault(t(3));function A(){}var b=function(a){o.__extends(g,a);function g(L,x){var p=a.call(this)||this;return p.whenState=function(y,R){return m.default.prototype.whenState.call(p,y,p.state,R,new O.default(void 0,y))},p.ably=L,p.connectionManager=new C.default(L,x),p.state=p.connectionManager.state.state,p.key=void 0,p.id=void 0,p.errorReason=null,p.connectionManager.on("connectionstate",function(y){var R=p.state=y.current;P.default.Config.nextTick(function(){p.emit(R,y)})}),p.connectionManager.on("update",function(y){P.default.Config.nextTick(function(){p.emit("update",y)})}),p}return g.prototype.connect=function(){S.default.logAction(S.default.LOG_MINOR,"Connection.connect()",""),this.connectionManager.requestState({state:"connecting"})},g.prototype.ping=function(L){if(S.default.logAction(S.default.LOG_MINOR,"Connection.ping()",""),!L){if(this.ably.options.promises)return n.promisify(this,"ping",arguments);L=A}this.connectionManager.ping(null,L)},g.prototype.close=function(){S.default.logAction(S.default.LOG_MINOR,"Connection.close()","connectionKey = "+this.key),this.connectionManager.requestState({state:"closing"})},Object.defineProperty(g.prototype,"recoveryKey",{get:function(){return this.createRecoveryKey()},enumerable:!1,configurable:!0}),g.prototype.createRecoveryKey=function(){return this.connectionManager.createRecoveryKey()},g}(m.default);e.default=b},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0}),e.PendingMessage=void 0;var o=t(0),n=o.__importDefault(t(10)),m=o.__importStar(t(1)),C=o.__importDefault(t(7)),S=o.__importDefault(t(2)),O=o.__importDefault(t(36)),P=o.__importDefault(t(4)),A=n.default.Action,b=function(){function g(L,x){this.message=L,this.callback=x,this.merged=!1;var p=L.action;this.sendAttempted=!1,this.ackRequired=p==A.MESSAGE||p==A.PRESENCE}return g}();e.PendingMessage=b;var a=function(g){o.__extends(L,g);function L(x){var p=g.call(this)||this;return p.transport=x,p.messageQueue=new O.default,x.on("ack",function(y,R){p.onAck(y,R)}),x.on("nack",function(y,R,c){p.onNack(y,R,c)}),p}return L.prototype.onAck=function(x,p){S.default.logAction(S.default.LOG_MICRO,"Protocol.onAck()","serial = "+x+"; count = "+p),this.messageQueue.completeMessages(x,p)},L.prototype.onNack=function(x,p,y){S.default.logAction(S.default.LOG_ERROR,"Protocol.onNack()","serial = "+x+"; count = "+p+"; err = "+m.inspectError(y)),y||(y=new P.default("Unable to send message; channel not responding",50001,500)),this.messageQueue.completeMessages(x,p,y)},L.prototype.onceIdle=function(x){var p=this.messageQueue;if(p.count()===0){x();return}p.once("idle",x)},L.prototype.send=function(x){x.ackRequired&&this.messageQueue.push(x),S.default.shouldLog(S.default.LOG_MICRO)&&S.default.logAction(S.default.LOG_MICRO,"Protocol.send()","sending msg; "+n.default.stringify(x.message)),x.sendAttempted=!0,this.transport.send(x.message)},L.prototype.getTransport=function(){return this.transport},L.prototype.getPendingMessages=function(){return this.messageQueue.copyAll()},L.prototype.clearPendingMessages=function(){return this.messageQueue.clear()},L.prototype.finish=function(){var x=this.transport;this.onceIdle(function(){x.disconnect()})},L}(C.default);e.default=a},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o=t(0),n=o.__importDefault(t(3)),m=o.__importStar(t(1)),C=o.__importDefault(t(26)),S=o.__importDefault(t(8)),O=o.__importDefault(t(2)),P=o.__importDefault(t(10)),A=o.__importDefault(t(4)),b="web_socket";function a(x){return!!x.on}var g=function(x){o.__extends(p,x);function p(y,R,c){var u=x.call(this,y,R,c)||this;return u.shortName=b,c.heartbeats=n.default.Config.useProtocolHeartbeats,u.wsHost=S.default.getHost(c.options,c.host,!0),u}return p.isAvailable=function(){return!!n.default.Config.WebSocket},p.prototype.createWebSocket=function(y,R){return this.uri=y+m.toQueryString(R),new n.default.Config.WebSocket(this.uri)},p.prototype.toString=function(){return"WebSocketTransport; uri="+this.uri},p.prototype.connect=function(){O.default.logAction(O.default.LOG_MINOR,"WebSocketTransport.connect()","starting"),C.default.prototype.connect.call(this);var y=this,R=this.params,c=R.options,u=c.tls?"wss://":"ws://",r=u+this.wsHost+":"+S.default.getPort(c)+"/";O.default.logAction(O.default.LOG_MINOR,"WebSocketTransport.connect()","uri: "+r),this.auth.getAuthParams(function(i,v){if(!y.isDisposed){var s="";for(var d in v)s+=" "+d+": "+v[d]+";";if(O.default.logAction(O.default.LOG_MINOR,"WebSocketTransport.connect()","authParams:"+s+" err: "+i),i){y.disconnect(i);return}var N=R.getConnectParams(v);try{var D=y.wsConnection=y.createWebSocket(r,N);D.binaryType=n.default.Config.binaryType,D.onopen=function(){y.onWsOpen()},D.onclose=function(M){y.onWsClose(M)},D.onmessage=function(M){y.onWsData(M.data)},D.onerror=function(M){y.onWsError(M)},a(D)&&D.on("ping",function(){y.onActivity()})}catch(M){O.default.logAction(O.default.LOG_ERROR,"WebSocketTransport.connect()","Unexpected exception creating websocket: err = "+(M.stack||M.message)),y.disconnect(M)}}})},p.prototype.send=function(y){var R=this.wsConnection;if(!R){O.default.logAction(O.default.LOG_ERROR,"WebSocketTransport.send()","No socket connection");return}try{R.send(P.default.serialize(y,this.params.format))}catch(u){var c="Exception from ws connection when trying to send: "+m.inspectError(u);O.default.logAction(O.default.LOG_ERROR,"WebSocketTransport.send()",c),this.finish("disconnected",new A.default(c,5e4,500))}},p.prototype.onWsData=function(y){O.default.logAction(O.default.LOG_MICRO,"WebSocketTransport.onWsData()","data received; length = "+y.length+"; type = "+typeof y);try{this.onProtocolMessage(P.default.deserialize(y,this.format))}catch(R){O.default.logAction(O.default.LOG_ERROR,"WebSocketTransport.onWsData()","Unexpected exception handing channel message: "+R.stack)}},p.prototype.onWsOpen=function(){O.default.logAction(O.default.LOG_MINOR,"WebSocketTransport.onWsOpen()","opened WebSocket"),this.emit("preconnect")},p.prototype.onWsClose=function(y){var R,c;if(typeof y=="object"?(c=y.code,R=y.wasClean||c===1e3):(c=y,R=c==1e3),delete this.wsConnection,R){O.default.logAction(O.default.LOG_MINOR,"WebSocketTransport.onWsClose()","Cleanly closed WebSocket");var u=new A.default("Websocket closed",80003,400);this.finish("disconnected",u)}else{var r="Unclean disconnection of WebSocket ; code = "+c,u=new A.default(r,80003,400);O.default.logAction(O.default.LOG_MINOR,"WebSocketTransport.onWsClose()",r),this.finish("disconnected",u)}this.emit("disposed")},p.prototype.onWsError=function(y){var R=this;O.default.logAction(O.default.LOG_MINOR,"WebSocketTransport.onError()","Error from WebSocket: "+y.message),n.default.Config.nextTick(function(){R.disconnect(Error(y.message))})},p.prototype.dispose=function(){O.default.logAction(O.default.LOG_MINOR,"WebSocketTransport.dispose()",""),this.isDisposed=!0;var y=this.wsConnection;y&&(y.onmessage=function(){},delete this.wsConnection,n.default.Config.nextTick(function(){if(O.default.logAction(O.default.LOG_MICRO,"WebSocketTransport.dispose()","closing websocket"),!y)throw new Error("WebSocketTransport.dispose(): wsConnection is not defined");y.close()}))},p}(C.default);function L(x){return g.isAvailable()&&(x.supportedTransports[b]=g),g}e.default=L},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o=t(0),n=o.__importStar(t(1)),m=o.__importDefault(t(34)),C=o.__importDefault(t(7)),S=o.__importDefault(t(2)),O=o.__importDefault(t(15)),P=o.__importStar(t(4)),A=o.__importDefault(t(38)),b=o.__importDefault(t(23)),a=o.__importDefault(t(39)),g=function(){};function L(u){return u.channel.realtime.auth.clientId}function x(u){var r=u.channel.realtime,i=r.auth.clientId;return(!i||i==="*")&&r.connection.state==="connected"}function p(u,r,i){switch(u.state){case"attached":case"suspended":i();break;case"initialized":case"detached":case"detaching":case"attaching":u.attach(function(v){v?r(v):i()});break;default:r(P.default.fromValues(u.invalidStateError()))}}function y(u,r){if(u.isSynthesized()||r.isSynthesized())return u.timestamp>=r.timestamp;var i=u.parseId(),v=r.parseId();return i.msgSerial===v.msgSerial?i.index>v.index:i.msgSerial>v.msgSerial}var R=function(u){o.__extends(r,u);function r(i){var v=u.call(this,i)||this;return v.channel=i,v.syncComplete=!1,v.members=new c(v,function(s){return s.clientId+":"+s.connectionId}),v._myMembers=new c(v,function(s){return s.clientId}),v.subscriptions=new C.default,v.pendingPresence=[],v}return r.prototype.enter=function(i,v){if(x(this))throw new P.default("clientId must be specified to enter a presence channel",40012,400);return this._enterOrUpdateClient(void 0,void 0,i,"enter",v)},r.prototype.update=function(i,v){if(x(this))throw new P.default("clientId must be specified to update presence data",40012,400);return this._enterOrUpdateClient(void 0,void 0,i,"update",v)},r.prototype.enterClient=function(i,v,s){return this._enterOrUpdateClient(void 0,i,v,"enter",s)},r.prototype.updateClient=function(i,v,s){return this._enterOrUpdateClient(void 0,i,v,"update",s)},r.prototype._enterOrUpdateClient=function(i,v,s,d,N){var D=this;if(!N)if(typeof s=="function")N=s,s=null;else{if(this.channel.realtime.options.promises)return n.promisify(this,"_enterOrUpdateClient",[i,v,s,d]);N=g}var M=this.channel;if(!M.connectionManager.activeState()){N(M.connectionManager.getError());return}S.default.logAction(S.default.LOG_MICRO,"RealtimePresence."+d+"Client()","channel = "+M.name+", id = "+i+", client = "+(v||"(implicit) "+L(this)));var T=O.default.fromData(s);T.action=d,i&&(T.id=i),v&&(T.clientId=v),O.default.encode(T,M.channelOptions,function(E){if(E){N(E);return}switch(M.state){case"attached":M.sendPresence(T,N);break;case"initialized":case"detached":M.attach();case"attaching":D.pendingPresence.push({presence:T,callback:N});break;default:E=new P.PartialErrorInfo("Unable to "+d+" presence channel while in "+M.state+" state",90001),E.code=90001,N(E)}})},r.prototype.leave=function(i,v){if(x(this))throw new P.default("clientId must have been specified to enter or leave a presence channel",40012,400);return this.leaveClient(void 0,i,v)},r.prototype.leaveClient=function(i,v,s){if(!s)if(typeof v=="function")s=v,v=null;else{if(this.channel.realtime.options.promises)return n.promisify(this,"leaveClient",[i,v]);s=g}var d=this.channel;if(!d.connectionManager.activeState()){s==null||s(d.connectionManager.getError());return}S.default.logAction(S.default.LOG_MICRO,"RealtimePresence.leaveClient()","leaving; channel = "+this.channel.name+", client = "+i);var N=O.default.fromData(v);switch(N.action="leave",i&&(N.clientId=i),d.state){case"attached":d.sendPresence(N,s);break;case"attaching":this.pendingPresence.push({presence:N,callback:s});break;case"initialized":case"failed":{var D=new P.PartialErrorInfo("Unable to leave presence channel (incompatible state)",90001);s==null||s(D);break}default:s==null||s(d.invalidStateError())}},r.prototype.get=function(i,v){var s=this,d=Array.prototype.slice.call(arguments);d.length==1&&typeof d[0]=="function"&&d.unshift(null),i=d[0],v=d[1];var N=!i||("waitForSync"in i?i.waitForSync:!0);if(!v){if(this.channel.realtime.options.promises)return n.promisify(this,"get",d);v=g}function D(M){v(null,i?M.list(i):M.values())}if(this.channel.state==="suspended"){N?v(P.default.fromValues({statusCode:400,code:91005,message:"Presence state is out of sync due to channel being in the SUSPENDED state"})):D(this.members);return}p(this.channel,v,function(){var M=s.members;N?M.waitSync(function(){D(M)}):D(M)})},r.prototype.history=function(i,v){if(S.default.logAction(S.default.LOG_MICRO,"RealtimePresence.history()","channel = "+this.name),v===void 0)if(typeof i=="function")v=i,i=null;else{if(this.channel.realtime.options.promises)return n.promisify(this,"history",arguments);v=g}i&&i.untilAttach&&(this.channel.state==="attached"?(delete i.untilAttach,i.from_serial=this.channel.properties.attachSerial):v(new P.default("option untilAttach requires the channel to be attached, was: "+this.channel.state,4e4,400))),m.default.prototype._history.call(this,i,v)},r.prototype.setPresence=function(i,v,s){S.default.logAction(S.default.LOG_MICRO,"RealtimePresence.setPresence()","received presence for "+i.length+" participants; syncChannelSerial = "+s);var d,N,D=this.members,M=this._myMembers,T=[],E=this.channel.connectionManager.connectionId;v&&(this.members.startSync(),s&&(N=s.match(/^[\w-]+:(.*)$/))&&(d=N[1]));for(var I=0;I<i.length;I++){var j=O.default.fromValues(i[I]);switch(j.action){case"leave":D.remove(j)&&T.push(j),j.connectionId===E&&!j.isSynthesized()&&M.remove(j);break;case"enter":case"present":case"update":D.put(j)&&T.push(j),j.connectionId===E&&M.put(j);break}}v&&!d&&(D.endSync(),this.channel.syncChannelSerial=null);for(var I=0;I<T.length;I++){var j=T[I];this.subscriptions.emit(j.action,j)}},r.prototype.onAttached=function(i){S.default.logAction(S.default.LOG_MINOR,"RealtimePresence.onAttached()","channel = "+this.channel.name+", hasPresence = "+i),i?this.members.startSync():(this._synthesizeLeaves(this.members.values()),this.members.clear()),this._ensureMyMembersPresent();var v=this.pendingPresence,s=v.length;if(s){this.pendingPresence=[];var d=[],N=b.default.create();S.default.logAction(S.default.LOG_MICRO,"RealtimePresence.onAttached","sending "+s+" queued presence messages");for(var D=0;D<s;D++){var M=v[D];d.push(M.presence),N.push(M.callback)}this.channel.sendPresence(d,N)}},r.prototype.actOnChannelState=function(i,v,s){switch(i){case"attached":this.onAttached(v);break;case"detached":case"failed":this._clearMyMembers(),this.members.clear();case"suspended":this.failPendingPresence(s);break}},r.prototype.failPendingPresence=function(i){if(this.pendingPresence.length){S.default.logAction(S.default.LOG_MINOR,"RealtimeChannel.failPendingPresence","channel; name = "+this.channel.name+", err = "+n.inspectError(i));for(var v=0;v<this.pendingPresence.length;v++)try{this.pendingPresence[v].callback(i)}catch{}this.pendingPresence=[]}},r.prototype._clearMyMembers=function(){this._myMembers.clear()},r.prototype._ensureMyMembersPresent=function(){var i=this,v=this._myMembers,s=function(D){if(D){var M="Presence auto-re-enter failed: "+D.toString(),T=new P.default(M,91004,400);S.default.logAction(S.default.LOG_ERROR,"RealtimePresence._ensureMyMembersPresent()",M);var E=new a.default(i.channel.state,i.channel.state,!0,!1,T);i.channel.emit("update",E)}};for(var d in v.map){var N=v.map[d];S.default.logAction(S.default.LOG_MICRO,"RealtimePresence._ensureMyMembersPresent()",'Auto-reentering clientId "'+N.clientId+'" into the presence set'),this._enterOrUpdateClient(N.id,N.clientId,N.data,"enter",s)}},r.prototype._synthesizeLeaves=function(i){var v=this.subscriptions;n.arrForEach(i,function(s){var d=O.default.fromValues({action:"leave",connectionId:s.connectionId,clientId:s.clientId,data:s.data,encoding:s.encoding,timestamp:n.now()});v.emit("leave",d)})},r.prototype.on=function(){for(var i=[],v=0;v<arguments.length;v++)i[v]=arguments[v];S.default.deprecated("presence.on","presence.subscribe"),this.subscribe.apply(this,i)},r.prototype.off=function(){for(var i=[],v=0;v<arguments.length;v++)i[v]=arguments[v];S.default.deprecated("presence.off","presence.unsubscribe"),this.unsubscribe.apply(this,i)},r.prototype.subscribe=function(){for(var i=[],v=0;v<arguments.length;v++)i[v]=arguments[v];var s=A.default.processListenerArgs(i),d=s[0],N=s[1],D=s[2],M=this.channel;if(!D){if(this.channel.realtime.options.promises)return n.promisify(this,"subscribe",[d,N]);D=g}if(M.state==="failed"){D(P.default.fromValues(M.invalidStateError()));return}this.subscriptions.on(d,N),M.attach(D)},r.prototype.unsubscribe=function(){for(var i=[],v=0;v<arguments.length;v++)i[v]=arguments[v];var s=A.default.processListenerArgs(i),d=s[0],N=s[1];this.subscriptions.off(d,N)},r}(m.default),c=function(u){o.__extends(r,u);function r(i,v){var s=u.call(this)||this;return s.presence=i,s.map=Object.create(null),s.syncInProgress=!1,s.residualMembers=null,s.memberKey=v,s}return r.prototype.get=function(i){return this.map[i]},r.prototype.getClient=function(i){var v=this.map,s=[];for(var d in v){var N=v[d];N.clientId==i&&N.action!="absent"&&s.push(N)}return s},r.prototype.list=function(i){var v=this.map,s=i&&i.clientId,d=i&&i.connectionId,N=[];for(var D in v){var M=v[D];M.action!=="absent"&&(s&&s!=M.clientId||d&&d!=M.connectionId||N.push(M))}return N},r.prototype.put=function(i){(i.action==="enter"||i.action==="update")&&(i=O.default.fromValues(i),i.action="present");var v=this.map,s=this.memberKey(i);this.residualMembers&&delete this.residualMembers[s];var d=v[s];return d&&!y(i,d)?!1:(v[s]=i,!0)},r.prototype.values=function(){var i=this.map,v=[];for(var s in i){var d=i[s];d.action!="absent"&&v.push(d)}return v},r.prototype.remove=function(i){var v=this.map,s=this.memberKey(i),d=v[s];return d&&!y(i,d)?!1:(this.syncInProgress?(i=O.default.fromValues(i),i.action="absent",v[s]=i):delete v[s],!0)},r.prototype.startSync=function(){var i=this.map,v=this.syncInProgress;S.default.logAction(S.default.LOG_MINOR,"PresenceMap.startSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+v),this.syncInProgress||(this.residualMembers=n.copy(i),this.setInProgress(!0))},r.prototype.endSync=function(){var i=this.map,v=this.syncInProgress;if(S.default.logAction(S.default.LOG_MINOR,"PresenceMap.endSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+v),v){for(var s in i){var d=i[s];d.action==="absent"&&delete i[s]}this.presence._synthesizeLeaves(n.valuesArray(this.residualMembers));for(var s in this.residualMembers)delete i[s];this.residualMembers=null,this.setInProgress(!1)}this.emit("sync")},r.prototype.waitSync=function(i){var v=this.syncInProgress;if(S.default.logAction(S.default.LOG_MINOR,"PresenceMap.waitSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+v),!v){i();return}this.once("sync",i)},r.prototype.clear=function(){this.map={},this.setInProgress(!1),this.residualMembers=null},r.prototype.setInProgress=function(i){S.default.logAction(S.default.LOG_MICRO,"PresenceMap.setInProgress()","inProgress = "+i),this.syncInProgress=i,this.presence.syncComplete=!i},r}(C.default);e.default=R},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o=t(0),n=t(56),m=t(31),C=t(11),S=o.__importDefault(t(5)),O=o.__importDefault(t(3)),P=function(){function A(){this.base64CharSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this.hexCharSet="0123456789abcdef"}return A.prototype.isWordArray=function(b){return b!=null&&b.sigBytes!==void 0},A.prototype.isArrayBuffer=function(b){return b!=null&&b.constructor===ArrayBuffer},A.prototype.isTypedArray=function(b){return!!ArrayBuffer&&ArrayBuffer.isView&&ArrayBuffer.isView(b)},A.prototype.uint8ViewToBase64=function(b){for(var a="",g=this.base64CharSet,L=b.byteLength,x=L%3,p=L-x,y,R,c,u,r,i=0;i<p;i=i+3)r=b[i]<<16|b[i+1]<<8|b[i+2],y=(r&16515072)>>18,R=(r&258048)>>12,c=(r&4032)>>6,u=r&63,a+=g[y]+g[R]+g[c]+g[u];return x==1?(r=b[p],y=(r&252)>>2,R=(r&3)<<4,a+=g[y]+g[R]+"=="):x==2&&(r=b[p]<<8|b[p+1],y=(r&64512)>>10,R=(r&1008)>>4,c=(r&15)<<2,a+=g[y]+g[R]+g[c]+"="),a},A.prototype.base64ToArrayBuffer=function(b){for(var a=atob==null?void 0:atob(b),g=a.length,L=new Uint8Array(g),x=0;x<g;x++){var p=a.charCodeAt(x);L[x]=p}return L.buffer},A.prototype.isBuffer=function(b){return this.isArrayBuffer(b)||this.isWordArray(b)||this.isTypedArray(b)},A.prototype.toBuffer=function(b){if(!ArrayBuffer)throw new Error("Can't convert to Buffer: browser does not support the necessary types");if(this.isArrayBuffer(b))return new Uint8Array(b);if(this.isTypedArray(b))return new Uint8Array(b.buffer);if(this.isWordArray(b)){for(var a=new ArrayBuffer(b.sigBytes),g=new Uint8Array(a),L=0;L<b.sigBytes;L++)g[L]=b.words[L>>>2]>>>24-L%4*8&255;return g}throw new Error("BufferUtils.toBuffer expected an arraybuffer, typed array, or CryptoJS wordarray")},A.prototype.toArrayBuffer=function(b){return this.isArrayBuffer(b)?b:this.toBuffer(b).buffer},A.prototype.toWordArray=function(b){return this.isTypedArray(b)&&(b=b.buffer),this.isWordArray(b)?b:S.default.create(b)},A.prototype.base64Encode=function(b){return this.isWordArray(b)?(0,C.stringify)(b):this.uint8ViewToBase64(this.toBuffer(b))},A.prototype.base64Decode=function(b){return ArrayBuffer&&O.default.Config.atob?this.base64ToArrayBuffer(b):(0,C.parse)(b)},A.prototype.hexEncode=function(b){return(0,n.stringify)(this.toWordArray(b))},A.prototype.hexDecode=function(b){var a=(0,n.parse)(b);return ArrayBuffer?this.toArrayBuffer(a):a},A.prototype.utf8Encode=function(b){return O.default.Config.TextEncoder?new O.default.Config.TextEncoder().encode(b).buffer:(0,m.parse)(b)},A.prototype.utf8Decode=function(b){if(!this.isBuffer(b))throw new Error("Expected input of utf8decode to be an arraybuffer, typed array, or CryptoJS wordarray");return TextDecoder&&!this.isWordArray(b)?new TextDecoder().decode(b):(b=this.toWordArray(b),(0,m.stringify)(b))},A.prototype.bufferCompare=function(b,a){if(!b)return-1;if(!a)return 1;var g=this.toWordArray(b),L=this.toWordArray(a);g.clamp(),L.clamp();var x=g.sigBytes-L.sigBytes;if(x!=0)return x;for(var p=g.words,y=L.words,R=0;R<p.length;R++)if(x=p[R]-y[R],x!=0)return x;return 0},A.prototype.byteLength=function(b){return this.isArrayBuffer(b)||this.isTypedArray(b)?b.byteLength:this.isWordArray(b)?b.sigBytes:-1},A.prototype.typedArrayToBuffer=function(b){return b.buffer},A}();e.default=new P},function(l,e,t){(function(o,n){l.exports=n(t(6))})(this,function(o){return o.enc.Hex})},function(l,e,t){t.r(e);var o=t(5),n=t.n(o),m=t(11),C=t(22),S=t.n(C),O=t(2),P=t.n(O),A=t(4),b=t.n(A),a=function(g,L){var x="aes",p=256,y="cbc",R=16,c=4,u=4294967296,r=2147483648,i;if(g.getRandomWordArray)i=g.getRandomWordArray;else if(typeof Uint32Array<"u"&&g.getRandomValues){var v=new Uint32Array(c);i=function(I,j){var k=I/4,H=k==c?v:new Uint32Array(k);g.getRandomValues(H,function(V){typeof j<"u"&&j(V,L.toWordArray(H))})}}else i=function(I,j){P.a.logAction(P.a.LOG_MAJOR,"Ably.Crypto.generateRandom()","Warning: the browser you are using does not support secure cryptographically secure randomness generation; falling back to insecure Math.random()");for(var k=I/4,H=new Array(k),V=0;V<k;V++)H[V]=Math.floor(Math.random()*u)-r;j(null,n.a.create(H))};function s(I){return I+R&-R}function d(I){if(I.algorithm==="aes"&&I.mode==="cbc"){if(I.keyLength===128||I.keyLength===256)return;throw new Error("Unsupported key length "+I.keyLength+" for aes-cbc encryption. Encryption key must be 128 or 256 bits (16 or 32 ASCII characters)")}}function N(I){return I.replace("_","/").replace("-","+")}var D=[n.a.create([269488144,269488144,269488144,269488144],16),n.a.create([16777216],1),n.a.create([33685504],2),n.a.create([50529024],3),n.a.create([67372036],4),n.a.create([84215045,83886080],5),n.a.create([101058054,101056512],6),n.a.create([117901063,117901056],7),n.a.create([134744072,134744072],8),n.a.create([151587081,151587081,150994944],9),n.a.create([168430090,168430090,168427520],10),n.a.create([185273099,185273099,185273088],11),n.a.create([202116108,202116108,202116108],12),n.a.create([218959117,218959117,218959117,218103808],13),n.a.create([235802126,235802126,235802126,235798528],14),n.a.create([252645135,252645135,252645135,252645135],15),n.a.create([269488144,269488144,269488144,269488144],16)];function M(){}function T(){this.algorithm=null,this.keyLength=null,this.mode=null,this.key=null}M.CipherParams=T,M.getDefaultParams=function(I){var j;if(typeof I=="function"||typeof I=="string"){if(P.a.deprecated("Crypto.getDefaultParams(key, callback)","Crypto.getDefaultParams({key: key})"),typeof I=="function")M.generateRandomKey(function(H){I(null,M.getDefaultParams({key:H}))});else if(typeof arguments[1]=="function")arguments[1](null,M.getDefaultParams({key:I}));else throw new Error("Invalid arguments for Crypto.getDefaultParams");return}if(!I.key)throw new Error("Crypto.getDefaultParams: a key is required");typeof I.key=="string"?j=Object(m.parse)(N(I.key)):j=L.toWordArray(I.key);var k=new T;if(k.key=j,k.algorithm=I.algorithm||x,k.keyLength=j.words.length*(4*8),k.mode=I.mode||y,I.keyLength&&I.keyLength!==k.keyLength)throw new Error("Crypto.getDefaultParams: a keyLength of "+I.keyLength+" was specified, but the key actually has length "+k.keyLength);return d(k),k},M.generateRandomKey=function(I,j){arguments.length==1&&typeof I=="function"&&(j=I,I=void 0),i((I||p)/8,function(k,H){j!==void 0&&j(k?b.a.fromValues(k):null,H)})},M.getCipher=function(I){var j=I instanceof T?I:M.getDefaultParams(I);return{cipherParams:j,cipher:new E(j,c,I.iv)}};function E(I,j,k){this.algorithm=I.algorithm+"-"+String(I.keyLength)+"-"+I.mode,this.cjsAlgorithm=I.algorithm.toUpperCase().replace(/-\d+$/,""),this.key=L.toWordArray(I.key),k&&(this.iv=L.toWordArray(k).clone()),this.blockLengthWords=j}return E.prototype.encrypt=function(I,j){P.a.logAction(P.a.LOG_MICRO,"CBCCipher.encrypt()",""),I=L.toWordArray(I);var k=I.sigBytes,H=s(k),V=this,z=function(){V.getIv(function(_,w){if(_){j(_);return}var U=V.encryptCipher.process(I.concat(D[H-k])),B=w.concat(U);j(null,B)})};this.encryptCipher?z():this.iv?(this.encryptCipher=S.a.algo[this.cjsAlgorithm].createEncryptor(this.key,{iv:this.iv}),z()):i(R,function(_,w){if(_){j(_);return}V.encryptCipher=S.a.algo[V.cjsAlgorithm].createEncryptor(V.key,{iv:w}),V.iv=w,z()})},E.prototype.decrypt=function(I){P.a.logAction(P.a.LOG_MICRO,"CBCCipher.decrypt()",""),I=L.toWordArray(I);var j=this.blockLengthWords,k=I.words,H=n.a.create(k.slice(0,j)),V=n.a.create(k.slice(j)),z=S.a.algo[this.cjsAlgorithm].createDecryptor(this.key,{iv:H}),_=z.process(V),w=z.finalize();return z.reset(),w&&w.sigBytes&&_.concat(w),_},E.prototype.getIv=function(I){if(this.iv){var j=this.iv;this.iv=null,I(null,j);return}var k=this;i(R,function(H,V){if(H){I(H);return}I(null,k.encryptCipher.process(V))})},M};e.default=a},function(l,e,t){(function(o,n){l.exports=n(t(6))})(this,function(o){return function(){var n=o,m=n.lib,C=m.WordArray,S=n.enc;S.Utf16=S.Utf16BE={stringify:function(P){for(var A=P.words,b=P.sigBytes,a=[],g=0;g<b;g+=2){var L=A[g>>>2]>>>16-g%4*8&65535;a.push(String.fromCharCode(L))}return a.join("")},parse:function(P){for(var A=P.length,b=[],a=0;a<A;a++)b[a>>>1]|=P.charCodeAt(a)<<16-a%2*16;return C.create(b,A*2)}},S.Utf16LE={stringify:function(P){for(var A=P.words,b=P.sigBytes,a=[],g=0;g<b;g+=2){var L=O(A[g>>>2]>>>16-g%4*8&65535);a.push(String.fromCharCode(L))}return a.join("")},parse:function(P){for(var A=P.length,b=[],a=0;a<A;a++)b[a>>>1]|=O(P.charCodeAt(a)<<16-a%2*16);return C.create(b,A*2)}};function O(P){return P<<8&4278255360|P>>>8&16711935}}(),o.enc.Utf16})},function(l,e,t){(function(o,n){l.exports=n(t(6),t(28))})(this,function(o){return function(n){var m=o,C=m.lib,S=C.CipherParams,O=m.enc,P=O.Hex,A=m.format;A.Hex={stringify:function(b){return b.ciphertext.toString(P)},parse:function(b){var a=P.parse(b);return S.create({ciphertext:a})}}}(),o.format.Hex})},function(l,e,t){(function(o,n){l.exports=n(t(6),t(11),t(61),t(27),t(28))})(this,function(o){return function(){var n=o,m=n.lib,C=m.BlockCipher,S=n.algo,O=[],P=[],A=[],b=[],a=[],g=[],L=[],x=[],p=[],y=[];(function(){for(var u=[],r=0;r<256;r++)r<128?u[r]=r<<1:u[r]=r<<1^283;for(var i=0,v=0,r=0;r<256;r++){var s=v^v<<1^v<<2^v<<3^v<<4;s=s>>>8^s&255^99,O[i]=s,P[s]=i;var d=u[i],N=u[d],D=u[N],M=u[s]*257^s*16843008;A[i]=M<<24|M>>>8,b[i]=M<<16|M>>>16,a[i]=M<<8|M>>>24,g[i]=M;var M=D*16843009^N*65537^d*257^i*16843008;L[s]=M<<24|M>>>8,x[s]=M<<16|M>>>16,p[s]=M<<8|M>>>24,y[s]=M,i?(i=d^u[u[u[D^d]]],v^=u[u[v]]):i=v=1}})();var R=[0,1,2,4,8,16,32,64,128,27,54],c=S.AES=C.extend({_doReset:function(){var u;if(!(this._nRounds&&this._keyPriorReset===this._key)){for(var r=this._keyPriorReset=this._key,i=r.words,v=r.sigBytes/4,s=this._nRounds=v+6,d=(s+1)*4,N=this._keySchedule=[],D=0;D<d;D++)D<v?N[D]=i[D]:(u=N[D-1],D%v?v>6&&D%v==4&&(u=O[u>>>24]<<24|O[u>>>16&255]<<16|O[u>>>8&255]<<8|O[u&255]):(u=u<<8|u>>>24,u=O[u>>>24]<<24|O[u>>>16&255]<<16|O[u>>>8&255]<<8|O[u&255],u^=R[D/v|0]<<24),N[D]=N[D-v]^u);for(var M=this._invKeySchedule=[],T=0;T<d;T++){var D=d-T;if(T%4)var u=N[D];else var u=N[D-4];T<4||D<=4?M[T]=u:M[T]=L[O[u>>>24]]^x[O[u>>>16&255]]^p[O[u>>>8&255]]^y[O[u&255]]}}},encryptBlock:function(u,r){this._doCryptBlock(u,r,this._keySchedule,A,b,a,g,O)},decryptBlock:function(u,r){var i=u[r+1];u[r+1]=u[r+3],u[r+3]=i,this._doCryptBlock(u,r,this._invKeySchedule,L,x,p,y,P);var i=u[r+1];u[r+1]=u[r+3],u[r+3]=i},_doCryptBlock:function(u,r,i,v,s,d,N,D){for(var M=this._nRounds,T=u[r]^i[0],E=u[r+1]^i[1],I=u[r+2]^i[2],j=u[r+3]^i[3],k=4,H=1;H<M;H++){var V=v[T>>>24]^s[E>>>16&255]^d[I>>>8&255]^N[j&255]^i[k++],z=v[E>>>24]^s[I>>>16&255]^d[j>>>8&255]^N[T&255]^i[k++],_=v[I>>>24]^s[j>>>16&255]^d[T>>>8&255]^N[E&255]^i[k++],w=v[j>>>24]^s[T>>>16&255]^d[E>>>8&255]^N[I&255]^i[k++];T=V,E=z,I=_,j=w}var V=(D[T>>>24]<<24|D[E>>>16&255]<<16|D[I>>>8&255]<<8|D[j&255])^i[k++],z=(D[E>>>24]<<24|D[I>>>16&255]<<16|D[j>>>8&255]<<8|D[T&255])^i[k++],_=(D[I>>>24]<<24|D[j>>>16&255]<<16|D[T>>>8&255]<<8|D[E&255])^i[k++],w=(D[j>>>24]<<24|D[T>>>16&255]<<16|D[E>>>8&255]<<8|D[I&255])^i[k++];u[r]=V,u[r+1]=z,u[r+2]=_,u[r+3]=w},keySize:256/32});n.AES=C._createHelper(c)}(),o.AES})},function(l,e,t){(function(o,n){l.exports=n(t(6))})(this,function(o){return function(n){var m=o,C=m.lib,S=C.WordArray,O=C.Hasher,P=m.algo,A=[];(function(){for(var p=0;p<64;p++)A[p]=n.abs(n.sin(p+1))*4294967296|0})();var b=P.MD5=O.extend({_doReset:function(){this._hash=new S.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(p,y){for(var R=0;R<16;R++){var c=y+R,u=p[c];p[c]=(u<<8|u>>>24)&16711935|(u<<24|u>>>8)&4278255360}var r=this._hash.words,i=p[y+0],v=p[y+1],s=p[y+2],d=p[y+3],N=p[y+4],D=p[y+5],M=p[y+6],T=p[y+7],E=p[y+8],I=p[y+9],j=p[y+10],k=p[y+11],H=p[y+12],V=p[y+13],z=p[y+14],_=p[y+15],w=r[0],U=r[1],B=r[2],G=r[3];w=a(w,U,B,G,i,7,A[0]),G=a(G,w,U,B,v,12,A[1]),B=a(B,G,w,U,s,17,A[2]),U=a(U,B,G,w,d,22,A[3]),w=a(w,U,B,G,N,7,A[4]),G=a(G,w,U,B,D,12,A[5]),B=a(B,G,w,U,M,17,A[6]),U=a(U,B,G,w,T,22,A[7]),w=a(w,U,B,G,E,7,A[8]),G=a(G,w,U,B,I,12,A[9]),B=a(B,G,w,U,j,17,A[10]),U=a(U,B,G,w,k,22,A[11]),w=a(w,U,B,G,H,7,A[12]),G=a(G,w,U,B,V,12,A[13]),B=a(B,G,w,U,z,17,A[14]),U=a(U,B,G,w,_,22,A[15]),w=g(w,U,B,G,v,5,A[16]),G=g(G,w,U,B,M,9,A[17]),B=g(B,G,w,U,k,14,A[18]),U=g(U,B,G,w,i,20,A[19]),w=g(w,U,B,G,D,5,A[20]),G=g(G,w,U,B,j,9,A[21]),B=g(B,G,w,U,_,14,A[22]),U=g(U,B,G,w,N,20,A[23]),w=g(w,U,B,G,I,5,A[24]),G=g(G,w,U,B,z,9,A[25]),B=g(B,G,w,U,d,14,A[26]),U=g(U,B,G,w,E,20,A[27]),w=g(w,U,B,G,V,5,A[28]),G=g(G,w,U,B,s,9,A[29]),B=g(B,G,w,U,T,14,A[30]),U=g(U,B,G,w,H,20,A[31]),w=L(w,U,B,G,D,4,A[32]),G=L(G,w,U,B,E,11,A[33]),B=L(B,G,w,U,k,16,A[34]),U=L(U,B,G,w,z,23,A[35]),w=L(w,U,B,G,v,4,A[36]),G=L(G,w,U,B,N,11,A[37]),B=L(B,G,w,U,T,16,A[38]),U=L(U,B,G,w,j,23,A[39]),w=L(w,U,B,G,V,4,A[40]),G=L(G,w,U,B,i,11,A[41]),B=L(B,G,w,U,d,16,A[42]),U=L(U,B,G,w,M,23,A[43]),w=L(w,U,B,G,I,4,A[44]),G=L(G,w,U,B,H,11,A[45]),B=L(B,G,w,U,_,16,A[46]),U=L(U,B,G,w,s,23,A[47]),w=x(w,U,B,G,i,6,A[48]),G=x(G,w,U,B,T,10,A[49]),B=x(B,G,w,U,z,15,A[50]),U=x(U,B,G,w,D,21,A[51]),w=x(w,U,B,G,H,6,A[52]),G=x(G,w,U,B,d,10,A[53]),B=x(B,G,w,U,j,15,A[54]),U=x(U,B,G,w,v,21,A[55]),w=x(w,U,B,G,E,6,A[56]),G=x(G,w,U,B,_,10,A[57]),B=x(B,G,w,U,M,15,A[58]),U=x(U,B,G,w,V,21,A[59]),w=x(w,U,B,G,N,6,A[60]),G=x(G,w,U,B,k,10,A[61]),B=x(B,G,w,U,s,15,A[62]),U=x(U,B,G,w,I,21,A[63]),r[0]=r[0]+w|0,r[1]=r[1]+U|0,r[2]=r[2]+B|0,r[3]=r[3]+G|0},_doFinalize:function(){var p=this._data,y=p.words,R=this._nDataBytes*8,c=p.sigBytes*8;y[c>>>5]|=128<<24-c%32;var u=n.floor(R/4294967296),r=R;y[(c+64>>>9<<4)+15]=(u<<8|u>>>24)&16711935|(u<<24|u>>>8)&4278255360,y[(c+64>>>9<<4)+14]=(r<<8|r>>>24)&16711935|(r<<24|r>>>8)&4278255360,p.sigBytes=(y.length+1)*4,this._process();for(var i=this._hash,v=i.words,s=0;s<4;s++){var d=v[s];v[s]=(d<<8|d>>>24)&16711935|(d<<24|d>>>8)&4278255360}return i},clone:function(){var p=O.clone.call(this);return p._hash=this._hash.clone(),p}});function a(p,y,R,c,u,r,i){var v=p+(y&R|~y&c)+u+i;return(v<<r|v>>>32-r)+y}function g(p,y,R,c,u,r,i){var v=p+(y&c|R&~c)+u+i;return(v<<r|v>>>32-r)+y}function L(p,y,R,c,u,r,i){var v=p+(y^R^c)+u+i;return(v<<r|v>>>32-r)+y}function x(p,y,R,c,u,r,i){var v=p+(R^(y|~c))+u+i;return(v<<r|v>>>32-r)+y}m.MD5=O._createHelper(b),m.HmacMD5=O._createHmacHelper(b)}(Math),o.MD5})},function(l,e,t){var o;Object.defineProperty(e,"__esModule",{value:!0});var n=t(0),m=n.__importDefault(t(3)),C=n.__importStar(t(1)),S=n.__importDefault(t(8)),O=t(4),P=n.__importDefault(t(18)),A=n.__importDefault(t(16)),b=n.__importDefault(t(21)),a=n.__importDefault(t(2)),g=t(29),L=n.__importDefault(t(63)),x=t(25);function p(c){var u=c.statusCode;return u===408&&!c.code||u===400&&!c.code||u>=500&&u<=504}function y(c){var u=c.connection,r=u&&u.connectionManager.host;return r?[r].concat(S.default.getFallbackHosts(c.options)):S.default.getHosts(c.options)}var R=(o=function(){function c(u){this.checksInProgress=null,this.checkConnectivity=void 0,this.supportsAuthHeaders=!1,this.supportsLinkHeaders=!1,this._getHosts=y,this.options=u||{};var r=this.options.connectivityCheckUrl||S.default.connectivityCheckUrl,i=this.options.connectivityCheckParams,v=!this.options.connectivityCheckUrl;m.default.Config.xhrSupported?(this.supportsAuthHeaders=!0,this.Request=function(s,d,N,D,M,T,E){var I=A.default.createRequest(N,D,M,T,b.default.REQ_SEND,d&&d.options.timeouts,s);return I.once("complete",E),I.exec(),I},this.options.disableConnectivityCheck?this.checkConnectivity=function(s){s(null,!0)}:this.checkConnectivity=function(s){a.default.logAction(a.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Sending; "+r),this.doUri(P.default.Get,null,r,null,null,i,function(d,N,D,M,T){var E=!1;v?E=!d&&(N==null?void 0:N.replace(/\n/,""))=="yes":E=!d&&(0,x.isSuccessCode)(T),a.default.logAction(a.default.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Result: "+E),s(null,E)})}):m.default.Config.jsonpSupported?(this.Request=function(s,d,N,D,M,T,E){var I=(0,g.createRequest)(N,D,M,T,b.default.REQ_SEND,d&&d.options.timeouts,s);return I.once("complete",E),m.default.Config.nextTick(function(){I.exec()}),I},this.options.disableConnectivityCheck?this.checkConnectivity=function(s){s(null,!0)}:this.checkConnectivity=function(s){var d=this,N=S.default.jsonpInternetUpUrl;if(this.checksInProgress){this.checksInProgress.push(s);return}this.checksInProgress=[s],a.default.logAction(a.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Sending; "+N);var D=new g.Request("isTheInternetUp",N,null,null,null,b.default.REQ_SEND,S.default.TIMEOUTS);D.once("complete",function(M,T){var E=!M&&T;a.default.logAction(a.default.LOG_MICRO,"(JSONP)Http.checkConnectivity()","Result: "+E);for(var I=0;I<d.checksInProgress.length;I++)d.checksInProgress[I](null,E);d.checksInProgress=null}),m.default.Config.nextTick(function(){D.exec()})}):m.default.Config.fetchSupported?(this.supportsAuthHeaders=!0,this.Request=L.default,this.checkConnectivity=function(s){a.default.logAction(a.default.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Sending; "+r),this.doUri(P.default.Get,null,r,null,null,null,function(d,N){var D=!d&&(N==null?void 0:N.replace(/\n/,""))=="yes";a.default.logAction(a.default.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Result: "+D),s(null,D)})}):this.Request=function(s,d,N,D,M,T,E){E(new O.PartialErrorInfo("no supported HTTP transports available",null,400),null)}}return c.prototype.do=function(u,r,i,v,s,d,N){var D=this,M=typeof i=="function"?i:function(j){return r.baseUri(j)+i},T=r._currentFallback;if(T)if(T.validUntil>C.now()){if(!this.Request){N==null||N(new O.PartialErrorInfo("Request invoked before assigned to",null,500));return}this.Request(u,r,M(T.host),v,d,s,function(j){for(var k=[],H=1;H<arguments.length;H++)k[H-1]=arguments[H];if(j&&p(j)){r._currentFallback=null,D.do(u,r,i,v,s,d,N);return}N==null||N.apply(void 0,n.__spreadArray([j],k,!1))});return}else r._currentFallback=null;var E=y(r);if(E.length===1){this.doUri(u,r,M(E[0]),v,s,d,N);return}var I=function(j,k){var H=j.shift();D.doUri(u,r,M(H),v,s,d,function(V){for(var z=[],_=1;_<arguments.length;_++)z[_-1]=arguments[_];if(V&&p(V)&&j.length){I(j,!0);return}k&&(r._currentFallback={host:H,validUntil:C.now()+r.options.timeouts.fallbackRetryTimeout}),N==null||N.apply(void 0,n.__spreadArray([V],z,!1))})};I(E)},c.prototype.doUri=function(u,r,i,v,s,d,N){if(!this.Request){N(new O.PartialErrorInfo("Request invoked before assigned to",null,500));return}this.Request(u,r,i,v,d,s,N)},c}(),o.methods=[P.default.Get,P.default.Delete,P.default.Post,P.default.Put,P.default.Patch],o.methodsWithoutBody=[P.default.Get,P.default.Delete],o.methodsWithBody=[P.default.Post,P.default.Put,P.default.Patch],o);e.default=R},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o=t(0),n=o.__importStar(t(4)),m=o.__importDefault(t(3)),C=o.__importDefault(t(8)),S=o.__importStar(t(1)),O=t(1);function P(a,g){return!!g.get("x-ably-errorcode")}function A(a,g){if(P(a,g))return a.error&&n.default.fromValues(a.error)}function b(a,g,L,x,p,y,R){var c=new Headers(x||{}),u=a?a.toUpperCase():S.isEmptyArg(y)?"GET":"POST",r=new AbortController,i=setTimeout(function(){r.abort(),R(new n.PartialErrorInfo("Request timed out",null,408))},g?g.options.timeouts.httpRequestTimeout:C.default.TIMEOUTS.httpRequestTimeout),v={method:u,headers:c,body:y};m.default.Config.isWebworker||(v.credentials=c.has("authorization")?"include":"same-origin"),(0,O.getGlobalObject)().fetch(L+"?"+new URLSearchParams(p||{}),v).then(function(s){clearTimeout(i);var d=s.headers.get("Content-Type"),N;d&&d.indexOf("application/x-msgpack")>-1?N=s.arrayBuffer():d&&d.indexOf("application/json")>-1?N=s.json():N=s.text(),N.then(function(D){var M=!!d&&d.indexOf("application/x-msgpack")===-1;if(s.ok)R(null,D,s.headers,M,s.status);else{var T=A(D,s.headers)||new n.PartialErrorInfo("Error response received from server: "+s.status+" body was: "+m.default.Config.inspect(D),null,s.status);R(T,D,s.headers,M,s.status)}})}).catch(function(s){clearTimeout(i),R(s)})}e.default=b},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o=t(0),n=o.__importDefault(t(41)),m=o.__importStar(t(1)),C=m.getGlobalObject();typeof Window>"u"&&typeof WorkerGlobalScope>"u"&&console.log("Warning: this distribution of Ably is intended for browsers. On nodejs, please use the 'ably' package on npm");function S(){var b=C.location;return!C.WebSocket||!b||!b.origin||b.origin.indexOf("http")>-1}var O=C.navigator&&C.navigator.userAgent.toString(),P=C.location&&C.location.href,A={agent:"browser",logTimestamps:!0,userAgent:O,currentUrl:P,noUpgrade:O&&!!O.match(/MSIE\s8\.0/),binaryType:"arraybuffer",WebSocket:C.WebSocket,fetchSupported:!!C.fetch,xhrSupported:C.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,jsonpSupported:typeof document<"u",allowComet:S(),streamingSupported:!0,useProtocolHeartbeats:!0,createHmac:null,msgpack:n.default,supportsBinary:!!C.TextDecoder,preferBinary:!1,ArrayBuffer:C.ArrayBuffer,atob:C.atob,nextTick:typeof C.setImmediate<"u"?C.setImmediate.bind(C):function(b){setTimeout(b,0)},addEventListener:C.addEventListener,inspect:JSON.stringify,stringByteSize:function(b){return C.TextDecoder&&new C.TextEncoder().encode(b).length||b.length},TextEncoder:C.TextEncoder,TextDecoder:C.TextDecoder,Promise:C.Promise,getRandomValues:function(b){if(b!==void 0)return function(a,g){b.getRandomValues(a),g&&g(null)}}(C.crypto||msCrypto)};e.default=A},function(l,e,t){(function(o){Object.defineProperty(e,"__esModule",{value:!0});var n=t(0),m=n.__importStar(t(1)),C="ablyjs-storage-test",S=function(){function O(){try{o.sessionStorage.setItem(C,C),o.sessionStorage.removeItem(C),this.sessionSupported=!0}catch{this.sessionSupported=!1}try{o.localStorage.setItem(C,C),o.localStorage.removeItem(C),this.localSupported=!0}catch{this.localSupported=!1}}return O.prototype.get=function(P){return this._get(P,!1)},O.prototype.getSession=function(P){return this._get(P,!0)},O.prototype.remove=function(P){return this._remove(P,!1)},O.prototype.removeSession=function(P){return this._remove(P,!0)},O.prototype.set=function(P,A,b){return this._set(P,A,b,!1)},O.prototype.setSession=function(P,A,b){return this._set(P,A,b,!0)},O.prototype._set=function(P,A,b,a){var g={value:A};return b&&(g.expires=m.now()+b),this.storageInterface(a).setItem(P,JSON.stringify(g))},O.prototype._get=function(P,A){if(A&&!this.sessionSupported)throw new Error("Session Storage not supported");if(!A&&!this.localSupported)throw new Error("Local Storage not supported");var b=this.storageInterface(A).getItem(P);if(!b)return null;var a=JSON.parse(b);return a.expires&&a.expires<m.now()?(this.storageInterface(A).removeItem(P),null):a.value},O.prototype._remove=function(P,A){return this.storageInterface(A).removeItem(P)},O.prototype.storageInterface=function(P){return P?o.sessionStorage:o.localStorage},O}();e.default=new S}).call(this,t(13))},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o=t(0),n=o.__importDefault(t(67)),m={connectivityCheckUrl:"https://internet-up.ably-realtime.com/is-the-internet-up.txt",jsonpInternetUpUrl:"https://internet-up.ably-realtime.com/is-the-internet-up-0-9.js",defaultTransports:[n.default.XhrPolling,n.default.XhrStreaming,n.default.JsonP,n.default.WebSocket],baseTransportOrder:[n.default.XhrPolling,n.default.XhrStreaming,n.default.JsonP,n.default.WebSocket],transportPreferenceOrder:[n.default.JsonP,n.default.XhrPolling,n.default.XhrStreaming,n.default.WebSocket],upgradeTransports:[n.default.XhrStreaming,n.default.WebSocket]};e.default=m},function(l,e,t){Object.defineProperty(e,"__esModule",{value:!0});var o;(function(n){n.WebSocket="web_socket",n.Comet="comet",n.XhrStreaming="xhr_streaming",n.XhrPolling="xhr_polling",n.JsonP="jsonp"})(o||(o={})),e.default=o},function(l,e,t){t.r(e);var o=t(29),n=t.n(o),m=t(1),C=t(3),S=t.n(C),O=t(12),P=t.n(O),A=t(16),b=t.n(A),a=function(p){var y="xhr_polling";function R(c,u,r){r.stream=!1,P.a.call(this,c,u,r),this.shortName=y}return m.inherits(R,P.a),R.isAvailable=function(){return S.a.Config.xhrSupported&&S.a.Config.allowComet},R.prototype.toString=function(){return"XHRPollingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},R.prototype.createRequest=function(c,u,r,i,v){return b.a.createRequest(c,u,r,i,v,this.timeouts)},typeof p<"u"&&R.isAvailable()&&(p.supportedTransports[y]=R),R},g=a,L=function(p){var y="xhr_streaming";function R(c,u,r){P.a.call(this,c,u,r),this.shortName=y}return m.inherits(R,P.a),R.isAvailable=function(){return S.a.Config.xhrSupported&&S.a.Config.streamingSupported&&S.a.Config.allowComet},R.prototype.toString=function(){return"XHRStreamingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected},R.prototype.createRequest=function(c,u,r,i,v){return b.a.createRequest(c,u,r,i,v,this.timeouts)},typeof p<"u"&&R.isAvailable()&&(p.supportedTransports[y]=R),R},x=L;e.default=[n.a,g,x]}]).default})})(He);var Fe=He.exports;const Bn=Un(Fe),kn=dn({__proto__:null,default:Bn},[Fe]);function _e(f,h){return function(){return f.apply(h,arguments)}}const{toString:jn}=Object.prototype,{getPrototypeOf:pe}=Object,zt=(f=>h=>{const l=jn.call(h);return f[l]||(f[l]=l.slice(8,-1).toLowerCase())})(Object.create(null)),yt=f=>(f=f.toLowerCase(),h=>zt(h)===f),Jt=f=>h=>typeof h===f,{isArray:Et}=Array,It=Jt("undefined");function Gn(f){return f!==null&&!It(f)&&f.constructor!==null&&!It(f.constructor)&&pt(f.constructor.isBuffer)&&f.constructor.isBuffer(f)}const We=yt("ArrayBuffer");function Hn(f){let h;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?h=ArrayBuffer.isView(f):h=f&&f.buffer&&We(f.buffer),h}const Fn=Jt("string"),pt=Jt("function"),Ve=Jt("number"),Kt=f=>f!==null&&typeof f=="object",_n=f=>f===!0||f===!1,Nt=f=>{if(zt(f)!=="object")return!1;const h=pe(f);return(h===null||h===Object.prototype||Object.getPrototypeOf(h)===null)&&!(Symbol.toStringTag in f)&&!(Symbol.iterator in f)},Wn=yt("Date"),Vn=yt("File"),zn=yt("Blob"),Jn=yt("FileList"),Kn=f=>Kt(f)&&pt(f.pipe),qn=f=>{let h;return f&&(typeof FormData=="function"&&f instanceof FormData||pt(f.append)&&((h=zt(f))==="formdata"||h==="object"&&pt(f.toString)&&f.toString()==="[object FormData]"))},Qn=yt("URLSearchParams"),$n=f=>f.trim?f.trim():f.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Pt(f,h,{allOwnKeys:l=!1}={}){if(f===null||typeof f>"u")return;let e,t;if(typeof f!="object"&&(f=[f]),Et(f))for(e=0,t=f.length;e<t;e++)h.call(null,f[e],e,f);else{const o=l?Object.getOwnPropertyNames(f):Object.keys(f),n=o.length;let m;for(e=0;e<n;e++)m=o[e],h.call(null,f[m],m,f)}}function ze(f,h){h=h.toLowerCase();const l=Object.keys(f);let e=l.length,t;for(;e-- >0;)if(t=l[e],h===t.toLowerCase())return t;return null}const Je=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),Ke=f=>!It(f)&&f!==Je;function oe(){const{caseless:f}=Ke(this)&&this||{},h={},l=(e,t)=>{const o=f&&ze(h,t)||t;Nt(h[o])&&Nt(e)?h[o]=oe(h[o],e):Nt(e)?h[o]=oe({},e):Et(e)?h[o]=e.slice():h[o]=e};for(let e=0,t=arguments.length;e<t;e++)arguments[e]&&Pt(arguments[e],l);return h}const Xn=(f,h,l,{allOwnKeys:e}={})=>(Pt(h,(t,o)=>{l&&pt(t)?f[o]=_e(t,l):f[o]=t},{allOwnKeys:e}),f),Yn=f=>(f.charCodeAt(0)===65279&&(f=f.slice(1)),f),Zn=(f,h,l,e)=>{f.prototype=Object.create(h.prototype,e),f.prototype.constructor=f,Object.defineProperty(f,"super",{value:h.prototype}),l&&Object.assign(f.prototype,l)},tr=(f,h,l,e)=>{let t,o,n;const m={};if(h=h||{},f==null)return h;do{for(t=Object.getOwnPropertyNames(f),o=t.length;o-- >0;)n=t[o],(!e||e(n,f,h))&&!m[n]&&(h[n]=f[n],m[n]=!0);f=l!==!1&&pe(f)}while(f&&(!l||l(f,h))&&f!==Object.prototype);return h},er=(f,h,l)=>{f=String(f),(l===void 0||l>f.length)&&(l=f.length),l-=h.length;const e=f.indexOf(h,l);return e!==-1&&e===l},nr=f=>{if(!f)return null;if(Et(f))return f;let h=f.length;if(!Ve(h))return null;const l=new Array(h);for(;h-- >0;)l[h]=f[h];return l},rr=(f=>h=>f&&h instanceof f)(typeof Uint8Array<"u"&&pe(Uint8Array)),ir=(f,h)=>{const e=(f&&f[Symbol.iterator]).call(f);let t;for(;(t=e.next())&&!t.done;){const o=t.value;h.call(f,o[0],o[1])}},or=(f,h)=>{let l;const e=[];for(;(l=f.exec(h))!==null;)e.push(l);return e},sr=yt("HTMLFormElement"),ar=f=>f.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(l,e,t){return e.toUpperCase()+t}),be=(({hasOwnProperty:f})=>(h,l)=>f.call(h,l))(Object.prototype),ur=yt("RegExp"),qe=(f,h)=>{const l=Object.getOwnPropertyDescriptors(f),e={};Pt(l,(t,o)=>{let n;(n=h(t,o,f))!==!1&&(e[o]=n||t)}),Object.defineProperties(f,e)},cr=f=>{qe(f,(h,l)=>{if(pt(f)&&["arguments","caller","callee"].indexOf(l)!==-1)return!1;const e=f[l];if(pt(e)){if(h.enumerable=!1,"writable"in h){h.writable=!1;return}h.set||(h.set=()=>{throw Error("Can not rewrite read-only method '"+l+"'")})}})},lr=(f,h)=>{const l={},e=t=>{t.forEach(o=>{l[o]=!0})};return Et(f)?e(f):e(String(f).split(h)),l},fr=()=>{},dr=(f,h)=>(f=+f,Number.isFinite(f)?f:h),te="abcdefghijklmnopqrstuvwxyz",Ee="0123456789",Qe={DIGIT:Ee,ALPHA:te,ALPHA_DIGIT:te+te.toUpperCase()+Ee},hr=(f=16,h=Qe.ALPHA_DIGIT)=>{let l="";const{length:e}=h;for(;f--;)l+=h[Math.random()*e|0];return l};function pr(f){return!!(f&&pt(f.append)&&f[Symbol.toStringTag]==="FormData"&&f[Symbol.iterator])}const vr=f=>{const h=new Array(10),l=(e,t)=>{if(Kt(e)){if(h.indexOf(e)>=0)return;if(!("toJSON"in e)){h[t]=e;const o=Et(e)?[]:{};return Pt(e,(n,m)=>{const C=l(n,t+1);!It(C)&&(o[m]=C)}),h[t]=void 0,o}}return e};return l(f,0)},gr=yt("AsyncFunction"),mr=f=>f&&(Kt(f)||pt(f))&&pt(f.then)&&pt(f.catch),J={isArray:Et,isArrayBuffer:We,isBuffer:Gn,isFormData:qn,isArrayBufferView:Hn,isString:Fn,isNumber:Ve,isBoolean:_n,isObject:Kt,isPlainObject:Nt,isUndefined:It,isDate:Wn,isFile:Vn,isBlob:zn,isRegExp:ur,isFunction:pt,isStream:Kn,isURLSearchParams:Qn,isTypedArray:rr,isFileList:Jn,forEach:Pt,merge:oe,extend:Xn,trim:$n,stripBOM:Yn,inherits:Zn,toFlatObject:tr,kindOf:zt,kindOfTest:yt,endsWith:er,toArray:nr,forEachEntry:ir,matchAll:or,isHTMLForm:sr,hasOwnProperty:be,hasOwnProp:be,reduceDescriptors:qe,freezeMethods:cr,toObjectSet:lr,toCamelCase:ar,noop:fr,toFiniteNumber:dr,findKey:ze,global:Je,isContextDefined:Ke,ALPHABET:Qe,generateString:hr,isSpecCompliantForm:pr,toJSONObject:vr,isAsyncFn:gr,isThenable:mr};function nt(f,h,l,e,t){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=f,this.name="AxiosError",h&&(this.code=h),l&&(this.config=l),e&&(this.request=e),t&&(this.response=t)}J.inherits(nt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:J.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const $e=nt.prototype,Xe={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(f=>{Xe[f]={value:f}});Object.defineProperties(nt,Xe);Object.defineProperty($e,"isAxiosError",{value:!0});nt.from=(f,h,l,e,t,o)=>{const n=Object.create($e);return J.toFlatObject(f,n,function(C){return C!==Error.prototype},m=>m!=="isAxiosError"),nt.call(n,f.message,h,l,e,t),n.cause=f,n.name=f.name,o&&Object.assign(n,o),n};const yr=null;function se(f){return J.isPlainObject(f)||J.isArray(f)}function Ye(f){return J.endsWith(f,"[]")?f.slice(0,-2):f}function Te(f,h,l){return f?f.concat(h).map(function(t,o){return t=Ye(t),!l&&o?"["+t+"]":t}).join(l?".":""):h}function Or(f){return J.isArray(f)&&!f.some(se)}const Cr=J.toFlatObject(J,{},null,function(h){return/^is[A-Z]/.test(h)});function qt(f,h,l){if(!J.isObject(f))throw new TypeError("target must be an object");h=h||new FormData,l=J.toFlatObject(l,{metaTokens:!0,dots:!1,indexes:!1},!1,function(g,L){return!J.isUndefined(L[g])});const e=l.metaTokens,t=l.visitor||O,o=l.dots,n=l.indexes,C=(l.Blob||typeof Blob<"u"&&Blob)&&J.isSpecCompliantForm(h);if(!J.isFunction(t))throw new TypeError("visitor must be a function");function S(a){if(a===null)return"";if(J.isDate(a))return a.toISOString();if(!C&&J.isBlob(a))throw new nt("Blob is not supported. Use a Buffer instead.");return J.isArrayBuffer(a)||J.isTypedArray(a)?C&&typeof Blob=="function"?new Blob([a]):Buffer.from(a):a}function O(a,g,L){let x=a;if(a&&!L&&typeof a=="object"){if(J.endsWith(g,"{}"))g=e?g:g.slice(0,-2),a=JSON.stringify(a);else if(J.isArray(a)&&Or(a)||(J.isFileList(a)||J.endsWith(g,"[]"))&&(x=J.toArray(a)))return g=Ye(g),x.forEach(function(y,R){!(J.isUndefined(y)||y===null)&&h.append(n===!0?Te([g],R,o):n===null?g:g+"[]",S(y))}),!1}return se(a)?!0:(h.append(Te(L,g,o),S(a)),!1)}const P=[],A=Object.assign(Cr,{defaultVisitor:O,convertValue:S,isVisitable:se});function b(a,g){if(!J.isUndefined(a)){if(P.indexOf(a)!==-1)throw Error("Circular reference detected in "+g.join("."));P.push(a),J.forEach(a,function(x,p){(!(J.isUndefined(x)||x===null)&&t.call(h,x,J.isString(p)?p.trim():p,g,A))===!0&&b(x,g?g.concat(p):[p])}),P.pop()}}if(!J.isObject(f))throw new TypeError("data must be an object");return b(f),h}function we(f){const h={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(f).replace(/[!'()~]|%20|%00/g,function(e){return h[e]})}function ve(f,h){this._pairs=[],f&&qt(f,this,h)}const Ze=ve.prototype;Ze.append=function(h,l){this._pairs.push([h,l])};Ze.toString=function(h){const l=h?function(e){return h.call(this,e,we)}:we;return this._pairs.map(function(t){return l(t[0])+"="+l(t[1])},"").join("&")};function Rr(f){return encodeURIComponent(f).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function tn(f,h,l){if(!h)return f;const e=l&&l.encode||Rr,t=l&&l.serialize;let o;if(t?o=t(h,l):o=J.isURLSearchParams(h)?h.toString():new ve(h,l).toString(e),o){const n=f.indexOf("#");n!==-1&&(f=f.slice(0,n)),f+=(f.indexOf("?")===-1?"?":"&")+o}return f}class Ar{constructor(){this.handlers=[]}use(h,l,e){return this.handlers.push({fulfilled:h,rejected:l,synchronous:e?e.synchronous:!1,runWhen:e?e.runWhen:null}),this.handlers.length-1}eject(h){this.handlers[h]&&(this.handlers[h]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(h){J.forEach(this.handlers,function(e){e!==null&&h(e)})}}const Ie=Ar,en={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Sr=typeof URLSearchParams<"u"?URLSearchParams:ve,br=typeof FormData<"u"?FormData:null,Er=typeof Blob<"u"?Blob:null,Tr=(()=>{let f;return typeof navigator<"u"&&((f=navigator.product)==="ReactNative"||f==="NativeScript"||f==="NS")?!1:typeof window<"u"&&typeof document<"u"})(),wr=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),mt={isBrowser:!0,classes:{URLSearchParams:Sr,FormData:br,Blob:Er},isStandardBrowserEnv:Tr,isStandardBrowserWebWorkerEnv:wr,protocols:["http","https","file","blob","url","data"]};function Ir(f,h){return qt(f,new mt.classes.URLSearchParams,Object.assign({visitor:function(l,e,t,o){return mt.isNode&&J.isBuffer(l)?(this.append(e,l.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},h))}function Pr(f){return J.matchAll(/\w+|\[(\w*)]/g,f).map(h=>h[0]==="[]"?"":h[1]||h[0])}function Mr(f){const h={},l=Object.keys(f);let e;const t=l.length;let o;for(e=0;e<t;e++)o=l[e],h[o]=f[o];return h}function nn(f){function h(l,e,t,o){let n=l[o++];const m=Number.isFinite(+n),C=o>=l.length;return n=!n&&J.isArray(t)?t.length:n,C?(J.hasOwnProp(t,n)?t[n]=[t[n],e]:t[n]=e,!m):((!t[n]||!J.isObject(t[n]))&&(t[n]=[]),h(l,e,t[n],o)&&J.isArray(t[n])&&(t[n]=Mr(t[n])),!m)}if(J.isFormData(f)&&J.isFunction(f.entries)){const l={};return J.forEachEntry(f,(e,t)=>{h(Pr(e),t,l,0)}),l}return null}function xr(f,h,l){if(J.isString(f))try{return(h||JSON.parse)(f),J.trim(f)}catch(e){if(e.name!=="SyntaxError")throw e}return(l||JSON.stringify)(f)}const ge={transitional:en,adapter:["xhr","http"],transformRequest:[function(h,l){const e=l.getContentType()||"",t=e.indexOf("application/json")>-1,o=J.isObject(h);if(o&&J.isHTMLForm(h)&&(h=new FormData(h)),J.isFormData(h))return t&&t?JSON.stringify(nn(h)):h;if(J.isArrayBuffer(h)||J.isBuffer(h)||J.isStream(h)||J.isFile(h)||J.isBlob(h))return h;if(J.isArrayBufferView(h))return h.buffer;if(J.isURLSearchParams(h))return l.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),h.toString();let m;if(o){if(e.indexOf("application/x-www-form-urlencoded")>-1)return Ir(h,this.formSerializer).toString();if((m=J.isFileList(h))||e.indexOf("multipart/form-data")>-1){const C=this.env&&this.env.FormData;return qt(m?{"files[]":h}:h,C&&new C,this.formSerializer)}}return o||t?(l.setContentType("application/json",!1),xr(h)):h}],transformResponse:[function(h){const l=this.transitional||ge.transitional,e=l&&l.forcedJSONParsing,t=this.responseType==="json";if(h&&J.isString(h)&&(e&&!this.responseType||t)){const n=!(l&&l.silentJSONParsing)&&t;try{return JSON.parse(h)}catch(m){if(n)throw m.name==="SyntaxError"?nt.from(m,nt.ERR_BAD_RESPONSE,this,null,this.response):m}}return h}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:mt.classes.FormData,Blob:mt.classes.Blob},validateStatus:function(h){return h>=200&&h<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};J.forEach(["delete","get","head","post","put","patch"],f=>{ge.headers[f]={}});const me=ge,Lr=J.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Dr=f=>{const h={};let l,e,t;return f&&f.split(`
`).forEach(function(n){t=n.indexOf(":"),l=n.substring(0,t).trim().toLowerCase(),e=n.substring(t+1).trim(),!(!l||h[l]&&Lr[l])&&(l==="set-cookie"?h[l]?h[l].push(e):h[l]=[e]:h[l]=h[l]?h[l]+", "+e:e)}),h},Pe=Symbol("internals");function wt(f){return f&&String(f).trim().toLowerCase()}function Ut(f){return f===!1||f==null?f:J.isArray(f)?f.map(Ut):String(f)}function Nr(f){const h=Object.create(null),l=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let e;for(;e=l.exec(f);)h[e[1]]=e[2];return h}const Ur=f=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(f.trim());function ee(f,h,l,e,t){if(J.isFunction(e))return e.call(this,h,l);if(t&&(h=l),!!J.isString(h)){if(J.isString(e))return h.indexOf(e)!==-1;if(J.isRegExp(e))return e.test(h)}}function Br(f){return f.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(h,l,e)=>l.toUpperCase()+e)}function kr(f,h){const l=J.toCamelCase(" "+h);["get","set","has"].forEach(e=>{Object.defineProperty(f,e+l,{value:function(t,o,n){return this[e].call(this,h,t,o,n)},configurable:!0})})}class Qt{constructor(h){h&&this.set(h)}set(h,l,e){const t=this;function o(m,C,S){const O=wt(C);if(!O)throw new Error("header name must be a non-empty string");const P=J.findKey(t,O);(!P||t[P]===void 0||S===!0||S===void 0&&t[P]!==!1)&&(t[P||C]=Ut(m))}const n=(m,C)=>J.forEach(m,(S,O)=>o(S,O,C));return J.isPlainObject(h)||h instanceof this.constructor?n(h,l):J.isString(h)&&(h=h.trim())&&!Ur(h)?n(Dr(h),l):h!=null&&o(l,h,e),this}get(h,l){if(h=wt(h),h){const e=J.findKey(this,h);if(e){const t=this[e];if(!l)return t;if(l===!0)return Nr(t);if(J.isFunction(l))return l.call(this,t,e);if(J.isRegExp(l))return l.exec(t);throw new TypeError("parser must be boolean|regexp|function")}}}has(h,l){if(h=wt(h),h){const e=J.findKey(this,h);return!!(e&&this[e]!==void 0&&(!l||ee(this,this[e],e,l)))}return!1}delete(h,l){const e=this;let t=!1;function o(n){if(n=wt(n),n){const m=J.findKey(e,n);m&&(!l||ee(e,e[m],m,l))&&(delete e[m],t=!0)}}return J.isArray(h)?h.forEach(o):o(h),t}clear(h){const l=Object.keys(this);let e=l.length,t=!1;for(;e--;){const o=l[e];(!h||ee(this,this[o],o,h,!0))&&(delete this[o],t=!0)}return t}normalize(h){const l=this,e={};return J.forEach(this,(t,o)=>{const n=J.findKey(e,o);if(n){l[n]=Ut(t),delete l[o];return}const m=h?Br(o):String(o).trim();m!==o&&delete l[o],l[m]=Ut(t),e[m]=!0}),this}concat(...h){return this.constructor.concat(this,...h)}toJSON(h){const l=Object.create(null);return J.forEach(this,(e,t)=>{e!=null&&e!==!1&&(l[t]=h&&J.isArray(e)?e.join(", "):e)}),l}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([h,l])=>h+": "+l).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(h){return h instanceof this?h:new this(h)}static concat(h,...l){const e=new this(h);return l.forEach(t=>e.set(t)),e}static accessor(h){const e=(this[Pe]=this[Pe]={accessors:{}}).accessors,t=this.prototype;function o(n){const m=wt(n);e[m]||(kr(t,n),e[m]=!0)}return J.isArray(h)?h.forEach(o):o(h),this}}Qt.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);J.reduceDescriptors(Qt.prototype,({value:f},h)=>{let l=h[0].toUpperCase()+h.slice(1);return{get:()=>f,set(e){this[l]=e}}});J.freezeMethods(Qt);const Rt=Qt;function ne(f,h){const l=this||me,e=h||l,t=Rt.from(e.headers);let o=e.data;return J.forEach(f,function(m){o=m.call(l,o,t.normalize(),h?h.status:void 0)}),t.normalize(),o}function rn(f){return!!(f&&f.__CANCEL__)}function Mt(f,h,l){nt.call(this,f??"canceled",nt.ERR_CANCELED,h,l),this.name="CanceledError"}J.inherits(Mt,nt,{__CANCEL__:!0});function jr(f,h,l){const e=l.config.validateStatus;!l.status||!e||e(l.status)?f(l):h(new nt("Request failed with status code "+l.status,[nt.ERR_BAD_REQUEST,nt.ERR_BAD_RESPONSE][Math.floor(l.status/100)-4],l.config,l.request,l))}const Gr=mt.isStandardBrowserEnv?function(){return{write:function(l,e,t,o,n,m){const C=[];C.push(l+"="+encodeURIComponent(e)),J.isNumber(t)&&C.push("expires="+new Date(t).toGMTString()),J.isString(o)&&C.push("path="+o),J.isString(n)&&C.push("domain="+n),m===!0&&C.push("secure"),document.cookie=C.join("; ")},read:function(l){const e=document.cookie.match(new RegExp("(^|;\\s*)("+l+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(l){this.write(l,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function Hr(f){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(f)}function Fr(f,h){return h?f.replace(/\/+$/,"")+"/"+h.replace(/^\/+/,""):f}function on(f,h){return f&&!Hr(h)?Fr(f,h):h}const _r=mt.isStandardBrowserEnv?function(){const h=/(msie|trident)/i.test(navigator.userAgent),l=document.createElement("a");let e;function t(o){let n=o;return h&&(l.setAttribute("href",n),n=l.href),l.setAttribute("href",n),{href:l.href,protocol:l.protocol?l.protocol.replace(/:$/,""):"",host:l.host,search:l.search?l.search.replace(/^\?/,""):"",hash:l.hash?l.hash.replace(/^#/,""):"",hostname:l.hostname,port:l.port,pathname:l.pathname.charAt(0)==="/"?l.pathname:"/"+l.pathname}}return e=t(window.location.href),function(n){const m=J.isString(n)?t(n):n;return m.protocol===e.protocol&&m.host===e.host}}():function(){return function(){return!0}}();function Wr(f){const h=/^([-+\w]{1,25})(:?\/\/|:)/.exec(f);return h&&h[1]||""}function Vr(f,h){f=f||10;const l=new Array(f),e=new Array(f);let t=0,o=0,n;return h=h!==void 0?h:1e3,function(C){const S=Date.now(),O=e[o];n||(n=S),l[t]=C,e[t]=S;let P=o,A=0;for(;P!==t;)A+=l[P++],P=P%f;if(t=(t+1)%f,t===o&&(o=(o+1)%f),S-n<h)return;const b=O&&S-O;return b?Math.round(A*1e3/b):void 0}}function Me(f,h){let l=0;const e=Vr(50,250);return t=>{const o=t.loaded,n=t.lengthComputable?t.total:void 0,m=o-l,C=e(m),S=o<=n;l=o;const O={loaded:o,total:n,progress:n?o/n:void 0,bytes:m,rate:C||void 0,estimated:C&&n&&S?(n-o)/C:void 0,event:t};O[h?"download":"upload"]=!0,f(O)}}const zr=typeof XMLHttpRequest<"u",Jr=zr&&function(f){return new Promise(function(l,e){let t=f.data;const o=Rt.from(f.headers).normalize(),n=f.responseType;let m;function C(){f.cancelToken&&f.cancelToken.unsubscribe(m),f.signal&&f.signal.removeEventListener("abort",m)}let S;J.isFormData(t)&&(mt.isStandardBrowserEnv||mt.isStandardBrowserWebWorkerEnv?o.setContentType(!1):o.getContentType(/^\s*multipart\/form-data/)?J.isString(S=o.getContentType())&&o.setContentType(S.replace(/^\s*(multipart\/form-data);+/,"$1")):o.setContentType("multipart/form-data"));let O=new XMLHttpRequest;if(f.auth){const a=f.auth.username||"",g=f.auth.password?unescape(encodeURIComponent(f.auth.password)):"";o.set("Authorization","Basic "+btoa(a+":"+g))}const P=on(f.baseURL,f.url);O.open(f.method.toUpperCase(),tn(P,f.params,f.paramsSerializer),!0),O.timeout=f.timeout;function A(){if(!O)return;const a=Rt.from("getAllResponseHeaders"in O&&O.getAllResponseHeaders()),L={data:!n||n==="text"||n==="json"?O.responseText:O.response,status:O.status,statusText:O.statusText,headers:a,config:f,request:O};jr(function(p){l(p),C()},function(p){e(p),C()},L),O=null}if("onloadend"in O?O.onloadend=A:O.onreadystatechange=function(){!O||O.readyState!==4||O.status===0&&!(O.responseURL&&O.responseURL.indexOf("file:")===0)||setTimeout(A)},O.onabort=function(){O&&(e(new nt("Request aborted",nt.ECONNABORTED,f,O)),O=null)},O.onerror=function(){e(new nt("Network Error",nt.ERR_NETWORK,f,O)),O=null},O.ontimeout=function(){let g=f.timeout?"timeout of "+f.timeout+"ms exceeded":"timeout exceeded";const L=f.transitional||en;f.timeoutErrorMessage&&(g=f.timeoutErrorMessage),e(new nt(g,L.clarifyTimeoutError?nt.ETIMEDOUT:nt.ECONNABORTED,f,O)),O=null},mt.isStandardBrowserEnv){const a=(f.withCredentials||_r(P))&&f.xsrfCookieName&&Gr.read(f.xsrfCookieName);a&&o.set(f.xsrfHeaderName,a)}t===void 0&&o.setContentType(null),"setRequestHeader"in O&&J.forEach(o.toJSON(),function(g,L){O.setRequestHeader(L,g)}),J.isUndefined(f.withCredentials)||(O.withCredentials=!!f.withCredentials),n&&n!=="json"&&(O.responseType=f.responseType),typeof f.onDownloadProgress=="function"&&O.addEventListener("progress",Me(f.onDownloadProgress,!0)),typeof f.onUploadProgress=="function"&&O.upload&&O.upload.addEventListener("progress",Me(f.onUploadProgress)),(f.cancelToken||f.signal)&&(m=a=>{O&&(e(!a||a.type?new Mt(null,f,O):a),O.abort(),O=null)},f.cancelToken&&f.cancelToken.subscribe(m),f.signal&&(f.signal.aborted?m():f.signal.addEventListener("abort",m)));const b=Wr(P);if(b&&mt.protocols.indexOf(b)===-1){e(new nt("Unsupported protocol "+b+":",nt.ERR_BAD_REQUEST,f));return}O.send(t||null)})},ae={http:yr,xhr:Jr};J.forEach(ae,(f,h)=>{if(f){try{Object.defineProperty(f,"name",{value:h})}catch{}Object.defineProperty(f,"adapterName",{value:h})}});const xe=f=>`- ${f}`,Kr=f=>J.isFunction(f)||f===null||f===!1,sn={getAdapter:f=>{f=J.isArray(f)?f:[f];const{length:h}=f;let l,e;const t={};for(let o=0;o<h;o++){l=f[o];let n;if(e=l,!Kr(l)&&(e=ae[(n=String(l)).toLowerCase()],e===void 0))throw new nt(`Unknown adapter '${n}'`);if(e)break;t[n||"#"+o]=e}if(!e){const o=Object.entries(t).map(([m,C])=>`adapter ${m} `+(C===!1?"is not supported by the environment":"is not available in the build"));let n=h?o.length>1?`since :
`+o.map(xe).join(`
`):" "+xe(o[0]):"as no adapter specified";throw new nt("There is no suitable adapter to dispatch the request "+n,"ERR_NOT_SUPPORT")}return e},adapters:ae};function re(f){if(f.cancelToken&&f.cancelToken.throwIfRequested(),f.signal&&f.signal.aborted)throw new Mt(null,f)}function Le(f){return re(f),f.headers=Rt.from(f.headers),f.data=ne.call(f,f.transformRequest),["post","put","patch"].indexOf(f.method)!==-1&&f.headers.setContentType("application/x-www-form-urlencoded",!1),sn.getAdapter(f.adapter||me.adapter)(f).then(function(e){return re(f),e.data=ne.call(f,f.transformResponse,e),e.headers=Rt.from(e.headers),e},function(e){return rn(e)||(re(f),e&&e.response&&(e.response.data=ne.call(f,f.transformResponse,e.response),e.response.headers=Rt.from(e.response.headers))),Promise.reject(e)})}const De=f=>f instanceof Rt?f.toJSON():f;function bt(f,h){h=h||{};const l={};function e(S,O,P){return J.isPlainObject(S)&&J.isPlainObject(O)?J.merge.call({caseless:P},S,O):J.isPlainObject(O)?J.merge({},O):J.isArray(O)?O.slice():O}function t(S,O,P){if(J.isUndefined(O)){if(!J.isUndefined(S))return e(void 0,S,P)}else return e(S,O,P)}function o(S,O){if(!J.isUndefined(O))return e(void 0,O)}function n(S,O){if(J.isUndefined(O)){if(!J.isUndefined(S))return e(void 0,S)}else return e(void 0,O)}function m(S,O,P){if(P in h)return e(S,O);if(P in f)return e(void 0,S)}const C={url:o,method:o,data:o,baseURL:n,transformRequest:n,transformResponse:n,paramsSerializer:n,timeout:n,timeoutMessage:n,withCredentials:n,adapter:n,responseType:n,xsrfCookieName:n,xsrfHeaderName:n,onUploadProgress:n,onDownloadProgress:n,decompress:n,maxContentLength:n,maxBodyLength:n,beforeRedirect:n,transport:n,httpAgent:n,httpsAgent:n,cancelToken:n,socketPath:n,responseEncoding:n,validateStatus:m,headers:(S,O)=>t(De(S),De(O),!0)};return J.forEach(Object.keys(Object.assign({},f,h)),function(O){const P=C[O]||t,A=P(f[O],h[O],O);J.isUndefined(A)&&P!==m||(l[O]=A)}),l}const an="1.5.1",ye={};["object","boolean","number","function","string","symbol"].forEach((f,h)=>{ye[f]=function(e){return typeof e===f||"a"+(h<1?"n ":" ")+f}});const Ne={};ye.transitional=function(h,l,e){function t(o,n){return"[Axios v"+an+"] Transitional option '"+o+"'"+n+(e?". "+e:"")}return(o,n,m)=>{if(h===!1)throw new nt(t(n," has been removed"+(l?" in "+l:"")),nt.ERR_DEPRECATED);return l&&!Ne[n]&&(Ne[n]=!0,console.warn(t(n," has been deprecated since v"+l+" and will be removed in the near future"))),h?h(o,n,m):!0}};function qr(f,h,l){if(typeof f!="object")throw new nt("options must be an object",nt.ERR_BAD_OPTION_VALUE);const e=Object.keys(f);let t=e.length;for(;t-- >0;){const o=e[t],n=h[o];if(n){const m=f[o],C=m===void 0||n(m,o,f);if(C!==!0)throw new nt("option "+o+" must be "+C,nt.ERR_BAD_OPTION_VALUE);continue}if(l!==!0)throw new nt("Unknown option "+o,nt.ERR_BAD_OPTION)}}const ue={assertOptions:qr,validators:ye},At=ue.validators;class Ft{constructor(h){this.defaults=h,this.interceptors={request:new Ie,response:new Ie}}request(h,l){typeof h=="string"?(l=l||{},l.url=h):l=h||{},l=bt(this.defaults,l);const{transitional:e,paramsSerializer:t,headers:o}=l;e!==void 0&&ue.assertOptions(e,{silentJSONParsing:At.transitional(At.boolean),forcedJSONParsing:At.transitional(At.boolean),clarifyTimeoutError:At.transitional(At.boolean)},!1),t!=null&&(J.isFunction(t)?l.paramsSerializer={serialize:t}:ue.assertOptions(t,{encode:At.function,serialize:At.function},!0)),l.method=(l.method||this.defaults.method||"get").toLowerCase();let n=o&&J.merge(o.common,o[l.method]);o&&J.forEach(["delete","get","head","post","put","patch","common"],a=>{delete o[a]}),l.headers=Rt.concat(n,o);const m=[];let C=!0;this.interceptors.request.forEach(function(g){typeof g.runWhen=="function"&&g.runWhen(l)===!1||(C=C&&g.synchronous,m.unshift(g.fulfilled,g.rejected))});const S=[];this.interceptors.response.forEach(function(g){S.push(g.fulfilled,g.rejected)});let O,P=0,A;if(!C){const a=[Le.bind(this),void 0];for(a.unshift.apply(a,m),a.push.apply(a,S),A=a.length,O=Promise.resolve(l);P<A;)O=O.then(a[P++],a[P++]);return O}A=m.length;let b=l;for(P=0;P<A;){const a=m[P++],g=m[P++];try{b=a(b)}catch(L){g.call(this,L);break}}try{O=Le.call(this,b)}catch(a){return Promise.reject(a)}for(P=0,A=S.length;P<A;)O=O.then(S[P++],S[P++]);return O}getUri(h){h=bt(this.defaults,h);const l=on(h.baseURL,h.url);return tn(l,h.params,h.paramsSerializer)}}J.forEach(["delete","get","head","options"],function(h){Ft.prototype[h]=function(l,e){return this.request(bt(e||{},{method:h,url:l,data:(e||{}).data}))}});J.forEach(["post","put","patch"],function(h){function l(e){return function(o,n,m){return this.request(bt(m||{},{method:h,headers:e?{"Content-Type":"multipart/form-data"}:{},url:o,data:n}))}}Ft.prototype[h]=l(),Ft.prototype[h+"Form"]=l(!0)});const Bt=Ft;class Oe{constructor(h){if(typeof h!="function")throw new TypeError("executor must be a function.");let l;this.promise=new Promise(function(o){l=o});const e=this;this.promise.then(t=>{if(!e._listeners)return;let o=e._listeners.length;for(;o-- >0;)e._listeners[o](t);e._listeners=null}),this.promise.then=t=>{let o;const n=new Promise(m=>{e.subscribe(m),o=m}).then(t);return n.cancel=function(){e.unsubscribe(o)},n},h(function(o,n,m){e.reason||(e.reason=new Mt(o,n,m),l(e.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(h){if(this.reason){h(this.reason);return}this._listeners?this._listeners.push(h):this._listeners=[h]}unsubscribe(h){if(!this._listeners)return;const l=this._listeners.indexOf(h);l!==-1&&this._listeners.splice(l,1)}static source(){let h;return{token:new Oe(function(t){h=t}),cancel:h}}}const Qr=Oe;function $r(f){return function(l){return f.apply(null,l)}}function Xr(f){return J.isObject(f)&&f.isAxiosError===!0}const ce={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(ce).forEach(([f,h])=>{ce[h]=f});const Yr=ce;function un(f){const h=new Bt(f),l=_e(Bt.prototype.request,h);return J.extend(l,Bt.prototype,h,{allOwnKeys:!0}),J.extend(l,h,null,{allOwnKeys:!0}),l.create=function(t){return un(bt(f,t))},l}const at=un(me);at.Axios=Bt;at.CanceledError=Mt;at.CancelToken=Qr;at.isCancel=rn;at.VERSION=an;at.toFormData=qt;at.AxiosError=nt;at.Cancel=at.CanceledError;at.all=function(h){return Promise.all(h)};at.spread=$r;at.isAxiosError=Xr;at.mergeConfig=bt;at.AxiosHeaders=Rt;at.formToJSON=f=>nn(J.isHTMLForm(f)?new FormData(f):f);at.getAdapter=sn.getAdapter;at.HttpStatusCode=Yr;at.default=at;const Zr=at;window.axios=Zr;window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";window.Ably=kn;window.Echo=new Nn({broadcaster:"ably"});window.Echo.connector.ably.connection.on(f=>{f.current==="connected"&&console.log("connected to ably server")});
